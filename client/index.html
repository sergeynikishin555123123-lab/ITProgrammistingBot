<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeFarm - –£—á–∏–º Python —á–µ—Ä–µ–∑ —Ñ–µ—Ä–º–µ—Ä—Å—Ç–≤–æ</title>
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        .app-container {
            max-width: 100%;
            min-height: 100vh;
            background: white;
            margin: 0 auto;
        }
        
        /* –®–∞–ø–∫–∞ */
        .header {
            background: linear-gradient(to right, #4CAF50, #2E7D32);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            font-size: 28px;
        }
        
        .logo h1 {
            font-size: 20px;
            margin: 0;
        }
        
        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .content {
            padding: 20px;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #4CAF50;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .card h2 {
            color: #2E7D32;
            margin-bottom: 15px;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: block;
            width: 100%;
            margin: 10px 0;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #2196F3, #0D47A1);
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        /* –£—Ä–æ–∫–∏ */
        .lesson-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #e0e0e0;
        }
        
        .lesson-status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .completed { background: #4CAF50; }
        .in-progress { background: #FFC107; }
        .locked { background: #9E9E9E; }
        
        /* –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ */
        .code-editor {
            background: #1e1e1e;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        textarea {
            width: 100%;
            min-height: 150px;
            background: #1e1e1e;
            color: #fff;
            border: none;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            border-radius: 5px;
            resize: vertical;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav {
            display: flex;
            justify-content: space-around;
            background: white;
            border-top: 2px solid #eee;
            padding: 10px;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
        }
        
        .nav-item {
            text-align: center;
            padding: 10px;
            cursor: pointer;
            border-radius: 10px;
        }
        
        .nav-item.active {
            background: #f0f9ff;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notice {
            background: #FFF3CD;
            border: 1px solid #FFEEBA;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            text-align: center;
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="app-container" id="app-container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">üöú</div>
                <h1>CodeFarm</h1>
            </div>
            <div id="user-coins" style="font-weight: bold; font-size: 18px;">100 ü™ô</div>
        </header>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="content" id="content">
            <!-- –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å -->
            <div id="welcome-screen" class="card">
                <h2>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                <p id="welcome-text">–ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à—É —Ñ–µ—Ä–º—É...</p>
                <div style="height: 10px; background: #e0e0e0; border-radius: 5px; margin: 20px 0; overflow: hidden;">
                    <div id="loading-bar" style="height: 100%; background: #4CAF50; width: 0%; transition: width 0.3s;"></div>
                </div>
                <button class="btn btn-primary" onclick="showSection('farm')">
                    üöú –û—Ç–∫—Ä—ã—Ç—å —Ñ–µ—Ä–º—É
                </button>
            </div>
            
            <!-- –§–µ—Ä–º–∞ -->
            <div id="farm-screen" class="card" style="display: none;">
                <h2>üåæ –í–∞—à–∞ —Ñ–µ—Ä–º–∞</h2>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-icon">üèóÔ∏è</div>
                        <div>–ü–æ—Å—Ç—Ä–æ–µ–∫</div>
                        <div id="buildings-count">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üå±</div>
                        <div>–ü–æ—Å–∞–¥–æ–∫</div>
                        <div id="crops-count">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üí∞</div>
                        <div>–ú–æ–Ω–µ—Ç</div>
                        <div id="coins-count">100</div>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="showSection('lessons')">
                    üìö –ü—Ä–æ–π—Ç–∏ —É—Ä–æ–∫
                </button>
            </div>
            
            <!-- –£—Ä–æ–∫–∏ -->
            <div id="lessons-screen" class="card" style="display: none;">
                <h2>üìö –£—Ä–æ–∫–∏ Python</h2>
                <p>–ò–∑—É—á–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–∞–∑–≤–∏–≤–∞—è —Ñ–µ—Ä–º—É!</p>
                
                <div id="lessons-list">
                    <div class="lesson-card">
                        <div class="lesson-status completed"></div>
                        <h3>–£—Ä–æ–∫ 1: –ü–µ—Ä–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã</h3>
                        <p>–ù–∞—É—á–∏—Ç–µ—Å—å –¥–∞–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç—É</p>
                        <button class="btn btn-secondary" onclick="startLesson(1)" style="margin-top: 10px; padding: 8px 16px;">
                            –ù–∞—á–∞—Ç—å
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ -->
            <div id="code-screen" class="card" style="display: none;">
                <h2>üíª –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞</h2>
                
                <div class="code-editor">
                    <textarea id="code-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–æ–¥ Python –∑–¥–µ—Å—å...">
print("–ü—Ä–∏–≤–µ—Ç, –ê–≥—Ä–æ–ë–æ—Ç!")
bot_say("–ù–∞—á–∏–Ω–∞—é —Ä–∞–±–æ—Ç—É")
clear_area("north")</textarea>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="runCode()">
                        ‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å
                    </button>
                    <button class="btn btn-primary" onclick="submitCode()">
                        üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                    </button>
                </div>
                
                <div id="output" style="margin-top: 15px; padding: 10px; background: #f5f5f5; border-radius: 5px; display: none;">
                    <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h4>
                    <pre id="output-text"></pre>
                </div>
            </div>
            
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div id="stats-screen" class="card" style="display: none;">
                <h2>üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-icon">‚≠ê</div>
                        <div>–£—Ä–æ–≤–µ–Ω—å</div>
                        <div id="user-level">1</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">‚ú®</div>
                        <div>–û–ø—ã—Ç</div>
                        <div id="user-exp">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üìö</div>
                        <div>–£—Ä–æ–∫–∏</div>
                        <div id="lessons-completed">0</div>
                    </div>
                </div>
                
                <div style="margin: 20px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>–ü—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–≤–Ω—è:</span>
                        <span id="level-percent">0%</span>
                    </div>
                    <div style="height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden;">
                        <div id="level-bar" style="height: 100%; background: #4CAF50; width: 0%;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="nav">
            <div class="nav-item active" onclick="showSection('farm')">
                <div>üåæ</div>
                <div style="font-size: 12px;">–§–µ—Ä–º–∞</div>
            </div>
            <div class="nav-item" onclick="showSection('lessons')">
                <div>üìö</div>
                <div style="font-size: 12px;">–£—Ä–æ–∫–∏</div>
            </div>
            <div class="nav-item" onclick="showSection('code')">
                <div>üíª</div>
                <div style="font-size: 12px;">–ö–æ–¥</div>
            </div>
            <div class="nav-item" onclick="showSection('stats')">
                <div>üìä</div>
                <div style="font-size: 12px;">–°—Ç–∞—Ç—ã</div>
            </div>
        </nav>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = null;
        let currentUserId = null;
        let userData = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—Ä—ã—Ç–æ –ª–∏ –≤ Telegram Web App
            if (window.Telegram && window.Telegram.WebApp) {
                console.log('‚úÖ –û—Ç–∫—Ä—ã—Ç–æ –≤ Telegram Web App');
                initTelegramApp();
            } else {
                console.log('‚ÑπÔ∏è –û—Ç–∫—Ä—ã—Ç–æ –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
                initBrowserApp();
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏
            simulateLoading();
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Telegram Web App
        function initTelegramApp() {
            const tg = window.Telegram.WebApp;
            
            // –†–∞—Å—à–∏—Ä—è–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            tg.expand();
            
            // –ü–æ–º–µ—á–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞–∫ –≥–æ—Ç–æ–≤–æ–µ
            tg.ready();
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const user = tg.initDataUnsafe?.user;
            if (user) {
                currentUser = user;
                currentUserId = user.id.toString();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                document.getElementById('welcome-text').textContent = 
                    `–ü—Ä–∏–≤–µ—Ç, ${user.first_name || '–§–µ—Ä–º–µ—Ä'}! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ CodeFarm!`;
                
                // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                registerUser();
            } else {
                document.getElementById('welcome-text').textContent = 
                    '–î–ª—è –Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ @CodeFarm_Bot';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞
        function initBrowserApp() {
            currentUserId = 'demo-user';
            currentUser = { first_name: '–ì–æ—Å—Ç—å' };
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notice = document.createElement('div');
            notice.className = 'notice';
            notice.innerHTML = '–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–ø—ã—Ç–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ @CodeFarm_Bot';
            document.getElementById('content').prepend(notice);
        }
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function registerUser() {
            if (!currentUserId) return;
            
            try {
                const response = await fetch('/api/user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        telegramId: currentUserId,
                        username: currentUser?.username,
                        firstName: currentUser?.first_name,
                        lastName: currentUser?.last_name
                    })
                });
                
                userData = await response.json();
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', userData);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateUserStats();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                userData = {
                    level: 1,
                    coins: 100,
                    experience: 0
                };
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateUserStats() {
            if (!userData) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
            const elements = {
                'user-level': userData.level || 1,
                'user-exp': userData.experience || 0,
                'coins-count': userData.coins || 100,
                'user-coins': userData.coins || 100
            };
            
            for (const [id, value] of Object.entries(elements)) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —É—Ä–æ–≤–Ω—è
            const exp = userData.experience || 0;
            const levelProgress = (exp % 1000) / 10;
            const levelBar = document.getElementById('level-bar');
            const levelPercent = document.getElementById('level-percent');
            
            if (levelBar) levelBar.style.width = levelProgress + '%';
            if (levelPercent) levelPercent.textContent = levelProgress + '%';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–µ–∫—Ü–∏—é
        function showSection(sectionName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
            const screens = ['welcome', 'farm', 'lessons', 'code', 'stats'];
            screens.forEach(screen => {
                const element = document.getElementById(screen + '-screen');
                if (element) {
                    element.style.display = 'none';
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —ç–∫—Ä–∞–Ω
            const targetScreen = document.getElementById(sectionName + '-screen');
            if (targetScreen) {
                targetScreen.style.display = 'block';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            updateNavigation(sectionName);
            
            // –ï—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–µ—Ä–º—É, –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            if (sectionName === 'farm') {
                loadFarmData();
            }
            
            // –ï—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Ä–æ–∫–∏, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏—Ö
            if (sectionName === 'lessons') {
                loadLessons();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function updateNavigation(activeSection) {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ–∫—Ü–∏–∏
                if (item.onclick && item.onclick.toString().includes(activeSection)) {
                    item.classList.add('active');
                }
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ñ–µ—Ä–º—ã
        async function loadFarmData() {
            if (!currentUserId) return;
            
            try {
                const response = await fetch(`/api/farm/${currentUserId}`);
                const farmData = await response.json();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
                document.getElementById('buildings-count').textContent = 
                    farmData.buildings?.length || 0;
                document.getElementById('crops-count').textContent = 
                    farmData.crops?.length || 0;
                    
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–µ—Ä–º—ã:', error);
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                document.getElementById('buildings-count').textContent = '1';
                document.getElementById('crops-count').textContent = '3';
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–æ–≤
        async function loadLessons() {
            try {
                const response = await fetch('/api/lessons');
                const lessons = await response.json();
                
                const container = document.getElementById('lessons-list');
                if (container && lessons.length > 0) {
                    container.innerHTML = '';
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 3 —É—Ä–æ–∫–∞
                    lessons.slice(0, 3).forEach((lesson, index) => {
                        const lessonElement = document.createElement('div');
                        lessonElement.className = 'lesson-card';
                        lessonElement.innerHTML = `
                            <div class="lesson-status ${index === 0 ? 'completed' : 'locked'}"></div>
                            <h3>–£—Ä–æ–∫ ${index + 1}: ${lesson.title}</h3>
                            <p>${lesson.description}</p>
                            <button class="btn btn-secondary" onclick="startLesson('${lesson.id}')" 
                                    style="margin-top: 10px; padding: 8px 16px;">
                                ${index === 0 ? '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '–ù–∞—á–∞—Ç—å'}
                            </button>
                        `;
                        container.appendChild(lessonElement);
                    });
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤:', error);
            }
        }
        
        // –ù–∞—á–∞—Ç—å —É—Ä–æ–∫
        function startLesson(lessonId) {
            showSection('code');
            
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —É—Ä–æ–∫
            console.log('–ù–∞—á–∏–Ω–∞–µ–º —É—Ä–æ–∫:', lessonId);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è —É—Ä–æ–∫–∞
            const codeInput = document.getElementById('code-input');
            if (codeInput) {
                codeInput.value = `# –ö–æ–¥ –¥–ª—è —É—Ä–æ–∫–∞\nprint("–ü—Ä–∏–≤–µ—Ç, –ê–≥—Ä–æ–ë–æ—Ç!")\nbot_say("–ù–∞—á–∏–Ω–∞—é —É—Ä–æ–∫ ${lessonId}")`;
            }
        }
        
        // –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–¥
        function runCode() {
            const code = document.getElementById('code-input').value;
            const output = document.getElementById('output-text');
            const outputContainer = document.getElementById('output');
            
            if (output && outputContainer) {
                output.textContent = `>>> –ó–∞–ø—É—Å–∫–∞—é –∫–æ–¥...\n\n${code}\n\n>>> –ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!`;
                outputContainer.style.display = 'block';
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
                outputContainer.scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
        async function submitCode() {
            if (!currentUserId) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            const code = document.getElementById('code-input').value;
            if (!code.trim()) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏');
                return;
            }
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫ –¥–ª—è –¥–µ–º–æ
                const lessonId = 'lesson_1';
                
                const response = await fetch(`/api/lessons/${lessonId}/submit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: currentUserId,
                        code: code
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`üéâ –£—Ä–æ–∫ –ø—Ä–æ–π–¥–µ–Ω!\n–ù–∞–≥—Ä–∞–¥–∞: ${result.reward} –º–æ–Ω–µ—Ç`);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–Ω–µ—Ç—ã
                    if (result.coins) {
                        document.getElementById('coins-count').textContent = result.coins;
                        document.getElementById('user-coins').textContent = result.coins + ' ü™ô';
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
                    showSuccess();
                    
                } else {
                    alert(`‚ùå –ï—Å—Ç—å –æ—à–∏–±–∫–∏:\n${result.errors?.join('\n') || result.message}`);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º');
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—Ö
        function showSuccess() {
            const btn = document.querySelector('.btn-primary');
            if (btn) {
                const originalText = btn.textContent;
                btn.textContent = 'üéâ –£—Å–ø–µ—Ö! üéâ';
                btn.style.background = 'linear-gradient(135deg, #FF9800, #FF5722)';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            }
        }
        
        // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        function simulateLoading() {
            const loadingBar = document.getElementById('loading-bar');
            let width = 0;
            
            const interval = setInterval(() => {
                width += 10;
                loadingBar.style.width = width + '%';
                
                if (width >= 100) {
                    clearInterval(interval);
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–µ—Ä–º—É —á–µ—Ä–µ–∑ 0.5 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        showSection('farm');
                    }, 500);
                }
            }, 200);
        }
    </script>
</body>
</html>
