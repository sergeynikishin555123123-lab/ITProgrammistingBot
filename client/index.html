<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeFarm - –£—á–∏–º Python —á–µ—Ä–µ–∑ —Ñ–µ—Ä–º–µ—Ä—Å—Ç–≤–æ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #4CAF50;
            --primary-dark: #2E7D32;
            --secondary-color: #2196F3;
            --accent-color: #FF9800;
            --text-color: #333;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-radius: 16px;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-color);
            overflow-x: hidden;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        .app-container {
            max-width: 100%;
            min-height: 100vh;
            background: var(--bg-color);
            margin: 0 auto;
            position: relative;
        }
        
        /* –®–∞–ø–∫–∞ */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            font-size: 32px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .logo h1 {
            font-size: 22px;
            margin: 0;
            font-weight: 700;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —à–∞–ø–∫–µ */
        .header-stats {
            display: flex;
            gap: 15px;
        }
        
        .stat-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
        
        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .content {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* –°–µ–∫—Ü–∏–∏ */
        .section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 24px;
            color: var(--primary-dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary-color);
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary-color), #0D47A1);
            color: white;
        }
        
        .btn-accent {
            background: linear-gradient(135deg, var(--accent-color), #EF6C00);
            color: white;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-dark);
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        /* 2D –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–µ—Ä–º—ã */
        .farm-visualization {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 25px 0;
            border: 3px solid var(--primary-color);
            position: relative;
            overflow: hidden;
            min-height: 300px;
        }
        
        .farm-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 5px;
            width: 100%;
            height: 300px;
            margin: 0 auto;
        }
        
        .farm-cell {
            background: #8BC34A;
            border: 1px solid #7CB342;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .farm-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        .farm-cell.house { background: #FF9800; }
        .farm-cell.barn { background: #795548; }
        .farm-cell.greenhouse { background: #4CAF50; }
        .farm-cell.crop { background: #FFEB3B; }
        .farm-cell.tree { background: #8BC34A; }
        .farm-cell.water { background: #2196F3; }
        .farm-cell.empty { background: #C8E6C9; }
        
        .farm-cell-label {
            position: absolute;
            bottom: 2px;
            font-size: 10px;
            color: rgba(0,0,0,0.7);
            font-weight: bold;
        }
        
        .farm-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .farm-btn {
            background: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .farm-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-3px);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ —Ñ–µ—Ä–º—ã */
        @keyframes grow {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes water {
            0% { transform: translateY(-20px); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(20px); opacity: 0; }
        }
        
        @keyframes harvest {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .grow-animation {
            animation: grow 0.5s ease-out;
        }
        
        .water-animation::after {
            content: 'üíß';
            position: absolute;
            animation: water 1s linear;
        }
        
        .harvest-animation {
            animation: harvest 0.5s ease-in-out;
        }
        
        /* –£—Ä–æ–∫–∏ */
        .lessons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .lesson-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .lesson-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        .lesson-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.15);
        }
        
        .lesson-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .lesson-number {
            background: var(--primary-color);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }
        
        .lesson-status {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        .status-completed { background: #4CAF50; }
        .status-in-progress { background: #FFC107; }
        .status-locked { background: #9E9E9E; }
        
        .lesson-rewards {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .reward-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: #f0f9ff;
            padding: 5px 10px;
            border-radius: 15px;
        }
        
        /* –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ */
        .code-editor-container {
            background: #1e1e1e;
            border-radius: 15px;
            overflow: hidden;
            margin: 25px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .editor-toolbar {
            background: #252526;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }
        
        .editor-actions {
            display: flex;
            gap: 10px;
        }
        
        #code-editor {
            width: 100%;
            min-height: 300px;
            background: #1e1e1e;
            color: #d4d4d4;
            border: none;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            outline: none;
        }
        
        .output-container {
            background: #252526;
            color: #d4d4d4;
            padding: 20px;
            border-top: 1px solid #333;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-bar {
            display: flex;
            background: white;
            border-top: 2px solid #eee;
            position: sticky;
            bottom: 0;
            z-index: 1000;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 15px 10px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            color: #666;
        }
        
        .nav-item:hover {
            background: #f8f9fa;
            color: var(--primary-color);
        }
        
        .nav-item.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: linear-gradient(to top, rgba(76, 175, 80, 0.1), transparent);
        }
        
        .nav-icon {
            font-size: 22px;
            margin-bottom: 5px;
            display: block;
        }
        
        .nav-label {
            font-size: 12px;
            font-weight: 600;
        }

/* –§–µ—Ä–º–∞ */
.farm-grid {
    display: grid;
    gap: 2px;
    background: #8D6E63;
    padding: 10px;
    border-radius: 10px;
    border: 3px solid #5D4037;
    min-height: 400px;
}

.farm-cell {
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 5px;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    user-select: none;
}

.farm-cell:hover {
    transform: scale(1.1);
    z-index: 10;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.farm-cell-content {
    font-size: 24px;
}

.farm-cell-coords {
    position: absolute;
    bottom: 2px;
    right: 2px;
    font-size: 8px;
    color: rgba(0,0,0,0.5);
    background: rgba(255,255,255,0.3);
    padding: 1px 3px;
    border-radius: 2px;
}

/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–µ—Ä–º—ã */
.farm-stats {
    display: flex;
    gap: 10px;
    margin-top: 15px;
    flex-wrap: wrap;
}

.stat-card {
    background: white;
    padding: 10px 15px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stat-icon {
    font-size: 24px;
}

.stat-value {
    font-weight: bold;
    font-size: 18px;
    color: var(--primary-color);
}

.stat-label {
    font-size: 12px;
    color: #666;
}

/* –ü—Ä–æ–≥—Ä–µ—Å—Å —Ñ–µ—Ä–º—ã */
.farm-progress {
    margin-top: 15px;
}

.progress-bar {
    height: 10px;
    background: #e0e0e0;
    border-radius: 5px;
    overflow: hidden;
    margin-bottom: 5px;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #8BC34A);
    transition: width 0.5s ease;
}
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 400px;
            transform: translateX(120%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification-icon {
            font-size: 28px;
        }
        
        .notification-success .notification-icon { color: #4CAF50; }
        .notification-error .notification-icon { color: #f44336; }
        .notification-info .notification-icon { color: #2196F3; }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .header-stats {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .lessons-grid {
                grid-template-columns: 1fr;
            }
            
            .farm-grid {
                grid-template-columns: repeat(6, 1fr);
                grid-template-rows: repeat(6, 1fr);
                height: 250px;
            }
            
            .editor-toolbar {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
        }
        
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">üöú</div>
                <div>
                    <h1>CodeFarm</h1>
                    <div style="font-size: 12px; opacity: 0.9;">–£—á–∏–º Python —á–µ—Ä–µ–∑ —Ñ–µ—Ä–º–µ—Ä—Å—Ç–≤–æ</div>
                </div>
            </div>
            
            <div class="header-stats">
                <div class="stat-badge">
                    <i class="fas fa-coins"></i>
                    <span id="header-coins">100</span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-star"></i>
                    <span id="header-level">–£—Ä. 1</span>
                </div>
            </div>
        </header>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="content">
            <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <div id="loading-screen" class="fade-in">
                <div class="card" style="text-align: center; padding: 50px 20px;">
                    <div class="logo-icon" style="font-size: 64px; margin-bottom: 20px;">üöú</div>
                    <h2 style="color: var(--primary-dark); margin-bottom: 15px;">–ó–∞–≥—Ä—É–∂–∞–µ–º CodeFarm...</h2>
                    <p style="color: #666; margin-bottom: 30px;">–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –≤–∞—à—É —Ñ–µ—Ä–º—É –∏ —É—Ä–æ–∫–∏</p>
                    
                    <div class="progress-container" style="max-width: 400px; margin: 0 auto;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="loading-progress" style="width: 0%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 14px; color: #666;">
                            <span>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</span>
                            <span id="loading-percent">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω —Ñ–µ—Ä–º—ã -->
            <div id="main-screen" style="display: none;">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="section">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">‚≠ê</div>
                            <div class="stat-value" id="user-level-value">1</div>
                            <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ü™ô</div>
                            <div class="stat-value" id="user-coins-value">100</div>
                            <div class="stat-label">–ú–æ–Ω–µ—Ç—ã</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚ú®</div>
                            <div class="stat-value" id="user-exp-value">0</div>
                            <div class="stat-label">–û–ø—ã—Ç</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìö</div>
                            <div class="stat-value" id="user-lessons-value">0</div>
                            <div class="stat-label">–£—Ä–æ–∫–∏</div>
                        </div>
                    </div>
                </div>
                
                <!-- 2D –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–µ—Ä–º—ã -->
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-tractor"></i>
                        –í–∞—à–∞ —Ñ–µ—Ä–º–∞
                    </h2>
                    
                    <div class="farm-visualization">
                        <div class="farm-grid" id="farm-grid">
                            <!-- –§–µ—Ä–º–∞ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ JS -->
                        </div>
                    </div>

                    <div class="farm-stats">
    <div class="stat-card">
        <div class="stat-icon">üßπ</div>
        <div>
            <div class="stat-value" id="cleared-land-count">0</div>
            <div class="stat-label">–û—á–∏—â–µ–Ω–æ –∑–µ–º–ª–∏</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">üèóÔ∏è</div>
        <div>
            <div class="stat-value" id="buildings-count">0</div>
            <div class="stat-label">–ü–æ—Å—Ç—Ä–æ–µ–∫</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">üå±</div>
        <div>
            <div class="stat-value" id="crops-count">0</div>
            <div class="stat-label">–†–∞—Å—Ç–µ–Ω–∏–π</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">üìö</div>
        <div>
            <div class="stat-value" id="lessons-count">0</div>
            <div class="stat-label">–£—Ä–æ–∫–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ</div>
        </div>
    </div>
</div>

<div class="farm-progress">
    <div class="progress-bar">
        <div class="progress-fill" id="farm-progress-bar" style="width: 0%"></div>
    </div>
    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
        <span>üåø –ó–∞—Ä–æ—Å—à–∞—è —Ñ–µ—Ä–º–∞</span>
        <span>üèÜ –ü—Ä–æ—Ü–≤–µ—Ç–∞—é—â–∞—è —Ñ–µ—Ä–º–∞</span>
    </div>
</div>

<div class="farm-controls">
    <button class="farm-btn farm-action-btn" data-action="water">
        <i class="fas fa-tint"></i> –ü–æ–ª–∏—Ç—å –≤—Å–µ
    </button>
    <button class="farm-btn farm-action-btn" data-action="harvest">
        <i class="fas fa-shopping-basket"></i> –°–æ–±—Ä–∞—Ç—å —É—Ä–æ–∂–∞–π
    </button>
    <button class="farm-btn farm-action-btn" data-action="plant">
        <i class="fas fa-seedling"></i> –ü–æ—Å–∞–¥–∏—Ç—å
    </button>
    <button class="farm-btn farm-action-btn" data-action="build">
        <i class="fas fa-home"></i> –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º
    </button>
    <button class="farm-btn farm-action-btn" data-action="upgrade">
        <i class="fas fa-arrow-up"></i> –£–ª—É—á—à–∏—Ç—å
    </button>
</div>
                </div>
                
                <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-bolt"></i>
                        –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                    </h2>
                    
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
    <button class="btn btn-primary quick-action-btn" data-action="start_lesson_1">
        <i class="fas fa-code"></i> –£—Ä–æ–∫ 1: –ü–µ—Ä–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
    </button>
    <button class="btn btn-secondary" onclick="window.showScreen('lessons')">
        <i class="fas fa-book-open"></i> –í—Å–µ —É—Ä–æ–∫–∏
    </button>
    <button class="btn btn-accent quick-action-btn" data-action="sell_produce">
        <i class="fas fa-shopping-cart"></i> –ü—Ä–æ–¥–∞—Ç—å —É—Ä–æ–∂–∞–π
    </button>
    <button class="btn btn-primary" onclick="window.showScreen('code')">
        <i class="fas fa-laptop-code"></i> –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞
    </button>
</div>
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω —É—Ä–æ–∫–æ–≤ -->
            <div id="lessons-screen" style="display: none;">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-graduation-cap"></i>
                        –£—Ä–æ–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
                    </h2>
                    
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div>
                                <h3 style="margin-bottom: 5px;">–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
                                <p style="color: #666;">–ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–∫–æ–≤: <span id="completed-lessons">0</span>/28</p>
                            </div>
                            <div class="stat-badge" style="background: var(--primary-color); color: white;">
                                <i class="fas fa-star"></i> –£—Ä–æ–≤–µ–Ω—å: <span id="user-level-text">1</span>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="lessons-progress" style="width: 0%"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 14px; color: #666;">
                                <span>–ù–∞—á–∏–Ω–∞—é—â–∏–π</span>
                                <span>–≠–∫—Å–ø–µ—Ä—Ç</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-code"></i>
                        –î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Ä–æ–∫–∏
                    </h2>
                    
                    <div class="lessons-grid" id="lessons-list">
                        <!-- –£—Ä–æ–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫–æ–¥–∞ -->
            <div id="code-screen" style="display: none;">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-laptop-code"></i>
                        –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞
                    </h2>
                    
                    <div class="code-editor-container">
                        <div class="editor-toolbar">
                            <div>
                                <h3 style="color: white; margin: 0;" id="current-lesson-title">–£—Ä–æ–∫ 1: –ü–µ—Ä–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã</h3>
                                <p style="color: #999; margin: 5px 0 0 0; font-size: 14px;" id="current-lesson-desc">
                                    –ù–∞—É—á–∏—Ç–µ—Å—å –¥–∞–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç—É
                                </p>
                            </div>
                            <div class="editor-actions">
    <button class="btn btn-secondary" id="run-code-btn">
        <i class="fas fa-play"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å
    </button>
    <button class="btn btn-primary" id="submit-code-btn">
        <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
    </button>
</div>
                        </div>
                        
                        <div style="position: relative;">
                            <textarea id="code-editor" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –∫–æ–¥ Python –∑–¥–µ—Å—å..."></textarea>
                            <div style="position: absolute; top: 10px; right: 10px; background: rgba(30, 30, 30, 0.8); padding: 5px 10px; border-radius: 5px; color: #999; font-size: 12px;">
                                Python 3.9
                            </div>
                        </div>
                        
                        <div class="output-container" id="output-container">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="margin: 0; color: #d4d4d4;">–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</h4>
                                <button class="btn btn-outline" style="padding: 5px 10px; font-size: 12px; background: transparent; border: 1px solid #666; color: #999;" id="clear-output-btn">
    <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å
</button>
                            </div>
                            <pre id="output-text" style="margin: 0; white-space: pre-wrap; word-wrap: break-word;"></pre>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-lightbulb"></i>
                        –ü–æ–¥—Å–∫–∞–∑–∫–∏
                    </h2>
                    
                    <div class="card">
                        <div id="hints-container">
                            <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                                <div style="font-size: 24px; color: var(--accent-color);">üí°</div>
                                <div>
                                    <h4 style="margin-bottom: 5px;">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é print()</h4>
                                    <p style="color: #666; margin: 0;">–î–ª—è –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —ç–∫—Ä–∞–Ω –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ print("–≤–∞—à —Ç–µ–∫—Å—Ç")</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—è -->
            <div id="profile-screen" style="display: none;">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-user"></i>
                        –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å
                    </h2>
                    
                    <div class="card">
                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 25px;">
                            <div style="font-size: 64px;">üë®‚Äçüåæ</div>
                            <div>
                                <h3 id="profile-name" style="margin-bottom: 5px;">–§–µ—Ä–º–µ—Ä</h3>
                                <p id="profile-username" style="color: #666; margin-bottom: 10px;">@username</p>
                                <div class="stat-badge" style="display: inline-block; background: var(--primary-color); color: white;">
                                    –£—á–∞—Å—Ç–Ω–∏–∫ —Å —Å–µ–≥–æ–¥–Ω—è
                                </div>
                            </div>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                                <div class="stat-value" id="profile-streak">1</div>
                                <div class="stat-label">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-code"></i></div>
                                <div class="stat-value" id="profile-lines">0</div>
                                <div class="stat-label">–°—Ç—Ä–æ–∫ –∫–æ–¥–∞</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                                <div class="stat-value" id="profile-solved">0</div>
                                <div class="stat-label">–ó–∞–¥–∞—á —Ä–µ—à–µ–Ω–æ</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-ranking-star"></i></div>
                                <div class="stat-value" id="profile-rank">#-</div>
                                <div class="stat-label">–†–∞–Ω–≥</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<nav class="nav-bar">
    <div class="nav-item active" data-screen="main" onclick="window.showScreen('main')">
        <div class="nav-icon">üè†</div>
        <div class="nav-label">–ì–ª–∞–≤–Ω–∞—è</div>
    </div>
    <div class="nav-item" data-screen="lessons" onclick="window.showScreen('lessons')">
        <div class="nav-icon">üìö</div>
        <div class="nav-label">–£—Ä–æ–∫–∏</div>
    </div>
    <div class="nav-item" data-screen="code" onclick="window.showScreen('code')">
        <div class="nav-icon">üíª</div>
        <div class="nav-label">–ö–æ–¥</div>
    </div>
    <div class="nav-item" data-screen="profile" onclick="window.showScreen('profile')">
        <div class="nav-icon">üë§</div>
        <div class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</div>
    </div>
</nav>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="notification" id="notification">
        <div class="notification-icon">‚úÖ</div>
        <div>
            <h4 style="margin: 0 0 5px 0;" id="notification-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</h4>
            <p style="margin: 0; color: #666;" id="notification-message">–°–æ–æ–±—â–µ–Ω–∏–µ</p>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É—Ä–æ–∫–∞ -->
    <div class="modal" id="lesson-modal">
        <div class="modal-content">
            <h2 style="color: var(--primary-dark); margin-bottom: 15px;" id="modal-lesson-title">–£—Ä–æ–∫</h2>
            <div id="modal-lesson-content">
                <p>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —É—Ä–æ–∫–∞...</p>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 25px;">
    <button class="btn btn-secondary" id="close-modal-btn" style="flex: 1;">–ó–∞–∫—Ä—ã—Ç—å</button>
    <button class="btn btn-primary" id="start-selected-lesson-btn" style="flex: 1;">–ù–∞—á–∞—Ç—å —É—Ä–æ–∫</button>
</div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π JavaScript –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = null;
        let currentUserId = null;
        let userData = null;
        let lessonsData = [];
        let currentLesson = null;
        let farmData = {
            cells: [],
            size: 8,
            buildings: 3,
            crops: 5,
            trees: 4,
            water: 2
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('CodeFarm Web App –∑–∞–ø—É—â–µ–Ω');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—Ä—ã—Ç–æ –ª–∏ –≤ Telegram Web App
            if (window.Telegram && window.Telegram.WebApp) {
                console.log('‚úÖ –û—Ç–∫—Ä—ã—Ç–æ –≤ Telegram Web App');
                initTelegramApp();
            } else {
                console.log('‚ÑπÔ∏è –û—Ç–∫—Ä—ã—Ç–æ –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
                initBrowserApp();
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            startLoading();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —É—Ä–æ–∫–∏
            loadLessonsData();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞
            initCodeEditor();
            
            // –°–æ–∑–¥–∞–µ–º —Ñ–µ—Ä–º—É
            createFarm();
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Telegram Web App
        function initTelegramApp() {
            const tg = window.Telegram.WebApp;
            
            // –†–∞—Å—à–∏—Ä—è–µ–º –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            tg.expand();
            tg.ready();
            
            // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
            tg.BackButton.show();
            tg.BackButton.onClick(() => {
                showScreen('main');
            });
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const user = tg.initDataUnsafe?.user;
            if (user) {
                currentUser = user;
                currentUserId = user.id.toString();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                updateProfileInfo();
                
                // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                registerUser();
            }
            
            // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç —Ñ–æ–Ω–∞
            tg.setHeaderColor('#4CAF50');
            tg.setBackgroundColor('#f8f9fa');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞
        function initBrowserApp() {
            currentUserId = 'demo-user-' + Date.now();
            currentUser = { 
                first_name: '–î–µ–º–æ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                username: 'demo'
            };
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
            userData = {
                level: 1,
                coins: 250,
                experience: 150,
                lessonsCompleted: 1,
                streak: 3,
                codeLines: 150,
                problemsSolved: 5,
                rank: '#42'
            };
            
            updateUserStats();
            updateProfileInfo();
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ 2D —Ñ–µ—Ä–º—ã
        function createFarm() {
            const grid = document.getElementById('farm-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            // –°–æ–∑–¥–∞–µ–º –∫–ª–µ—Ç–∫–∏ —Ñ–µ—Ä–º—ã
            for (let row = 0; row < farmData.size; row++) {
                for (let col = 0; col < farmData.size; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'farm-cell empty';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∫–ª–µ—Ç–∫–∏
                    let cellType = 'empty';
                    let cellIcon = '';
                    
                    // –¶–µ–Ω—Ç—Ä —Ñ–µ—Ä–º—ã - –¥–æ–º
                    if (row === 3 && col === 3) {
                        cellType = 'house';
                        cellIcon = 'üè†';
                    }
                    // –ê–º–±–∞—Ä
                    else if (row === 3 && col === 4) {
                        cellType = 'barn';
                        cellIcon = 'üèöÔ∏è';
                    }
                    // –¢–µ–ø–ª–∏—Ü–∞
                    else if (row === 4 && col === 3) {
                        cellType = 'greenhouse';
                        cellIcon = 'üåø';
                    }
                    // –ü–æ—Å–µ–≤—ã
                    else if (
                        (row === 1 && col === 1) ||
                        (row === 1 && col === 6) ||
                        (row === 6 && col === 1) ||
                        (row === 6 && col === 6) ||
                        (row === 2 && col === 2)
                    ) {
                        cellType = 'crop';
                        cellIcon = 'üå±';
                    }
                    // –î–µ—Ä–µ–≤—å—è
                    else if (
                        (row === 0 && col === 0) ||
                        (row === 0 && col === 7) ||
                        (row === 7 && col === 0) ||
                        (row === 7 && col === 7)
                    ) {
                        cellType = 'tree';
                        cellIcon = 'üå≥';
                    }
                    // –í–æ–¥–∞
                    else if (
                        (row === 0 && col === 3) ||
                        (row === 7 && col === 4)
                    ) {
                        cellType = 'water';
                        cellIcon = 'üíß';
                    }
                    
                    cell.className = `farm-cell ${cellType} fade-in`;
                    cell.innerHTML = `
                        <div class="farm-cell-icon">${cellIcon}</div>
                        <div class="farm-cell-label">${row},${col}</div>
                    `;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                    cell.addEventListener('click', () => {
                        handleFarmCellClick(row, col, cellType);
                    });
                    
                    grid.appendChild(cell);
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–µ—Ç–∫–∏
                    farmData.cells.push({
                        row, col, type: cellType,
                        growth: cellType === 'crop' ? Math.floor(Math.random() * 100) : 0,
                        water: cellType === 'crop' ? Math.floor(Math.random() * 100) : 100
                    });
                }
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–ª–µ—Ç–∫–µ —Ñ–µ—Ä–º—ã
        function handleFarmCellClick(row, col, type) {
            let message = '';
            let action = '';
            
            switch(type) {
                case 'house':
                    message = 'üè† –í–∞—à –¥–æ–º. –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ñ–µ—Ä–º—ã.';
                    action = 'house';
                    break;
                case 'barn':
                    message = 'üèöÔ∏è –ê–º–±–∞—Ä. –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ —É—Ä–æ–∂–∞—è.';
                    action = 'barn';
                    break;
                case 'greenhouse':
                    message = 'üåø –¢–µ–ø–ª–∏—Ü–∞. –ó–¥–µ—Å—å —Ä–∞—Å—Ç—É—Ç —Ç–µ–ø–ª–æ–ª—é–±–∏–≤—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è –∫—Ä—É–≥–ª—ã–π –≥–æ–¥.';
                    action = 'greenhouse';
                    break;
                case 'crop':
                    message = 'üå± –ü–æ–ª–µ —Å –ø–æ—Å–µ–≤–∞–º–∏. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–ª–∏—Ç—å" —á—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å —Ä–æ—Å—Ç.';
                    action = 'crop';
                    break;
                case 'tree':
                    message = 'üå≥ –§—Ä—É–∫—Ç–æ–≤–æ–µ –¥–µ—Ä–µ–≤–æ. –î–∞–µ—Ç —É—Ä–æ–∂–∞–π –∫–∞–∂–¥—ã–π —Å–µ–∑–æ–Ω.';
                    action = 'tree';
                    break;
                case 'water':
                    message = 'üíß –ò—Å—Ç–æ—á–Ω–∏–∫ –≤–æ–¥—ã. –ù–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –ø–æ–ª–∏–≤–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π.';
                    action = 'water';
                    break;
                default:
                    message = `–ü—É—Å—Ç–æ–π —É—á–∞—Å—Ç–æ–∫ –∑–µ–º–ª–∏ (${row},${col}). –ú–æ–∂–Ω–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —á—Ç–æ-–Ω–∏–±—É–¥—å!`;
                    action = 'empty';
            }
            
            showNotification('üåæ ' + action.charAt(0).toUpperCase() + action.slice(1), message);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∫–ª–∏–∫–µ
            const cell = document.querySelector(`.farm-cell[data-row="${row}"][data-col="${col}"]`);
            if (cell) {
                cell.classList.add('grow-animation');
                setTimeout(() => {
                    cell.classList.remove('grow-animation');
                }, 500);
            }
        }
        
        // –î–µ–π—Å—Ç–≤–∏—è —Å —Ñ–µ—Ä–º–æ–π
        window.farmActions = {
            waterAll: function() {
                // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –ø–æ—Å–µ–≤—ã
                const crops = document.querySelectorAll('.farm-cell.crop');
                crops.forEach(crop => {
                    crop.classList.add('water-animation');
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    const row = parseInt(crop.dataset.row);
                    const col = parseInt(crop.dataset.col);
                    const cellData = farmData.cells.find(c => c.row === row && c.col === col);
                    if (cellData) {
                        cellData.water = Math.min(100, cellData.water + 30);
                        cellData.growth = Math.min(100, cellData.growth + 10);
                    }
                });
                
                setTimeout(() => {
                    crops.forEach(crop => {
                        crop.classList.remove('water-animation');
                    });
                }, 1000);
                
                showNotification('üíß –ü–æ–ª–∏–≤ –∑–∞–≤–µ—Ä—à–µ–Ω', '–í—Å–µ —Ä–∞—Å—Ç–µ–Ω–∏—è –ø–æ–ª–∏—Ç—ã! –†–æ—Å—Ç —É—Å–∫–æ—Ä–µ–Ω –Ω–∞ 10%.');
                updateCoins(5);
            },
            
            harvestAll: function() {
                // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å–æ–∑—Ä–µ–≤—à–∏–µ –ø–æ—Å–µ–≤—ã
                const crops = document.querySelectorAll('.farm-cell.crop');
                let harvested = 0;
                
                crops.forEach(crop => {
                    const row = parseInt(crop.dataset.row);
                    const col = parseInt(crop.dataset.col);
                    const cellData = farmData.cells.find(c => c.row === row && c.col === col);
                    
                    if (cellData && cellData.growth >= 50) {
                        harvested++;
                        cellData.growth = 0;
                        
                        // –ê–Ω–∏–º–∞—Ü–∏—è —Å–±–æ—Ä–∞
                        crop.classList.add('harvest-animation');
                        crop.querySelector('.farm-cell-icon').textContent = 'üîÑ';
                        
                        setTimeout(() => {
                            crop.querySelector('.farm-cell-icon').textContent = 'üå±';
                            crop.classList.remove('harvest-animation');
                        }, 500);
                    }
                });
                
                if (harvested > 0) {
                    const coinsEarned = harvested * 15;
                    showNotification('üì¶ –£—Ä–æ–∂–∞–π —Å–æ–±—Ä–∞–Ω!', `–°–æ–±—Ä–∞–Ω–æ ${harvested} –∫—É–ª—å—Ç—É—Ä. –ü–æ–ª—É—á–µ–Ω–æ ${coinsEarned} –º–æ–Ω–µ—Ç!`);
                    updateCoins(coinsEarned);
                } else {
                    showNotification('‚ö†Ô∏è –ù–µ—á–µ–≥–æ —Å–æ–±–∏—Ä–∞—Ç—å', '–†–∞—Å—Ç–µ–Ω–∏—è –µ—â–µ –Ω–µ —Å–æ–∑—Ä–µ–ª–∏. –ü–æ–ª–∏–≤–∞–π—Ç–µ –∏—Ö –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Ä–æ—Å—Ç–∞.');
                }
            },
            
            plantCrop: function() {
                // –ù–∞—Ö–æ–¥–∏–º –ø—É—Å—Ç—É—é –∫–ª–µ—Ç–∫—É
                const emptyCells = document.querySelectorAll('.farm-cell.empty');
                if (emptyCells.length > 0) {
                    const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                    
                    // –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤ –ø–æ—Å–µ–≤
                    randomCell.className = 'farm-cell crop';
                    randomCell.querySelector('.farm-cell-icon').textContent = 'üå±';
                    randomCell.classList.add('grow-animation');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                    const row = parseInt(randomCell.dataset.row);
                    const col = parseInt(randomCell.dataset.col);
                    const cellData = farmData.cells.find(c => c.row === row && c.col === col);
                    if (cellData) {
                        cellData.type = 'crop';
                        cellData.growth = 10;
                        cellData.water = 50;
                    }
                    
                    showNotification('üå± –ù–æ–≤—ã–µ –ø–æ—Å–∞–¥–∫–∏', '–í—ã –ø–æ—Å–∞–¥–∏–ª–∏ —Å–µ–º–µ–Ω–∞ –ø—à–µ–Ω–∏—Ü—ã. –ß–µ—Ä–µ–∑ 3 –¥–Ω—è –±—É–¥–µ—Ç —É—Ä–æ–∂–∞–π!');
                    updateCoins(-10); // –°—Ç–æ–∏–º–æ—Å—Ç—å —Å–µ–º—è–Ω
                } else {
                    showNotification('‚ö†Ô∏è –ù–µ—Ç –º–µ—Å—Ç–∞', '–ù–∞ —Ñ–µ—Ä–º–µ –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –¥–ª—è –ø–æ—Å–∞–¥–∫–∏!');
                }
            },
            
            buildHouse: function() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–æ–º
                const hasHouse = document.querySelector('.farm-cell.house');
                if (!hasHouse) {
                    // –ù–∞—Ö–æ–¥–∏–º —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é –∫–ª–µ—Ç–∫—É
                    const centerCell = document.querySelector('.farm-cell[data-row="3"][data-col="3"]');
                    if (centerCell && centerCell.classList.contains('empty')) {
                        centerCell.className = 'farm-cell house';
                        centerCell.querySelector('.farm-cell-icon').textContent = 'üè†';
                        centerCell.classList.add('grow-animation');
                        
                        showNotification('üè† –î–æ–º –ø–æ—Å—Ç—Ä–æ–µ–Ω!', '–í–∞—à –Ω–æ–≤—ã–π –¥–æ–º –≥–æ—Ç–æ–≤. –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∂–∏—Ç—å –Ω–∞ —Ñ–µ—Ä–º–µ!');
                        updateCoins(-100);
                    }
                } else {
                    showNotification('üè† –£–∂–µ –µ—Å—Ç—å', '–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –¥–æ–º –Ω–∞ —Ñ–µ—Ä–º–µ!');
                }
            },
            
            upgradeFarm: function() {
                if (userData && userData.coins >= 200) {
                    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–µ—Ä–º—ã
                    farmData.size = Math.min(10, farmData.size + 1);
                    
                    // –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º —Ñ–µ—Ä–º—É
                    createFarm();
                    
                    showNotification('‚¨ÜÔ∏è –§–µ—Ä–º–∞ —É–ª—É—á—à–µ–Ω–∞!', '–†–∞–∑–º–µ—Ä —Ñ–µ—Ä–º—ã —É–≤–µ–ª–∏—á–µ–Ω. –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –±–æ–ª—å—à–µ –º–µ—Å—Ç–∞ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–∫!');
                    updateCoins(-200);
                } else {
                    showNotification('‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç', '–î–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ñ–µ—Ä–º—ã –Ω—É–∂–Ω–æ 200 –º–æ–Ω–µ—Ç.');
                }
            },
            
            sellProduce: function() {
                // –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ–¥–∞–∂–∏ —É—Ä–æ–∂–∞—è
                const saleAmount = Math.floor(Math.random() * 100) + 50;
                showNotification('üí∞ –ü—Ä–æ–¥–∞–∂–∞ —É—Ä–æ–∂–∞—è', `–í—ã –ø—Ä–æ–¥–∞–ª–∏ —É—Ä–æ–∂–∞–π –∑–∞ ${saleAmount} –º–æ–Ω–µ—Ç!`);
                updateCoins(saleAmount);
            }
        };
        
        // –°—Ç–∞—Ä—Ç –∑–∞–≥—Ä—É–∑–∫–∏
        function startLoading() {
            let progress = 0;
            const progressBar = document.getElementById('loading-progress');
            const progressPercent = document.getElementById('loading-percent');
            
            const interval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress > 100) progress = 100;
                
                if (progressBar) progressBar.style.width = progress + '%';
                if (progressPercent) progressPercent.textContent = Math.round(progress) + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('loading-screen').style.display = 'none';
                        document.getElementById('main-screen').style.display = 'block';
                        showScreen('main');
                    }, 500);
                }
            }, 200);
        }
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function registerUser() {
            if (!currentUserId) return;
            
            try {
                const response = await fetch('/api/user', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        telegramId: currentUserId,
                        username: currentUser?.username,
                        firstName: currentUser?.first_name,
                        lastName: currentUser?.last_name
                    })
                });
                
                userData = await response.json();
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', userData);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateUserStats();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
                userData = userData || {
                    level: 1,
                    coins: 100,
                    experience: 0,
                    lessonsCompleted: 0,
                    streak: 1,
                    codeLines: 0,
                    problemsSolved: 0,
                    rank: '#999'
                };
                
                updateUserStats();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateUserStats() {
            if (!userData) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
            const stats = {
                'user-level-value': userData.level || 1,
                'user-coins-value': userData.coins || 100,
                'user-exp-value': userData.experience || 0,
                'user-lessons-value': userData.lessonsCompleted || 0,
                'header-coins': userData.coins || 100,
                'header-level': '–£—Ä. ' + (userData.level || 1),
                'completed-lessons': userData.lessonsCompleted || 0,
                'user-level-text': userData.level || 1,
                'profile-streak': userData.streak || 1,
                'profile-lines': userData.codeLines || 0,
                'profile-solved': userData.problemsSolved || 0,
                'profile-rank': userData.rank || '#-'
            };
            
            for (const [id, value] of Object.entries(stats)) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —É—Ä–æ–∫–æ–≤
            const lessonsProgress = document.getElementById('lessons-progress');
            if (lessonsProgress) {
                const progress = ((userData.lessonsCompleted || 0) / 28) * 100;
                lessonsProgress.style.width = progress + '%';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è
        function updateProfileInfo() {
            if (!currentUser) return;
            
            document.getElementById('profile-name').textContent = 
                currentUser.first_name || '–§–µ—Ä–º–µ—Ä';
            document.getElementById('profile-username').textContent = 
                currentUser.username ? '@' + currentUser.username : '–ë–µ–∑ username';
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–æ–≤
        async function loadLessonsData() {
            try {
                const response = await fetch('/api/lessons');
                lessonsData = await response.json();
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —É—Ä–æ–∫–∏
                renderLessons();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤:', error);
                
                // –°–æ–∑–¥–∞–µ–º –¥–µ–º–æ-—É—Ä–æ–∫–∏
                lessonsData = [
                    {
                        id: 'lesson_1',
                        title: '–ü–µ—Ä–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç—É-–ø–æ–º–æ—â–Ω–∏–∫—É',
                        description: '–ù–∞—É—á–∏—Ç–µ—Å—å –¥–∞–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç—É',
                        level: 1,
                        experience: 100,
                        coins: 50,
                        completed: true,
                        theory: '–û—Å–Ω–æ–≤—ã —Ä–∞–±–æ—Ç—ã —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ print() –∏ bot_say()',
                        task: '–ù–∞–ø–∏—à–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –±–æ—Ç–∞',
                        initialCode: 'print("–ü—Ä–∏–≤–µ—Ç, –ê–≥—Ä–æ–ë–æ—Ç!")'
                    },
                    {
                        id: 'lesson_2',
                        title: '–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ - –ü—Ä–æ–µ–∫—Ç —Ñ–µ—Ä–º—ã',
                        description: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ —Ñ–µ—Ä–º—ã',
                        level: 1,
                        experience: 150,
                        coins: 75,
                        completed: false,
                        theory: '–†–∞–±–æ—Ç–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö',
                        task: '–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–µ—Ä–º—ã –∏ –ø–ª–æ—â–∞–¥–∏',
                        initialCode: 'farm_name = "–°–æ–ª–Ω–µ—á–Ω–∞—è –¥–æ–ª–∏–Ω–∞"\narea = 100'
                    },
                    {
                        id: 'lesson_3',
                        title: '–§—É–Ω–∫—Ü–∏–∏ - –†–∞—Å—á–∏—Å—Ç–∫–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏',
                        description: '–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Ö–Ω–∏–∫–æ–π',
                        level: 1,
                        experience: 200,
                        coins: 100,
                        completed: false,
                        theory: '–°–æ–∑–¥–∞–Ω–∏–µ –∏ –≤—ã–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π',
                        task: '–°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç—Ä–∞–∫—Ç–æ—Ä–∞',
                        initialCode: 'def start_tractor():\n    print("–ó–∞–ø—É—Å–∫–∞—é —Ç—Ä–∞–∫—Ç–æ—Ä...")'
                    },
                    {
                        id: 'lesson_4',
                        title: '–ê—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π - –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –¥–æ–º–∞',
                        description: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏',
                        level: 2,
                        experience: 250,
                        coins: 125,
                        completed: false,
                        theory: '–†–∞–±–æ—Ç–∞ —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ —Ñ—É–Ω–∫—Ü–∏–π',
                        task: '–°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏',
                        initialCode: 'def build_house(material, floors):\n    print(f"–°—Ç—Ä–æ—é {floors}-—ç—Ç–∞–∂–Ω—ã–π –¥–æ–º –∏–∑ {material}")'
                    }
                ];
                
                renderLessons();
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–∫–æ–≤
        function renderLessons() {
            const container = document.getElementById('lessons-list');
            if (!container || !lessonsData.length) return;
            
            container.innerHTML = '';
            
            lessonsData.slice(0, 6).forEach((lesson, index) => {
                const lessonElement = document.createElement('div');
                lessonElement.className = 'lesson-card fade-in';
                lessonElement.style.animationDelay = (index * 0.1) + 's';
                
                const statusClass = lesson.completed ? 'status-completed' : 
                                  index === 0 ? 'status-in-progress' : 'status-locked';
                
                lessonElement.innerHTML = `
                    <div class="lesson-header">
                        <div class="lesson-number">${index + 1}</div>
                        <div class="lesson-status ${statusClass}"></div>
                    </div>
                    <h3 style="margin-bottom: 10px;">${lesson.title}</h3>
                    <p style="color: #666; margin-bottom: 15px;">${lesson.description}</p>
                    
                    <div class="lesson-rewards">
                        <div class="reward-item">
                            <i class="fas fa-coins"></i>
                            <span>${lesson.coins} –º–æ–Ω–µ—Ç</span>
                        </div>
                        <div class="reward-item">
                            <i class="fas fa-star"></i>
                            <span>${lesson.experience} –æ–ø—ã—Ç–∞</span>
                        </div>
                        <div class="reward-item">
                            <i class="fas fa-layer-group"></i>
                            <span>–£—Ä–æ–≤–µ–Ω—å ${lesson.level}</span>
                        </div>
                    </div>
                    
                    card.innerHTML = `
    ...
    <button class="start-lesson-btn" 
            onclick="window.startLesson('${lesson.id}')"
            ${!available ? 'disabled' : ''}>
        ${completed ? '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —É—Ä–æ–∫' : available ? '–ù–∞—á–∞—Ç—å —É—Ä–æ–∫' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ'}
    </button>
`;
                
                container.appendChild(lessonElement);
            });
        }
        
        // –û—Ç–∫—Ä—ã—Ç—å —É—Ä–æ–∫
        function openLesson(lessonId) {
            const lesson = lessonsData.find(l => l.id === lessonId);
            if (!lesson) return;
            
            currentLesson = lesson;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('modal-lesson-title').textContent = 
                `–£—Ä–æ–∫ ${lessonId.split('_')[1]}: ${lesson.title}`;
            document.getElementById('modal-lesson-content').innerHTML = `
                <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${lesson.description}</p>
                <p><strong>–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</strong> ${lesson.level}</p>
                <p><strong>–ù–∞–≥—Ä–∞–¥–∞:</strong> ${lesson.coins} ü™ô –º–æ–Ω–µ—Ç –∏ ${lesson.experience} ‚ú® –æ–ø—ã—Ç–∞</p>
                <div style="background: #f0f9ff; padding: 15px; border-radius: 10px; margin-top: 15px;">
                    <strong>–ó–∞–¥–∞–Ω–∏–µ:</strong>
                    <p style="margin-top: 5px;">${lesson.task}</p>
                </div>
            `;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('lesson-modal').classList.add('show');
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function closeModal() {
            document.getElementById('lesson-modal').classList.remove('show');
        }
        
        // –ù–∞—á–∞—Ç—å —É—Ä–æ–∫
        function startLesson(lessonId) {
            const lesson = lessonsData.find(l => l.id === lessonId);
            if (!lesson) return;
            
            currentLesson = lesson;
            showScreen('code');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —É—Ä–æ–∫–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
            document.getElementById('current-lesson-title').textContent = 
                `–£—Ä–æ–∫ ${lessonId.split('_')[1]}: ${lesson.title}`;
            document.getElementById('current-lesson-desc').textContent = 
                lesson.description;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥
            const codeEditor = document.getElementById('code-editor');
            if (codeEditor) {
                codeEditor.value = lesson.initialCode || `# –ö–æ–¥ –¥–ª—è —É—Ä–æ–∫–∞: ${lesson.title}\n# –ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å —Å–≤–æ–π –∫–æ–¥ –∑–¥–µ—Å—å...`;
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É
                setTimeout(() => {
                    codeEditor.style.height = 'auto';
                    codeEditor.style.height = (codeEditor.scrollHeight) + 'px';
                }, 100);
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
            const hintsContainer = document.getElementById('hints-container');
            if (hintsContainer) {
                hintsContainer.innerHTML = `
                    <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                        <div style="font-size: 24px; color: var(--accent-color);">üí°</div>
                        <div>
                            <h4 style="margin-bottom: 5px;">–¢–µ–æ—Ä–∏—è —É—Ä–æ–∫–∞</h4>
                            <p style="color: #666; margin: 0;">${lesson.theory || '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è.'}</p>
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px;">
                        <div style="font-size: 24px; color: var(--secondary-color);">üéØ</div>
                        <div>
                            <h4 style="margin-bottom: 5px;">–ó–∞–¥–∞–Ω–∏–µ</h4>
                            <p style="color: #666; margin: 0;">${lesson.task}</p>
                        </div>
                    </div>
                `;
            }
        }
        
        // –ù–∞—á–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —É—Ä–æ–∫
        function startSelectedLesson() {
            if (!currentLesson) return;
            closeModal();
            startLesson(currentLesson.id);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω
        function showScreen(screenName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
            const screens = ['main', 'lessons', 'code', 'profile'];
            screens.forEach(screen => {
                const element = document.getElementById(screen + '-screen');
                if (element) {
                    element.style.display = 'none';
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π —ç–∫—Ä–∞–Ω
            const targetScreen = document.getElementById(screenName + '-screen');
            if (targetScreen) {
                targetScreen.style.display = 'block';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            updateNavigation(screenName);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥" –≤ Telegram
            if (window.Telegram && Telegram.WebApp) {
                if (screenName === 'main') {
                    Telegram.WebApp.BackButton.hide();
                } else {
                    Telegram.WebApp.BackButton.show();
                }
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–≤–æ–¥ –∫–æ–¥–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            const outputContainer = document.getElementById('output-container');
            if (outputContainer) {
                outputContainer.style.display = screenName === 'code' ? 'block' : 'none';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function updateNavigation(activeScreen) {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.classList.remove('active');
                if (item.onclick && item.onclick.toString().includes(activeScreen)) {
                    item.classList.add('active');
                }
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫–æ–¥–∞
        function initCodeEditor() {
            const codeEditor = document.getElementById('code-editor');
            if (codeEditor) {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã –ø—Ä–∏ –≤–≤–æ–¥–µ
                codeEditor.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥
                codeEditor.value = `# –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ CodeFarm!
# –ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∫–æ–¥ Python

print("–ü—Ä–∏–≤–µ—Ç, —Ñ–µ—Ä–º–µ—Ä!")
print("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –≤–∞—à—É –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é —Ñ–µ—Ä–º—É!")

# –ó–∞–¥–∞–Ω–∏–µ: –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –±–æ—Ç–∞
# bot_say("–ù–∞—á–∏–Ω–∞—é —Ä–∞–±–æ—Ç—É")`;
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É
                setTimeout(() => {
                    codeEditor.style.height = 'auto';
                    codeEditor.style.height = (codeEditor.scrollHeight) + 'px';
                }, 100);
            }
        }
        
        // –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–¥
        function runCode() {
            const code = document.getElementById('code-editor').value;
            const output = document.getElementById('output-text');
            const outputContainer = document.getElementById('output-container');
            
            if (output && outputContainer) {
                // –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞
                output.textContent = '>>> –ó–∞–ø—É—Å–∫–∞—é –∫–æ–¥...\n\n';
                
                // –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞
                const lines = code.split('\n');
                let lineNumber = 1;
                
                lines.forEach((line) => {
                    if (line.trim() && !line.trim().startsWith('#')) {
                        setTimeout(() => {
                            output.textContent += `[–°—Ç—Ä–æ–∫–∞ ${lineNumber}] ${line.trim()}\n`;
                            
                            // –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞ print()
                            if (line.includes('print(') && line.includes(')')) {
                                const match = line.match(/print\(["'](.+?)["']\)/);
                                if (match) {
                                    output.textContent += match[1] + '\n';
                                }
                            }
                            
                            // –ò–º–∏—Ç–∞—Ü–∏—è bot_say
                            if (line.includes('bot_say(') && line.includes(')')) {
                                const match = line.match(/bot_say\(["'](.+?)["']\)/);
                                if (match) {
                                    output.textContent += 'ü§ñ –ë–æ—Ç –≥–æ–≤–æ—Ä–∏—Ç: "' + match[1] + '"\n';
                                }
                            }
                            
                            // –ò–º–∏—Ç–∞—Ü–∏—è clear_area
                            if (line.includes('clear_area(') && line.includes(')')) {
                                const match = line.match(/clear_area\(["'](.+?)["']\)/);
                                if (match) {
                                    output.textContent += 'üöú –†–∞—Å—á–∏—â–∞—é —É—á–∞—Å—Ç–æ–∫: ' + match[1] + '\n';
                                }
                            }
                            
                            lineNumber++;
                        }, lineNumber * 200);
                    }
                });
                
                setTimeout(() => {
                    output.textContent += '\n>>> –ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ! ‚úÖ';
                    outputContainer.style.display = 'block';
                    
                    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
                    outputContainer.scrollTop = outputContainer.scrollHeight;
                }, lines.length * 200 + 500);
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
        async function submitCode() {
            if (!currentUserId) {
                showNotification('‚ùå –û—à–∏–±–∫–∞', '–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                return;
            }
            
            const code = document.getElementById('code-editor').value;
            if (!code.trim()) {
                showNotification('‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ', '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏');
                return;
            }
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–π —É—Ä–æ–∫ –∏–ª–∏ –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                const lessonId = currentLesson?.id || 'lesson_1';
                
                const response = await fetch(`/api/lessons/${lessonId}/submit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        userId: currentUserId,
                        code: code
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('üéâ –£—Å–ø–µ—Ö!', `–£—Ä–æ–∫ "${currentLesson?.title || '–£—Ä–æ–∫ 1'}" –ø—Ä–æ–π–¥–µ–Ω! –ù–∞–≥—Ä–∞–¥–∞: ${result.reward || 50} –º–æ–Ω–µ—Ç`);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–Ω–µ—Ç—ã
                    if (result.coins) {
                        updateCoins(result.reward || 50);
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    if (userData) {
                        userData.lessonsCompleted = (userData.lessonsCompleted || 0) + 1;
                        userData.experience = (userData.experience || 0) + 100;
                        userData.codeLines = (userData.codeLines || 0) + code.split('\n').length;
                        userData.problemsSolved = (userData.problemsSolved || 0) + 1;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
                        if (userData.experience >= (userData.level || 1) * 1000) {
                            userData.level = (userData.level || 1) + 1;
                            showNotification('‚≠ê –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å!', `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —É—Ä–æ–≤–Ω—è ${userData.level}!`);
                        }
                        
                        updateUserStats();
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é —É—Å–ø–µ—Ö–∞
                    showSuccessAnimation();
                    
                } else {
                    showNotification('‚ùå –û—à–∏–±–∫–∞', result.message || '–ï—Å—Ç—å –æ—à–∏–±–∫–∏ –≤ –∫–æ–¥–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–π –∫–æ–¥ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
                
                // –ò–º–∏—Ç–∞—Ü–∏—è —É—Å–ø–µ—Ö–∞ –¥–ª—è –¥–µ–º–æ
                showNotification('üéâ –î–µ–º–æ: –£—Ä–æ–∫ –ø—Ä–æ–π–¥–µ–Ω!', `–£—Ä–æ–∫ "${currentLesson?.title || '–£—Ä–æ–∫ 1'}" –ø—Ä–æ–π–¥–µ–Ω! –ù–∞–≥—Ä–∞–¥–∞: 50 –º–æ–Ω–µ—Ç (–¥–µ–º–æ-—Ä–µ–∂–∏–º)`);
                updateCoins(50);
                showSuccessAnimation();
            }
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–≤–æ–¥
        function clearOutput() {
            const output = document.getElementById('output-text');
            if (output) output.textContent = '';
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–Ω–µ—Ç
        function updateCoins(amount) {
            if (userData) {
                userData.coins = (userData.coins || 0) + amount;
                updateUserStats();
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –º–æ–Ω–µ—Ç
                const coinElement = document.getElementById('header-coins');
                if (coinElement) {
                    coinElement.classList.add('pulse');
                    setTimeout(() => {
                        coinElement.classList.remove('pulse');
                    }, 1000);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ
                if (amount > 0) {
                    showNotification('üí∞ ' + (amount > 0 ? '–ü–æ–ª—É—á–µ–Ω–æ' : '–ü–æ—Ç—Ä–∞—á–µ–Ω–æ'), Math.abs(amount) + ' –º–æ–Ω–µ—Ç');
                }
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é —É—Å–ø–µ—Ö–∞
        function showSuccessAnimation() {
            // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –ø—É–ª—å—Å–∞—Ü–∏–∏ –∫ –∫–Ω–æ–ø–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
            const submitBtn = document.querySelector('.editor-actions .btn-primary');
            if (submitBtn) {
                submitBtn.classList.add('pulse');
                setTimeout(() => {
                    submitBtn.classList.remove('pulse');
                }, 2000);
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(title, message) {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notification-title');
            const notificationMessage = document.getElementById('notification-message');
            
            if (notification && notificationTitle && notificationMessage) {
                notificationTitle.textContent = title;
                notificationMessage.textContent = message;
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∏–ø —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                notification.className = 'notification';
                if (title.includes('üéâ') || title.includes('–£—Å–ø–µ—Ö')) {
                    notification.classList.add('notification-success');
                } else if (title.includes('‚ùå') || title.includes('–û—à–∏–±–∫–∞')) {
                    notification.classList.add('notification-error');
                } else {
                    notification.classList.add('notification-info');
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                notification.classList.add('show');
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 5000);
            }
        }
    <script>
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–µ—Ä–º—ã
async function loadFarmVisualization() {
    if (!currentUserId) return;
    
    try {
        const response = await fetch(`/api/farm/${currentUserId}/visual`);
        const farm = await response.json();
        
        renderFarm(farm);
        updateFarmStats(farm);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–µ—Ä–º—ã:', error);
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ–º–æ-—Ñ–µ—Ä–º—É
        showDemoFarm();
    }
}

// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ñ–µ—Ä–º—ã
function renderFarm(farmData) {
    const farmGrid = document.getElementById('farm-grid');
    if (!farmGrid) return;
    
    farmGrid.innerHTML = '';
    farmGrid.style.gridTemplateColumns = `repeat(${farmData.width}, 1fr)`;
    farmGrid.style.gridTemplateRows = `repeat(${farmData.height}, 1fr)`;
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–ª–µ—Ç–∫–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    farmData.cells.sort((a, b) => {
        if (a.y !== b.y) return a.y - b.y;
        return a.x - b.x;
    });
    
    farmData.cells.forEach(cell => {
        const cellElement = document.createElement('div');
        cellElement.className = `farm-cell ${cell.type}`;
        cellElement.dataset.x = cell.x;
        cellElement.dataset.y = cell.y;
        
        // –°–æ–∑–¥–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–ª–µ—Ç–∫–∏
        let content = cell.emoji;
        let title = '';
        
        switch(cell.type) {
            case 'overgrown':
                content = 'üåø';
                title = '–ó–∞—Ä–æ—Å—à–∏–π —É—á–∞—Å—Ç–æ–∫. –ù—É–∂–Ω–æ —Ä–∞—Å—á–∏—Å—Ç–∏—Ç—å!';
                break;
            case 'building':
                if (cell.buildingType === 'house') {
                    content = 'üè†';
                    title = '–í–∞—à –¥–æ–º';
                } else if (cell.buildingType === 'greenhouse') {
                    content = 'üåø';
                    title = '–£–º–Ω–∞—è —Ç–µ–ø–ª–∏—Ü–∞';
                } else {
                    content = 'üèóÔ∏è';
                    title = '–ü–æ—Å—Ç—Ä–æ–π–∫–∞';
                }
                break;
            case 'crop':
                if (cell.cropType === 'wheat') {
                    content = 'üåæ';
                    title = `–ü—à–µ–Ω–∏—Ü–∞ (—Ä–æ—Å—Ç: ${cell.cropGrowth}%)`;
                } else if (cell.cropType === 'carrot') {
                    content = 'ü•ï';
                    title = `–ú–æ—Ä–∫–æ–≤—å (—Ä–æ—Å—Ç: ${cell.cropGrowth}%)`;
                } else if (cell.cropType === 'potato') {
                    content = 'ü•î';
                    title = `–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å (—Ä–æ—Å—Ç: ${cell.cropGrowth}%)`;
                } else {
                    content = 'üå±';
                    title = '–†–∞—Å—Ç–µ–Ω–∏–µ';
                }
                break;
            case 'cleared':
                content = 'üü´';
                title = '–û—á–∏—â–µ–Ω–Ω–∞—è –∑–µ–º–ª—è. –ì–æ—Ç–æ–≤–∞ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–π–∫–∏ –∏–ª–∏ –ø–æ—Å–∞–¥–∫–∏.';
                break;
            case 'plowed':
                content = 'üü®';
                title = '–í—Å–ø–∞—Ö–∞–Ω–Ω–æ–µ –ø–æ–ª–µ. –ì–æ—Ç–æ–≤–æ –¥–ª—è –ø–æ—Å–∞–¥–∫–∏.';
                break;
            default:
                content = cell.emoji;
                title = cell.type;
        }
        
        cellElement.innerHTML = `
            <div class="farm-cell-content">${content}</div>
            <div class="farm-cell-coords">${cell.x},${cell.y}</div>
        `;
        cellElement.title = title;
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏
        cellElement.style.background = cell.color;
        cellElement.style.border = '1px solid rgba(0,0,0,0.1)';
        cellElement.style.display = 'flex';
        cellElement.style.flexDirection = 'column';
        cellElement.style.alignItems = 'center';
        cellElement.style.justifyContent = 'center';
        cellElement.style.fontSize = '20px';
        cellElement.style.position = 'relative';
        cellElement.style.cursor = 'pointer';
        cellElement.style.transition = 'all 0.3s';
        
        // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
        cellElement.addEventListener('mouseenter', () => {
            cellElement.style.transform = 'scale(1.1)';
            cellElement.style.zIndex = '10';
            cellElement.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
        });
        
        cellElement.addEventListener('mouseleave', () => {
            cellElement.style.transform = 'scale(1)';
            cellElement.style.zIndex = '1';
            cellElement.style.boxShadow = 'none';
        });
        
        // –ö–ª–∏–∫ –ø–æ –∫–ª–µ—Ç–∫–µ
        cellElement.addEventListener('click', () => {
            showCellInfo(cell);
        });
        
        farmGrid.appendChild(cellElement);
    });
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–ª–µ—Ç–∫–µ
function showCellInfo(cell) {
    let info = '';
    
    switch(cell.type) {
        case 'overgrown':
            info = `üåø –ó–∞—Ä–æ—Å—à–∏–π —É—á–∞—Å—Ç–æ–∫ (${cell.x},${cell.y})
                    \n–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞—Å—á–∏—Å—Ç–∫–∞. –ü—Ä–æ–π–¥–∏—Ç–µ —É—Ä–æ–∫ 1!`;
            break;
        case 'building':
            if (cell.buildingType === 'house') {
                info = `üè† –í–∞—à –¥–æ–º (${cell.x},${cell.y})
                        \n–ì–ª–∞–≤–Ω–æ–µ –∑–¥–∞–Ω–∏–µ —Ñ–µ—Ä–º—ã. –ó–¥–µ—Å—å –≤—ã –æ—Ç–¥—ã—Ö–∞–µ—Ç–µ –∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Ä–∞–±–æ—Ç—ã.`;
            } else if (cell.buildingType === 'greenhouse') {
                info = `üåø –£–º–Ω–∞—è —Ç–µ–ø–ª–∏—Ü–∞ (${cell.x},${cell.y})
                        \n–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è —Ä–∞—Å—Ç–µ–Ω–∏–π.`;
            }
            break;
        case 'crop':
            info = `${cell.emoji} ${getCropName(cell.cropType)} (${cell.x},${cell.y})
                    \n–†–æ—Å—Ç: ${cell.cropGrowth}%
                    \n–°–æ—Å—Ç–æ—è–Ω–∏–µ: ${cell.cropGrowth >= 80 ? '–ì–æ—Ç–æ–≤ –∫ —Å–±–æ—Ä—É' : '–†–∞—Å—Ç–µ—Ç'}`;
            break;
        case 'cleared':
            info = `üü´ –û—á–∏—â–µ–Ω–Ω–∞—è –∑–µ–º–ª—è (${cell.x},${cell.y})
                    \n–ì–æ—Ç–æ–≤–∞ –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –∏–ª–∏ –ø–æ—Å–∞–¥–∫–∏ —Ä–∞—Å—Ç–µ–Ω–∏–π.`;
            break;
        case 'plowed':
            info = `üü® –í—Å–ø–∞—Ö–∞–Ω–Ω–æ–µ –ø–æ–ª–µ (${cell.x},${cell.y})
                    \n–ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –¥–ª—è –ø–æ—Å–∞–¥–∫–∏ –∫—É–ª—å—Ç—É—Ä.`;
            break;
    }
    
    showNotification('üåæ –§–µ—Ä–º–∞', info);
}

function getCropName(type) {
    const names = {
        'wheat': '–ü—à–µ–Ω–∏—Ü–∞',
        'carrot': '–ú–æ—Ä–∫–æ–≤—å',
        'potato': '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å'
    };
    return names[type] || type;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ñ–µ—Ä–º—ã
function updateFarmStats(farmData) {
    const stats = {
        clearedLand: farmData.stats.clearedLand || 0,
        buildings: farmData.buildings.length || 0,
        crops: farmData.crops.length || 0,
        completedLessons: farmData.stats.completedLessons || 0
    };
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    document.getElementById('cleared-land-count').textContent = stats.clearedLand;
    document.getElementById('buildings-count').textContent = stats.buildings;
    document.getElementById('crops-count').textContent = stats.crops;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
    const progress = (stats.completedLessons / 28) * 100;
    document.getElementById('farm-progress-bar').style.width = `${progress}%`;
}

// –î–µ–º–æ-—Ñ–µ—Ä–º–∞ –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å
function showDemoFarm() {
    const farmGrid = document.getElementById('farm-grid');
    if (!farmGrid) return;
    
    // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç—É—é –¥–µ–º–æ-—Ñ–µ—Ä–º—É
    farmGrid.innerHTML = '';
    
    for (let y = 0; y < 8; y++) {
        for (let x = 0; x < 8; x++) {
            const cell = document.createElement('div');
            cell.className = 'farm-cell';
            
            // –¶–µ–Ω—Ç—Ä - –¥–æ–º
            if (x === 3 && y === 3) {
                cell.innerHTML = 'üè†';
                cell.style.background = '#FF9800';
                cell.title = '–í–∞—à –¥–æ–º';
            }
            // –ó–∞—Ä–æ—Å—à–∏–µ —É—á–∞—Å—Ç–∫–∏
            else if (x < 3 || y < 3) {
                cell.innerHTML = 'üåø';
                cell.style.background = '#2E7D32';
                cell.title = '–ó–∞—Ä–æ—Å—à–∏–π —É—á–∞—Å—Ç–æ–∫';
            }
            // –û—á–∏—â–µ–Ω–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏
            else {
                cell.innerHTML = 'üü´';
                cell.style.background = '#8D6E63';
                cell.title = '–û—á–∏—â–µ–Ω–Ω–∞—è –∑–µ–º–ª—è';
            }
            
            cell.style.display = 'flex';
            cell.style.alignItems = 'center';
            cell.style.justifyContent = 'center';
            cell.style.fontSize = '20px';
            cell.style.border = '1px solid rgba(0,0,0,0.1)';
            cell.style.cursor = 'pointer';
            
            farmGrid.appendChild(cell);
        }
    }
}

 // –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è app.js
    let app = null;
    
    function showScreen(screenName) {
        console.log('showScreen –≤—ã–∑–≤–∞–Ω:', screenName);
        if (app && app.showScreen) {
            app.showScreen(screenName);
        } else {
            // –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
            document.querySelectorAll('[id$="-screen"]').forEach(el => {
                el.style.display = 'none';
            });
            const target = document.getElementById(screenName + '-screen');
            if (target) target.style.display = 'block';
        }
    }
    
    function runCode() {
        console.log('–ó–∞–ø—É—Å–∫ –∫–æ–¥–∞');
        if (app && app.runCode) app.runCode();
    }
    
    function submitCode() {
        console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞');
        if (app && app.submitSolution) app.submitSolution();
    }
    
    function startLesson(lessonId) {
        console.log('–ù–∞—á–∞–ª–æ —É—Ä–æ–∫–∞:', lessonId);
        if (app && app.startLesson) app.startLesson(lessonId);
    }
    
    function clearOutput() {
        console.log('–û—á–∏—Å—Ç–∫–∞ –≤—ã–≤–æ–¥–∞');
        if (app && app.clearOutput) app.clearOutput();
    }
    
    // –ö–æ–≥–¥–∞ app.js –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è, –æ–Ω –æ–±–Ω–æ–≤–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é app
    window.setAppInstance = (instance) => {
        app = instance;
        console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
    };
</script>
</body>
</html>
