<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeFarm - –£—á–∏–º Python —á–µ—Ä–µ–∑ —Ñ–µ—Ä–º–µ—Ä—Å—Ç–≤–æ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-color: #4CAF50;
            --primary-dark: #2E7D32;
            --secondary-color: #2196F3;
            --accent-color: #FF9800;
            --text-color: #333;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-radius: 16px;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-color);
            overflow-x: hidden;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        .app-container {
            max-width: 100%;
            min-height: 100vh;
            background: var(--bg-color);
            margin: 0 auto;
            position: relative;
        }
        
        /* –®–∞–ø–∫–∞ */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            font-size: 32px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .logo h1 {
            font-size: 22px;
            margin: 0;
            font-weight: 700;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —à–∞–ø–∫–µ */
        .header-stats {
            display: flex;
            gap: 15px;
        }
        
        .stat-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
        
        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .content {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* –°–µ–∫—Ü–∏–∏ */
        .section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 24px;
            color: var(--primary-dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--primary-color);
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 28px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            text-align: center;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary-color), #0D47A1);
            color: white;
        }
        
        .btn-accent {
            background: linear-gradient(135deg, var(--accent-color), #EF6C00);
            color: white;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(0,0,0,0.05);
        }
        
        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-dark);
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        /* 2D –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–µ—Ä–º—ã */
        .farm-visualization {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border-radius: var(--border-radius);
            padding: 20px;
            margin: 25px 0;
            border: 3px solid var(--primary-color);
            position: relative;
            overflow: hidden;
            min-height: 300px;
        }
        
        .farm-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 5px;
            width: 100%;
            height: 300px;
            margin: 0 auto;
        }
        
        .farm-cell {
            background: #8BC34A;
            border: 1px solid #7CB342;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .farm-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 10;
        }
        
        .farm-cell.house { background: #FF9800; }
        .farm-cell.barn { background: #795548; }
        .farm-cell.greenhouse { background: #4CAF50; }
        .farm-cell.crop { background: #FFEB3B; }
        .farm-cell.tree { background: #8BC34A; }
        .farm-cell.water { background: #2196F3; }
        .farm-cell.empty { background: #C8E6C9; }
        
        .farm-cell-label {
            position: absolute;
            bottom: 2px;
            font-size: 10px;
            color: rgba(0,0,0,0.7);
            font-weight: bold;
        }
        
        .farm-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .farm-btn {
            background: white;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .farm-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-3px);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ —Ñ–µ—Ä–º—ã */
        @keyframes grow {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes water {
            0% { transform: translateY(-20px); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(20px); opacity: 0; }
        }
        
        @keyframes harvest {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .grow-animation {
            animation: grow 0.5s ease-out;
        }
        
        .water-animation::after {
            content: 'üíß';
            position: absolute;
            animation: water 1s linear;
        }
        
        .harvest-animation {
            animation: harvest 0.5s ease-in-out;
        }
        
        /* –£—Ä–æ–∫–∏ */
        .lessons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .lesson-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .lesson-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }
        
        .lesson-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.15);
        }
        
        .lesson-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .lesson-number {
            background: var(--primary-color);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }
        
        .lesson-status {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        .status-completed { background: #4CAF50; }
        .status-in-progress { background: #FFC107; }
        .status-locked { background: #9E9E9E; }
        
        .lesson-rewards {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .reward-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: #f0f9ff;
            padding: 5px 10px;
            border-radius: 15px;
        }
        
        /* –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞ */
        .code-editor-container {
            background: #1e1e1e;
            border-radius: 15px;
            overflow: hidden;
            margin: 25px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .editor-toolbar {
            background: #252526;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
        }
        
        .editor-actions {
            display: flex;
            gap: 10px;
        }
        
        #code-editor {
            width: 100%;
            min-height: 300px;
            background: #1e1e1e;
            color: #d4d4d4;
            border: none;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: vertical;
            outline: none;
        }
        
        .output-container {
            background: #252526;
            color: #d4d4d4;
            padding: 20px;
            border-top: 1px solid #333;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-bar {
            display: flex;
            background: white;
            border-top: 2px solid #eee;
            position: sticky;
            bottom: 0;
            z-index: 1000;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
        }
        
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 15px 10px;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            color: #666;
        }
        
        .nav-item:hover {
            background: #f8f9fa;
            color: var(--primary-color);
        }
        
        .nav-item.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: linear-gradient(to top, rgba(76, 175, 80, 0.1), transparent);
        }
        
        .nav-icon {
            font-size: 22px;
            margin-bottom: 5px;
            display: block;
        }
        
        .nav-label {
            font-size: 12px;
            font-weight: 600;
        }

/* –§–µ—Ä–º–∞ */
.farm-grid {
    display: grid;
    gap: 2px;
    background: #8D6E63;
    padding: 10px;
    border-radius: 10px;
    border: 3px solid #5D4037;
    min-height: 400px;
}

.farm-cell {
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 5px;
    font-size: 20px;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    user-select: none;
}

.farm-cell:hover {
    transform: scale(1.1);
    z-index: 10;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.farm-cell-content {
    font-size: 24px;
}

.farm-cell-coords {
    position: absolute;
    bottom: 2px;
    right: 2px;
    font-size: 8px;
    color: rgba(0,0,0,0.5);
    background: rgba(255,255,255,0.3);
    padding: 1px 3px;
    border-radius: 2px;
}

/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–µ—Ä–º—ã */
.farm-stats {
    display: flex;
    gap: 10px;
    margin-top: 15px;
    flex-wrap: wrap;
}

.stat-card {
    background: white;
    padding: 10px 15px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stat-icon {
    font-size: 24px;
}

.stat-value {
    font-weight: bold;
    font-size: 18px;
    color: var(--primary-color);
}

.stat-label {
    font-size: 12px;
    color: #666;
}

/* –ü—Ä–æ–≥—Ä–µ—Å—Å —Ñ–µ—Ä–º—ã */
.farm-progress {
    margin-top: 15px;
}

.progress-bar {
    height: 10px;
    background: #e0e0e0;
    border-radius: 5px;
    overflow: hidden;
    margin-bottom: 5px;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #8BC34A);
    transition: width 0.5s ease;
}
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 400px;
            transform: translateX(120%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification-icon {
            font-size: 28px;
        }
        
        .notification-success .notification-icon { color: #4CAF50; }
        .notification-error .notification-icon { color: #f44336; }
        .notification-info .notification-icon { color: #2196F3; }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .header-stats {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .lessons-grid {
                grid-template-columns: 1fr;
            }
            
            .farm-grid {
                grid-template-columns: repeat(6, 1fr);
                grid-template-rows: repeat(6, 1fr);
                height: 250px;
            }
            
            .editor-toolbar {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
        }
        
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- –®–∞–ø–∫–∞ -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">üöú</div>
                <div>
                    <h1>CodeFarm</h1>
                    <div style="font-size: 12px; opacity: 0.9;">–£—á–∏–º Python —á–µ—Ä–µ–∑ —Ñ–µ—Ä–º–µ—Ä—Å—Ç–≤–æ</div>
                </div>
            </div>
            
            <div class="header-stats">
                <div class="stat-badge">
                    <i class="fas fa-coins"></i>
                    <span id="header-coins">100</span>
                </div>
                <div class="stat-badge">
                    <i class="fas fa-star"></i>
                    <span id="header-level">–£—Ä. 1</span>
                </div>
            </div>
        </header>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="content">
            <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
            <div id="loading-screen" class="fade-in">
                <div class="card" style="text-align: center; padding: 50px 20px;">
                    <div class="logo-icon" style="font-size: 64px; margin-bottom: 20px;">üöú</div>
                    <h2 style="color: var(--primary-dark); margin-bottom: 15px;">–ó–∞–≥—Ä—É–∂–∞–µ–º CodeFarm...</h2>
                    <p style="color: #666; margin-bottom: 30px;">–ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –≤–∞—à—É —Ñ–µ—Ä–º—É –∏ —É—Ä–æ–∫–∏</p>
                    
                    <div class="progress-container" style="max-width: 400px; margin: 0 auto;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="loading-progress" style="width: 0%"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 14px; color: #666;">
                            <span>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</span>
                            <span id="loading-percent">0%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω —Ñ–µ—Ä–º—ã -->
            <div id="main-screen" style="display: none;">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="section">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">‚≠ê</div>
                            <div class="stat-value" id="user-level-value">1</div>
                            <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">ü™ô</div>
                            <div class="stat-value" id="user-coins-value">100</div>
                            <div class="stat-label">–ú–æ–Ω–µ—Ç—ã</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚ú®</div>
                            <div class="stat-value" id="user-exp-value">0</div>
                            <div class="stat-label">–û–ø—ã—Ç</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìö</div>
                            <div class="stat-value" id="user-lessons-value">0</div>
                            <div class="stat-label">–£—Ä–æ–∫–∏</div>
                        </div>
                    </div>
                </div>
                
                <!-- 2D –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–µ—Ä–º—ã -->
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-tractor"></i>
                        –í–∞—à–∞ —Ñ–µ—Ä–º–∞
                    </h2>
                    
                    <div class="farm-visualization">
                        <div class="farm-grid" id="farm-grid">
                            <!-- –§–µ—Ä–º–∞ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ —á–µ—Ä–µ–∑ JS -->
                        </div>
                    </div>

                    <div class="farm-stats">
    <div class="stat-card">
        <div class="stat-icon">üßπ</div>
        <div>
            <div class="stat-value" id="cleared-land-count">0</div>
            <div class="stat-label">–û—á–∏—â–µ–Ω–æ –∑–µ–º–ª–∏</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">üèóÔ∏è</div>
        <div>
            <div class="stat-value" id="buildings-count">0</div>
            <div class="stat-label">–ü–æ—Å—Ç—Ä–æ–µ–∫</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">üå±</div>
        <div>
            <div class="stat-value" id="crops-count">0</div>
            <div class="stat-label">–†–∞—Å—Ç–µ–Ω–∏–π</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">üìö</div>
        <div>
            <div class="stat-value" id="lessons-count">0</div>
            <div class="stat-label">–£—Ä–æ–∫–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ</div>
        </div>
    </div>
</div>

<div class="farm-progress">
    <div class="progress-bar">
        <div class="progress-fill" id="farm-progress-bar" style="width: 0%"></div>
    </div>
    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
        <span>üåø –ó–∞—Ä–æ—Å—à–∞—è —Ñ–µ—Ä–º–∞</span>
        <span>üèÜ –ü—Ä–æ—Ü–≤–µ—Ç–∞—é—â–∞—è —Ñ–µ—Ä–º–∞</span>
    </div>
</div>

<div class="farm-controls">
    <button class="farm-btn farm-action-btn" data-action="water">
        <i class="fas fa-tint"></i> –ü–æ–ª–∏—Ç—å –≤—Å–µ
    </button>
    <button class="farm-btn farm-action-btn" data-action="harvest">
        <i class="fas fa-shopping-basket"></i> –°–æ–±—Ä–∞—Ç—å —É—Ä–æ–∂–∞–π
    </button>
    <button class="farm-btn farm-action-btn" data-action="plant">
        <i class="fas fa-seedling"></i> –ü–æ—Å–∞–¥–∏—Ç—å
    </button>
    <button class="farm-btn farm-action-btn" data-action="build">
        <i class="fas fa-home"></i> –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º
    </button>
    <button class="farm-btn farm-action-btn" data-action="upgrade">
        <i class="fas fa-arrow-up"></i> –£–ª—É—á—à–∏—Ç—å
    </button>
</div>
                </div>
                
                <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-bolt"></i>
                        –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                    </h2>
                    
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
    <button class="btn btn-primary quick-action-btn" data-action="start_lesson_1">
        <i class="fas fa-code"></i> –£—Ä–æ–∫ 1: –ü–µ—Ä–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
    </button>
    <button class="btn btn-secondary nav-trigger" data-screen="lessons">
        <i class="fas fa-book-open"></i> –í—Å–µ —É—Ä–æ–∫–∏
    </button>
    <button class="btn btn-accent quick-action-btn" data-action="sell_produce">
        <i class="fas fa-shopping-cart"></i> –ü—Ä–æ–¥–∞—Ç—å —É—Ä–æ–∂–∞–π
    </button>
    <button class="btn btn-primary" onclick="window.showScreen('code')">
        <i class="fas fa-laptop-code"></i> –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞
    </button>
</div>
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω —É—Ä–æ–∫–æ–≤ -->
            <div id="lessons-screen" style="display: none;">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-graduation-cap"></i>
                        –£—Ä–æ–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
                    </h2>
                    
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div>
                                <h3 style="margin-bottom: 5px;">–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
                                <p style="color: #666;">–ü—Ä–æ–π–¥–µ–Ω–æ —É—Ä–æ–∫–æ–≤: <span id="completed-lessons">0</span>/28</p>
                            </div>
                            <div class="stat-badge" style="background: var(--primary-color); color: white;">
                                <i class="fas fa-star"></i> –£—Ä–æ–≤–µ–Ω—å: <span id="user-level-text">1</span>
                            </div>
                        </div>
                        
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" id="lessons-progress" style="width: 0%"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 14px; color: #666;">
                                <span>–ù–∞—á–∏–Ω–∞—é—â–∏–π</span>
                                <span>–≠–∫—Å–ø–µ—Ä—Ç</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-code"></i>
                        –î–æ—Å—Ç—É–ø–Ω—ã–µ —É—Ä–æ–∫–∏
                    </h2>
                    
                    <div class="lessons-grid" id="lessons-list">
                        <!-- –£—Ä–æ–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫–æ–¥–∞ -->
            <div id="code-screen" style="display: none;">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-laptop-code"></i>
                        –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞
                    </h2>
                    
                    <div class="code-editor-container">
                        <div class="editor-toolbar">
                            <div>
                                <h3 style="color: white; margin: 0;" id="current-lesson-title">–£—Ä–æ–∫ 1: –ü–µ—Ä–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã</h3>
                                <p style="color: #999; margin: 5px 0 0 0; font-size: 14px;" id="current-lesson-desc">
                                    –ù–∞—É—á–∏—Ç–µ—Å—å –¥–∞–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç—É
                                </p>
                            </div>
                            <div class="editor-actions">
    <button class="btn btn-secondary" id="run-code-btn">
        <i class="fas fa-play"></i> –ó–∞–ø—É—Å—Ç–∏—Ç—å
    </button>
    <button class="btn btn-primary" id="submit-code-btn">
        <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
    </button>
</div>
                        </div>
                        
                        <div style="position: relative;">
                            <textarea id="code-editor" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –∫–æ–¥ Python –∑–¥–µ—Å—å..."></textarea>
                            <div style="position: absolute; top: 10px; right: 10px; background: rgba(30, 30, 30, 0.8); padding: 5px 10px; border-radius: 5px; color: #999; font-size: 12px;">
                                Python 3.9
                            </div>
                        </div>
                        
                        <div class="output-container" id="output-container">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="margin: 0; color: #d4d4d4;">–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:</h4>
                                <button class="btn btn-outline" style="padding: 5px 10px; font-size: 12px; background: transparent; border: 1px solid #666; color: #999;" id="clear-output-btn">
    <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å
</button>
                            </div>
                            <pre id="output-text" style="margin: 0; white-space: pre-wrap; word-wrap: break-word;"></pre>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-lightbulb"></i>
                        –ü–æ–¥—Å–∫–∞–∑–∫–∏
                    </h2>
                    
                    <div class="card">
                        <div id="hints-container">
                            <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                                <div style="font-size: 24px; color: var(--accent-color);">üí°</div>
                                <div>
                                    <h4 style="margin-bottom: 5px;">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é print()</h4>
                                    <p style="color: #666; margin: 0;">–î–ª—è –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —ç–∫—Ä–∞–Ω –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ print("–≤–∞—à —Ç–µ–∫—Å—Ç")</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω –ø—Ä–æ—Ñ–∏–ª—è -->
            <div id="profile-screen" style="display: none;">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-user"></i>
                        –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å
                    </h2>
                    
                    <div class="card">
                        <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 25px;">
                            <div style="font-size: 64px;">üë®‚Äçüåæ</div>
                            <div>
                                <h3 id="profile-name" style="margin-bottom: 5px;">–§–µ—Ä–º–µ—Ä</h3>
                                <p id="profile-username" style="color: #666; margin-bottom: 10px;">@username</p>
                                <div class="stat-badge" style="display: inline-block; background: var(--primary-color); color: white;">
                                    –£—á–∞—Å—Ç–Ω–∏–∫ —Å —Å–µ–≥–æ–¥–Ω—è
                                </div>
                            </div>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                                <div class="stat-value" id="profile-streak">1</div>
                                <div class="stat-label">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-code"></i></div>
                                <div class="stat-value" id="profile-lines">0</div>
                                <div class="stat-label">–°—Ç—Ä–æ–∫ –∫–æ–¥–∞</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                                <div class="stat-value" id="profile-solved">0</div>
                                <div class="stat-label">–ó–∞–¥–∞—á —Ä–µ—à–µ–Ω–æ</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-ranking-star"></i></div>
                                <div class="stat-value" id="profile-rank">#-</div>
                                <div class="stat-label">–†–∞–Ω–≥</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<nav class="nav-bar">
    <div class="nav-item active" data-screen="main">
        <div class="nav-icon">üè†</div>
        <div class="nav-label">–ì–ª–∞–≤–Ω–∞—è</div>
    </div>
    <div class="nav-item" data-screen="lessons">
        <div class="nav-icon">üìö</div>
        <div class="nav-label">–£—Ä–æ–∫–∏</div>
    </div>
    <div class="nav-item" data-screen="code">
        <div class="nav-icon">üíª</div>
        <div class="nav-label">–ö–æ–¥</div>
    </div>
    <div class="nav-item" data-screen="profile">
        <div class="nav-icon">üë§</div>
        <div class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</div>
    </div>
</nav>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="notification" id="notification">
        <div class="notification-icon">‚úÖ</div>
        <div>
            <h4 style="margin: 0 0 5px 0;" id="notification-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</h4>
            <p style="margin: 0; color: #666;" id="notification-message">–°–æ–æ–±—â–µ–Ω–∏–µ</p>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É—Ä–æ–∫–∞ -->
    <div class="modal" id="lesson-modal">
        <div class="modal-content">
            <h2 style="color: var(--primary-dark); margin-bottom: 15px;" id="modal-lesson-title">–£—Ä–æ–∫</h2>
            <div id="modal-lesson-content">
                <p>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —É—Ä–æ–∫–∞...</p>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 25px;">
    <button class="btn btn-secondary" id="close-modal-btn" style="flex: 1;">–ó–∞–∫—Ä—ã—Ç—å</button>
    <button class="btn btn-primary" id="start-selected-lesson-btn" style="flex: 1;">–ù–∞—á–∞—Ç—å —É—Ä–æ–∫</button>
</div>
        </div>
    </div>

       <!-- –û—Å–Ω–æ–≤–Ω–æ–π JavaScript –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -->
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = null;
        let currentUserId = null;
        let userData = null;
        let lessonsData = [];
        let currentLesson = null;
        let farmData = {
            cells: [],
            size: 8,
            clearedCells: 0,
            totalCells: 64,
            buildings: 0,
            crops: 0
        };
        
        // –¢–∏–ø—ã –∫–ª–µ—Ç–æ–∫ —Ñ–µ—Ä–º—ã –∏ –∏—Ö –ø—Ä–æ–≥—Ä–µ—Å—Å
        const CELL_TYPES = {
            GRASS: 'grass',      // –¢—Ä–∞–≤–∞ (–∑–∞—Ä–æ—Å—à–∏–π —É—á–∞—Å—Ç–æ–∫) - –Ω–∞—á–∞–ª–æ
            CLEARED: 'cleared',  // –†–∞—Å—á–∏—â–µ–Ω–Ω–∞—è –∑–µ–º–ª—è - —É—Ä–æ–∫ 1
            PLOWED: 'plowed',    // –í—Å–ø–∞—Ö–∞–Ω–Ω–∞—è –∑–µ–º–ª—è - —É—Ä–æ–∫ 2
            HOUSE: 'house',      // –î–æ–º - —É—Ä–æ–∫ 3
            BARN: 'barn',        // –°–∞—Ä–∞–π - —É—Ä–æ–∫ 4
            CROP: 'crop',        // –ü–æ—Å–µ–≤ - —É—Ä–æ–∫ 5
            WATER: 'water',      // –í–æ–¥–∞ - —É—Ä–æ–∫ 6
            ROAD: 'road'         // –î–æ—Ä–æ–≥–∞
        };
        
        // –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —É—Ä–æ–∫–æ–≤ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ —Ñ–µ—Ä–º–µ
        const LESSON_EFFECTS = {
            'lesson_1': { type: 'clear_grass', cells: 10, message: '–†–∞—Å—á–∏—â–µ–Ω–æ 10 —É—á–∞—Å—Ç–∫–æ–≤!' },
            'lesson_2': { type: 'plow_land', cells: 8, message: '–í—Å–ø–∞—Ö–∞–Ω–æ 8 —É—á–∞—Å—Ç–∫–æ–≤!' },
            'lesson_3': { type: 'build_house', cells: 4, message: '–ü–æ—Å—Ç—Ä–æ–µ–Ω –¥–æ–º!' },
            'lesson_4': { type: 'build_barn', cells: 3, message: '–ü–æ—Å—Ç—Ä–æ–µ–Ω —Å–∞—Ä–∞–π!' },
            'lesson_5': { type: 'plant_crops', cells: 12, message: '–ü–æ—Å–∞–∂–µ–Ω—ã –ø–µ—Ä–≤—ã–µ –∫—É–ª—å—Ç—É—Ä—ã!' },
            'lesson_6': { type: 'add_water', cells: 2, message: '–î–æ–±–∞–≤–ª–µ–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–æ–¥—ã!' }
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('CodeFarm Web App –∑–∞–ø—É—â–µ–Ω');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ—Ç–∫—Ä—ã—Ç–æ –ª–∏ –≤ Telegram Web App
            if (window.Telegram && window.Telegram.WebApp) {
                console.log('‚úÖ –û—Ç–∫—Ä—ã—Ç–æ –≤ Telegram Web App');
                initTelegramApp();
            } else {
                console.log('‚ÑπÔ∏è –û—Ç–∫—Ä—ã—Ç–æ –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ');
                initBrowserApp();
            }
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è Telegram Web App
        function initTelegramApp() {
            const tg = window.Telegram.WebApp;
            tg.expand();
            tg.ready();
            
            const user = tg.initDataUnsafe?.user;
            if (user) {
                currentUser = user;
                currentUserId = user.id.toString();
                updateProfileInfo();
                registerUser();
            }
            
            startApp();
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –±—Ä–∞—É–∑–µ—Ä–∞
        function initBrowserApp() {
            currentUserId = 'demo-user-' + Date.now();
            currentUser = { 
                first_name: '–î–µ–º–æ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                username: 'demo'
            };
            
            userData = {
                level: 1,
                coins: 250,
                experience: 150,
                lessonsCompleted: 0,
                completedLessonIds: [],
                streak: 3,
                codeLines: 150,
                problemsSolved: 0,
                rank: '#42'
            };
            
            startApp();
        }
        
        function startApp() {
            startLoading();
            loadLessonsData();
            initCodeEditor();
            createInitialFarm();
            initEventHandlers();
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω–æ–π —Ñ–µ—Ä–º—ã (–≤—Å–µ –≤ —Ç—Ä–∞–≤–µ)
        function createInitialFarm() {
            const grid = document.getElementById('farm-grid');
            if (!grid) return;
            
            grid.innerHTML = '';
            farmData.cells = [];
            
            // –°–æ–∑–¥–∞–µ–º –≤—Å–µ –∫–ª–µ—Ç–∫–∏ –∫–∞–∫ —Ç—Ä–∞–≤—É (–∑–∞—Ä–æ—Å—à–∏–µ)
            for (let row = 0; row < farmData.size; row++) {
                for (let col = 0; col < farmData.size; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'farm-cell grass';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // –í—Å–µ –∫–ª–µ—Ç–∫–∏ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ - —Ç—Ä–∞–≤–∞
                    cell.innerHTML = `
                        <div class="farm-cell-icon">üåø</div>
                        <div class="farm-cell-label">${row},${col}</div>
                    `;
                    
                    cell.addEventListener('click', () => {
                        handleFarmCellClick(row, col, 'grass');
                    });
                    
                    grid.appendChild(cell);
                    
                    farmData.cells.push({
                        row, col, 
                        type: 'grass',
                        canClear: true,
                        icon: 'üåø'
                    });
                }
            }
            
            updateFarmStats();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ñ–µ—Ä–º—ã
        function updateFarmStats() {
            if (!farmData.cells) return;
            
            const stats = {
                cleared: farmData.cells.filter(c => c.type !== 'grass').length,
                buildings: farmData.cells.filter(c => c.type === 'house' || c.type === 'barn').length,
                crops: farmData.cells.filter(c => c.type === 'crop').length,
                water: farmData.cells.filter(c => c.type === 'water').length
            };
            
            document.getElementById('cleared-land-count').textContent = stats.cleared;
            document.getElementById('buildings-count').textContent = stats.buildings;
            document.getElementById('crops-count').textContent = stats.crops;
            document.getElementById('lessons-count').textContent = userData?.lessonsCompleted || 0;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            const progressBar = document.getElementById('farm-progress-bar');
            if (progressBar) {
                const progress = (stats.cleared / farmData.totalCells) * 100;
                progressBar.style.width = `${progress}%`;
            }
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ —Ñ–µ—Ä–º–µ –ø–æ—Å–ª–µ —É—Ä–æ–∫–∞
        function applyFarmChanges(lessonId) {
            const effect = LESSON_EFFECTS[lessonId];
            if (!effect) return;
            
            console.log(`–ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç —É—Ä–æ–∫–∞ ${lessonId}:`, effect);
            
            // –ù–∞—Ö–æ–¥–∏–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–ª–µ—Ç–∫–∏
            let availableCells = [];
            
            switch(effect.type) {
                case 'clear_grass':
                    availableCells = farmData.cells.filter(c => c.type === 'grass');
                    break;
                case 'plow_land':
                    availableCells = farmData.cells.filter(c => c.type === 'cleared');
                    break;
                case 'build_house':
                    availableCells = farmData.cells.filter(c => c.type === 'cleared' || c.type === 'plowed');
                    // –î–æ–º —Å—Ç—Ä–æ–∏–º –≤ —Ü–µ–Ω—Ç—Ä–µ
                    const centerRow = Math.floor(farmData.size / 2);
                    const centerCol = Math.floor(farmData.size / 2);
                    const centerCell = farmData.cells.find(c => c.row === centerRow && c.col === centerCol);
                    if (centerCell) availableCells = [centerCell];
                    break;
                case 'build_barn':
                    availableCells = farmData.cells.filter(c => c.type === 'cleared' || c.type === 'plowed');
                    // –°–∞—Ä–∞–π —Ä—è–¥–æ–º —Å –¥–æ–º–æ–º
                    const houseCell = farmData.cells.find(c => c.type === 'house');
                    if (houseCell) {
                        const nearbyCells = farmData.cells.filter(c => 
                            Math.abs(c.row - houseCell.row) <= 1 && 
                            Math.abs(c.col - houseCell.col) <= 1 &&
                            (c.type === 'cleared' || c.type === 'plowed')
                        );
                        if (nearbyCells.length > 0) availableCells = [nearbyCells[0]];
                    }
                    break;
                case 'plant_crops':
                    availableCells = farmData.cells.filter(c => c.type === 'plowed');
                    break;
                case 'add_water':
                    availableCells = farmData.cells.filter(c => c.type === 'grass' && 
                        (c.row === 0 || c.row === farmData.size-1 || c.col === 0 || c.col === farmData.size-1));
                    break;
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ —Å–ª—É—á–∞–π–Ω—ã–º –∫–ª–µ—Ç–∫–∞–º
            const cellsToChange = availableCells
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(effect.cells, availableCells.length));
            
            cellsToChange.forEach(cell => {
                let newType, newIcon, newTitle;
                
                switch(effect.type) {
                    case 'clear_grass':
                        newType = 'cleared';
                        newIcon = 'üü´';
                        newTitle = '–†–∞—Å—á–∏—â–µ–Ω–Ω–∞—è –∑–µ–º–ª—è';
                        break;
                    case 'plow_land':
                        newType = 'plowed';
                        newIcon = 'üü®';
                        newTitle = '–í—Å–ø–∞—Ö–∞–Ω–Ω–æ–µ –ø–æ–ª–µ';
                        break;
                    case 'build_house':
                        newType = 'house';
                        newIcon = 'üè†';
                        newTitle = '–î–æ–º —Ñ–µ—Ä–º–µ—Ä–∞';
                        farmData.buildings++;
                        break;
                    case 'build_barn':
                        newType = 'barn';
                        newIcon = 'üèöÔ∏è';
                        newTitle = '–°–∞—Ä–∞–π';
                        farmData.buildings++;
                        break;
                    case 'plant_crops':
                        newType = 'crop';
                        const cropTypes = ['üåæ', 'ü•ï', 'ü•î'];
                        newIcon = cropTypes[Math.floor(Math.random() * cropTypes.length)];
                        newTitle = newIcon === 'üåæ' ? '–ü—à–µ–Ω–∏—Ü–∞' : 
                                  newIcon === 'ü•ï' ? '–ú–æ—Ä–∫–æ–≤—å' : '–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å';
                        farmData.crops++;
                        break;
                    case 'add_water':
                        newType = 'water';
                        newIcon = 'üíß';
                        newTitle = '–ò—Å—Ç–æ—á–Ω–∏–∫ –≤–æ–¥—ã';
                        break;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–µ—Ç–∫–∏
                cell.type = newType;
                cell.icon = newIcon;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º DOM
                const cellElement = document.querySelector(`.farm-cell[data-row="${cell.row}"][data-col="${cell.col}"]`);
                if (cellElement) {
                    cellElement.className = `farm-cell ${newType}`;
                    cellElement.querySelector('.farm-cell-icon').textContent = newIcon;
                    
                    // –ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    cellElement.classList.add('grow-animation');
                    setTimeout(() => cellElement.classList.remove('grow-animation'), 500);
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateFarmStats();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (effect.message) {
                showNotification('üåæ –ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Ñ–µ—Ä–º–µ', effect.message);
            }
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Å–µ–π —Ñ–µ—Ä–º—ã
            const farmGrid = document.getElementById('farm-grid');
            if (farmGrid) {
                farmGrid.classList.add('pulse');
                setTimeout(() => farmGrid.classList.remove('pulse'), 1000);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function initEventHandlers() {
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const screen = this.getAttribute('data-screen');
                    if (screen) showScreen(screen);
                });
            });
            
            // –î–µ–π—Å—Ç–≤–∏—è –Ω–∞ —Ñ–µ—Ä–º–µ
            document.querySelectorAll('.farm-action-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.getAttribute('data-action');
                    handleFarmAction(action);
                });
            });
            
            // –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
            document.querySelectorAll('.quick-action-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.getAttribute('data-action');
                    handleQuickAction(action);
                });
            });
            
            // –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            const runBtn = document.getElementById('run-code-btn');
            const submitBtn = document.getElementById('submit-code-btn');
            const clearBtn = document.getElementById('clear-output-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const startLessonBtn = document.getElementById('start-selected-lesson-btn');
            
            if (runBtn) runBtn.addEventListener('click', runCode);
            if (submitBtn) submitBtn.addEventListener('click', submitCode);
            if (clearBtn) clearBtn.addEventListener('click', clearOutput);
            if (closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
            if (startLessonBtn) startLessonBtn.addEventListener('click', startSelectedLesson);
            
            // –ö–ª–∏–∫ –ø–æ –∫–ª–µ—Ç–∫–∞–º —Ñ–µ—Ä–º—ã (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
            const farmGrid = document.getElementById('farm-grid');
            if (farmGrid) {
                farmGrid.addEventListener('click', function(e) {
                    const cell = e.target.closest('.farm-cell');
                    if (cell) {
                        const row = parseInt(cell.dataset.row);
                        const col = parseInt(cell.dataset.col);
                        const type = Array.from(cell.classList)
                            .find(cls => cls !== 'farm-cell' && cls !== 'fade-in' && cls !== 'grow-animation');
                        handleFarmCellClick(row, col, type);
                    }
                });
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –∫–ª–µ—Ç–∫–µ —Ñ–µ—Ä–º—ã
        function handleFarmCellClick(row, col, type) {
            let message = '';
            let icon = 'üìç';
            
            switch(type) {
                case 'grass':
                    message = `üåø –ó–∞—Ä–æ—Å—à–∏–π —É—á–∞—Å—Ç–æ–∫ (${row},${col})\n–ü—Ä–æ–π–¥–∏—Ç–µ –£—Ä–æ–∫ 1: "–ü–µ—Ä–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã", —á—Ç–æ–±—ã —Ä–∞—Å—á–∏—Å—Ç–∏—Ç—å –∑–µ–º–ª—é!`;
                    icon = 'üåø';
                    break;
                case 'cleared':
                    message = `üü´ –†–∞—Å—á–∏—â–µ–Ω–Ω–∞—è –∑–µ–º–ª—è (${row},${col})\n–ì–æ—Ç–æ–≤–∞ –¥–ª—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞ –∏–ª–∏ –ø–æ—Å–∞–¥–∫–∏ —Ä–∞—Å—Ç–µ–Ω–∏–π. –ü—Ä–æ–π–¥–∏—Ç–µ –£—Ä–æ–∫ 2 –¥–ª—è –≤—Å–ø–∞—à–∫–∏.`;
                    icon = 'üü´';
                    break;
                case 'plowed':
                    message = `üü® –í—Å–ø–∞—Ö–∞–Ω–Ω–æ–µ –ø–æ–ª–µ (${row},${col})\n–ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ –¥–ª—è –ø–æ—Å–∞–¥–∫–∏ –∫—É–ª—å—Ç—É—Ä. –ü—Ä–æ–π–¥–∏—Ç–µ –£—Ä–æ–∫ 5 –¥–ª—è –ø–æ—Å–∞–¥–∫–∏.`;
                    icon = 'üü®';
                    break;
                case 'house':
                    message = `üè† –î–æ–º —Ñ–µ—Ä–º–µ—Ä–∞ (${row},${col})\n–ì–ª–∞–≤–Ω–æ–µ –∑–¥–∞–Ω–∏–µ –≤–∞—à–µ–π —Ñ–µ—Ä–º—ã. –ó–¥–µ—Å—å –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ —Ä–∞–±–æ—Ç—É –∏ –æ—Ç–¥—ã—Ö–∞–µ—Ç–µ.`;
                    icon = 'üè†';
                    break;
                case 'barn':
                    message = `üèöÔ∏è –°–∞—Ä–∞–π (${row},${col})\n–•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ —É—Ä–æ–∂–∞—è.`;
                    icon = 'üèöÔ∏è';
                    break;
                case 'crop':
                    message = `üåæ –ü–æ—Å–∞–¥–∫–∏ (${row},${col})\n–†–∞—Å—Ç–µ–Ω–∏—è —Ä–∞—Å—Ç—É—Ç! –°–∫–æ—Ä–æ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Å–æ–±—Ä–∞—Ç—å —É—Ä–æ–∂–∞–π.`;
                    icon = 'üåæ';
                    break;
                case 'water':
                    message = `üíß –ò—Å—Ç–æ—á–Ω–∏–∫ –≤–æ–¥—ã (${row},${col})\n–ù–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –ø–æ–ª–∏–≤–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –∂–∏–≤–æ—Ç–Ω—ã—Ö.`;
                    icon = 'üíß';
                    break;
            }
            
            showNotification(icon, message);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è
            const cell = document.querySelector(`.farm-cell[data-row="${row}"][data-col="${col}"]`);
            if (cell) {
                cell.classList.add('grow-animation');
                setTimeout(() => cell.classList.remove('grow-animation'), 500);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ —Ñ–µ—Ä–º–µ
        function handleFarmAction(action) {
            switch(action) {
                case 'water':
                    showNotification('üíß', '–ß—Ç–æ–±—ã –ø–æ–ª–∏–≤–∞—Ç—å —Ä–∞—Å—Ç–µ–Ω–∏—è, –ø—Ä–æ–π–¥–∏—Ç–µ –£—Ä–æ–∫ 6!');
                    break;
                case 'harvest':
                    showNotification('üì¶', '–ß—Ç–æ–±—ã —Å–æ–±–∏—Ä–∞—Ç—å —É—Ä–æ–∂–∞–π, –ø—Ä–æ–π–¥–∏—Ç–µ –±–æ–ª—å—à–µ —É—Ä–æ–∫–æ–≤!');
                    break;
                case 'plant':
                    showNotification('üå±', '–ß—Ç–æ–±—ã —Å–∞–∂–∞—Ç—å —Ä–∞—Å—Ç–µ–Ω–∏—è, –ø—Ä–æ–π–¥–∏—Ç–µ –£—Ä–æ–∫ 5!');
                    break;
                case 'build':
                    showNotification('üèóÔ∏è', '–ß—Ç–æ–±—ã —Å—Ç—Ä–æ–∏—Ç—å, –ø—Ä–æ–π–¥–∏—Ç–µ –£—Ä–æ–∫–∏ 3 –∏ 4!');
                    break;
                case 'upgrade':
                    showNotification('‚¨ÜÔ∏è', '–§—É–Ω–∫—Ü–∏—è —É–ª—É—á—à–µ–Ω–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö —É—Ä–æ–∫–æ–≤!');
                    break;
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
        function handleQuickAction(action) {
            switch(action) {
                case 'start_lesson_1':
                    startLesson('lesson_1');
                    break;
                case 'sell_produce':
                    showNotification('üí∞', '–°–Ω–∞—á–∞–ª–∞ –≤—ã—Ä–∞—Å—Ç–∏—Ç–µ —É—Ä–æ–∂–∞–π, –ø—Ä–æ–π–¥—è —É—Ä–æ–∫–∏!');
                    break;
            }
        }
        
        // –°—Ç–∞—Ä—Ç –∑–∞–≥—Ä—É–∑–∫–∏
        function startLoading() {
            let progress = 0;
            const progressBar = document.getElementById('loading-progress');
            const progressPercent = document.getElementById('loading-percent');
            
            const interval = setInterval(() => {
                progress += Math.random() * 20;
                if (progress > 100) progress = 100;
                
                if (progressBar) progressBar.style.width = progress + '%';
                if (progressPercent) progressPercent.textContent = Math.round(progress) + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        const loadingScreen = document.getElementById('loading-screen');
                        if (loadingScreen) loadingScreen.style.display = 'none';
                        showScreen('main');
                    }, 500);
                }
            }, 200);
        }
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function registerUser() {
            if (!currentUserId) return;
            
            try {
                const response = await fetch('/api/user', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        telegramId: currentUserId,
                        username: currentUser?.username,
                        firstName: currentUser?.first_name,
                        lastName: currentUser?.last_name
                    })
                });
                
                if (response.ok) {
                    userData = await response.json();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', error);
            }
            
            if (!userData) {
                userData = {
                    level: 1,
                    coins: 100,
                    experience: 0,
                    lessonsCompleted: 0,
                    completedLessonIds: [],
                    streak: 1,
                    codeLines: 0,
                    problemsSolved: 0,
                    rank: '#999'
                };
            }
            
            updateUserStats();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function updateUserStats() {
            if (!userData) return;
            
            const stats = {
                'user-level-value': userData.level || 1,
                'user-coins-value': userData.coins || 100,
                'user-exp-value': userData.experience || 0,
                'user-lessons-value': userData.lessonsCompleted || 0,
                'header-coins': userData.coins || 100,
                'header-level': '–£—Ä. ' + (userData.level || 1),
                'completed-lessons': userData.lessonsCompleted || 0,
                'user-level-text': userData.level || 1,
                'profile-streak': userData.streak || 1,
                'profile-lines': userData.codeLines || 0,
                'profile-solved': userData.problemsSolved || 0,
                'profile-rank': userData.rank || '#-'
            };
            
            for (const [id, value] of Object.entries(stats)) {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            }
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–∫–æ–≤
            const lessonsProgress = document.getElementById('lessons-progress');
            if (lessonsProgress) {
                const progress = ((userData.lessonsCompleted || 0) / 6) * 100;
                lessonsProgress.style.width = Math.min(100, progress) + '%';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
        function updateProfileInfo() {
            if (!currentUser) return;
            
            const nameElement = document.getElementById('profile-name');
            const usernameElement = document.getElementById('profile-username');
            
            if (nameElement) nameElement.textContent = currentUser.first_name || '–§–µ—Ä–º–µ—Ä';
            if (usernameElement) {
                usernameElement.textContent = currentUser.username ? '@' + currentUser.username : '–ë–µ–∑ username';
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–æ–≤
        async function loadLessonsData() {
            try {
                const response = await fetch('/api/lessons');
                if (response.ok) {
                    lessonsData = await response.json();
                } else {
                    throw new Error('API –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤:', error);
                lessonsData = createDemoLessons();
            }
            
            renderLessons();
        }
        
        function createDemoLessons() {
            return [
                {
                    id: 'lesson_1',
                    title: '–ü–µ—Ä–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç—É-–ø–æ–º–æ—â–Ω–∏–∫—É',
                    description: '–ù–∞—É—á–∏—Ç–µ—Å—å –¥–∞–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç—É',
                    level: 1,
                    rewardCoins: 50,
                    rewardExp: 100,
                    theory: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é print() –¥–ª—è –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞. –ö–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ.',
                    task: '–ù–∞–ø–∏—à–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≤–µ–¥–µ—Ç "–ü—Ä–∏–≤–µ—Ç, –ê–≥—Ä–æ–ë–æ—Ç!" –∏ "–ù–∞—á–∏–Ω–∞—é —Ä–∞–±–æ—Ç—É!"',
                    testCode: 'print("–ü—Ä–∏–≤–µ—Ç, –ê–≥—Ä–æ–ë–æ—Ç!")\nprint("–ù–∞—á–∏–Ω–∞—é —Ä–∞–±–æ—Ç—É!")',
                    initialCode: '# –ù–∞–ø–∏—à–∏—Ç–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è –±–æ—Ç–∞\nprint("–ü—Ä–∏–≤–µ—Ç, –ê–≥—Ä–æ–ë–æ—Ç!")'
                },
                {
                    id: 'lesson_2',
                    title: '–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ - –ü—Ä–æ–µ–∫—Ç —Ñ–µ—Ä–º—ã',
                    description: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ —Ñ–µ—Ä–º—ã',
                    level: 1,
                    rewardCoins: 75,
                    rewardExp: 150,
                    theory: '–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç –¥–∞–Ω–Ω—ã–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–Ω–∞–∫ = –¥–ª—è –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è.',
                    task: '–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é farm_name —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º "–°–æ–ª–Ω–µ—á–Ω–∞—è –¥–æ–ª–∏–Ω–∞" –∏ –≤—ã–≤–µ–¥–∏—Ç–µ –µ—ë',
                    testCode: 'farm_name = "–°–æ–ª–Ω–µ—á–Ω–∞—è –¥–æ–ª–∏–Ω–∞"\nprint(farm_name)',
                    initialCode: '# –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–µ—Ä–º—ã\nfarm_name = "–ú–æ—è —Ñ–µ—Ä–º–∞"'
                },
                {
                    id: 'lesson_3',
                    title: '–§—É–Ω–∫—Ü–∏–∏ - –†–∞—Å—á–∏—Å—Ç–∫–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏',
                    description: '–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Ö–Ω–∏–∫–æ–π',
                    level: 1,
                    rewardCoins: 100,
                    rewardExp: 200,
                    theory: '–§—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é def. –ö–æ–º–∞–Ω–¥—ã –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å –æ—Ç—Å—Ç—É–ø–æ–º.',
                    task: '–°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é start_tractor(), –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≤–æ–¥–∏—Ç "–ó–∞–ø—É—Å–∫–∞—é —Ç—Ä–∞–∫—Ç–æ—Ä"',
                    testCode: 'def start_tractor():\n    print("–ó–∞–ø—É—Å–∫–∞—é —Ç—Ä–∞–∫—Ç–æ—Ä")\n\nstart_tractor()',
                    initialCode: '# –°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç—Ä–∞–∫—Ç–æ—Ä–∞\ndef start_tractor():\n    # –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å\n    pass'
                },
                {
                    id: 'lesson_4',
                    title: '–ê—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π - –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –¥–æ–º–∞',
                    description: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –ø–æ—Å—Ç—Ä–æ–µ–∫',
                    level: 2,
                    rewardCoins: 125,
                    rewardExp: 250,
                    theory: '–ê—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ —Å–∫–æ–±–∫–∞—Ö –ø–æ—Å–ª–µ –∏–º–µ–Ω–∏ —Ñ—É–Ω–∫—Ü–∏–∏.',
                    task: '–°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é build_house(material), –∫–æ—Ç–æ—Ä–∞—è –≤—ã–≤–æ–¥–∏—Ç "–°—Ç—Ä–æ—é –¥–æ–º –∏–∑ [material]"',
                    testCode: 'def build_house(material):\n    print(f"–°—Ç—Ä–æ—é –¥–æ–º –∏–∑ {material}")\n\nbuild_house("–¥–µ—Ä–µ–≤–æ")',
                    initialCode: '# –°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–æ—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–∞\ndef build_house(material):\n    # –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å\n    pass'
                },
                {
                    id: 'lesson_5',
                    title: '–¶–∏–∫–ª—ã - –ü–æ—Å–∞–¥–∫–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π',
                    description: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ü–∏–∫–ª—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ—Å–∞–¥–∫–∏ —Ä–∞—Å—Ç–µ–Ω–∏–π',
                    level: 2,
                    rewardCoins: 150,
                    rewardExp: 300,
                    theory: '–¶–∏–∫–ª for –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ range() –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.',
                    task: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ü–∏–∫–ª for, —á—Ç–æ–±—ã –≤—ã–≤–µ—Å—Ç–∏ "–°–∞–∂–∞—é —Ä–∞—Å—Ç–µ–Ω–∏–µ" 3 —Ä–∞–∑–∞',
                    testCode: 'for i in range(3):\n    print("–°–∞–∂–∞—é —Ä–∞—Å—Ç–µ–Ω–∏–µ")',
                    initialCode: '# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ü–∏–∫–ª –¥–ª—è –ø–æ—Å–∞–¥–∫–∏ —Ä–∞—Å—Ç–µ–Ω–∏–π\nfor i in range(3):\n    # –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å\n    pass'
                },
                {
                    id: 'lesson_6',
                    title: '–£—Å–ª–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã - –£—Ö–æ–¥ –∑–∞ —Ä–∞—Å—Ç–µ–Ω–∏—è–º–∏',
                    description: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—Å–ª–æ–≤–∏—è –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –Ω–∞ —Ñ–µ—Ä–º–µ',
                    level: 2,
                    rewardCoins: 175,
                    rewardExp: 350,
                    theory: 'if –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ª–æ–≤–∏–µ. else –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –µ—Å–ª–∏ —É—Å–ª–æ–≤–∏–µ –ª–æ–∂–Ω–æ.',
                    task: '–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –µ—Å–ª–∏ soil_moisture < 50, –≤—ã–≤–µ–¥–∏—Ç–µ "–ü–æ–ª–∏–≤–∞—é —Ä–∞—Å—Ç–µ–Ω–∏—è"',
                    testCode: 'soil_moisture = 30\nif soil_moisture < 50:\n    print("–ü–æ–ª–∏–≤–∞—é —Ä–∞—Å—Ç–µ–Ω–∏—è")\nelse:\n    print("–ü–æ–ª–∏–≤ –Ω–µ –Ω—É–∂–µ–Ω")',
                    initialCode: '# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–ª–∞–∂–Ω–æ—Å—Ç—å –ø–æ—á–≤—ã\nsoil_moisture = 30\n\nif soil_moisture < 50:\n    # –í–∞—à –∫–æ–¥ –∑–¥–µ—Å—å\n    pass'
                }
            ];
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Ä–æ–∫–æ–≤
        function renderLessons() {
            const container = document.getElementById('lessons-list');
            if (!container || !lessonsData.length) return;
            
            container.innerHTML = '';
            
            lessonsData.forEach((lesson, index) => {
                const completed = userData?.completedLessonIds?.includes(lesson.id) || false;
                const available = completed || index === 0 || 
                    (index > 0 && (userData?.completedLessonIds?.includes(lessonsData[index-1].id) || false));
                
                const statusClass = completed ? 'status-completed' : 
                                  available ? 'status-in-progress' : 'status-locked';
                
                const card = document.createElement('div');
                card.className = 'lesson-card fade-in';
                card.style.animationDelay = (index * 0.1) + 's';
                
                card.innerHTML = `
                    <div class="lesson-header">
                        <div class="lesson-number">${index + 1}</div>
                        <div class="lesson-status ${statusClass}"></div>
                    </div>
                    <h3 style="margin-bottom: 10px;">${lesson.title}</h3>
                    <p style="color: #666; margin-bottom: 15px;">${lesson.description}</p>
                    
                    <div class="lesson-rewards">
                        <div class="reward-item">
                            <i class="fas fa-coins"></i>
                            <span>${lesson.rewardCoins} –º–æ–Ω–µ—Ç</span>
                        </div>
                        <div class="reward-item">
                            <i class="fas fa-star"></i>
                            <span>${lesson.rewardExp} –æ–ø—ã—Ç–∞</span>
                        </div>
                        <div class="reward-item">
                            <i class="fas fa-layer-group"></i>
                            <span>–£—Ä–æ–≤–µ–Ω—å ${lesson.level}</span>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" 
                            onclick="window.startLesson('${lesson.id}')"
                            ${!available ? 'disabled' : ''}>
                        ${completed ? '–ü–æ–≤—Ç–æ—Ä–∏—Ç—å —É—Ä–æ–∫' : available ? '–ù–∞—á–∞—Ç—å —É—Ä–æ–∫' : '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ'}
                    </button>
                `;
                
                container.appendChild(card);
            });
        }
        
        // –ù–∞—á–∞—Ç—å —É—Ä–æ–∫
        function startLesson(lessonId) {
            const lesson = lessonsData.find(l => l.id === lessonId);
            if (!lesson) {
                showNotification('‚ùå –û—à–∏–±–∫–∞', '–£—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            currentLesson = lesson;
            showScreen('code');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É—Ä–æ–∫–∞
            document.getElementById('current-lesson-title').textContent = lesson.title;
            document.getElementById('current-lesson-desc').textContent = lesson.description;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
            const codeEditor = document.getElementById('code-editor');
            if (codeEditor) {
                codeEditor.value = lesson.initialCode;
                setTimeout(() => {
                    codeEditor.style.height = 'auto';
                    codeEditor.style.height = (codeEditor.scrollHeight) + 'px';
                }, 100);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏
            updateHints(lesson);
        }
        
        function updateHints(lesson) {
            const hintsContainer = document.getElementById('hints-container');
            if (!hintsContainer) return;
            
            hintsContainer.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <h3 style="color: #2E7D32; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">üìñ</span>
                        <span>–¢–µ–æ—Ä–∏—è —É—Ä–æ–∫–∞</span>
                    </h3>
                    <div style="background: #F9F9F9; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        ${lesson.theory}
                    </div>
                    
                    <h3 style="color: #2E7D32; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">üéØ</span>
                        <span>–ó–∞–¥–∞–Ω–∏–µ</span>
                    </h3>
                    <div style="background: #FFF3E0; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong>–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:</strong>
                        <p style="margin-top: 5px;">${lesson.task}</p>
                    </div>
                    
                    <h3 style="color: #2E7D32; margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">üí°</span>
                        <span>–ü–æ–¥—Å–∫–∞–∑–∫–∏</span>
                    </h3>
                    <ul style="margin: 0; padding-left: 20px; color: #666;">
                        <li>–°–ª–µ–¥—É–π—Ç–µ —Ç–æ—á–Ω–æ–º—É —Ç–µ–∫—Å—Ç—É –∑–∞–¥–∞–Ω–∏—è</li>
                        <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Python</li>
                        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∫–æ–º–∞–Ω–¥—ã –∏–∑ —Ç–µ–æ—Ä–∏–∏</li>
                        ${lesson.testCode ? 
                            `<li>–ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞:<br>
                            <pre style="background: #f0f0f0; padding: 10px; border-radius: 5px; margin-top: 5px; font-size: 12px;">${lesson.testCode}</pre></li>` 
                            : ''}
                    </ul>
                </div>
            `;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ (–ø—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –¥–µ–º–æ)
        function checkCode(code, lessonId) {
            if (!code || !lessonId) return { success: false, message: '–ù–µ—Ç –∫–æ–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏' };
            
            const lesson = lessonsData.find(l => l.id === lessonId);
            if (!lesson) return { success: false, message: '–£—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω' };
            
            // –£–±–∏—Ä–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
            const cleanCode = code
                .replace(/#[^\n]*/g, '') // –£–±–∏—Ä–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                .replace(/\s+/g, ' ')    // –ó–∞–º–µ–Ω—è–µ–º –≤—Å–µ –ø—Ä–æ–±–µ–ª—ã –Ω–∞ –æ–¥–∏–Ω
                .trim()
                .toLowerCase();
            
            const testCode = lesson.testCode
                .replace(/\s+/g, ' ')
                .trim()
                .toLowerCase();
            
            console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:', { cleanCode, testCode });
            
            // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Ñ—Ä–∞–∑
            if (lessonId === 'lesson_1') {
                const hasHello = code.includes('"–ü—Ä–∏–≤–µ—Ç, –ê–≥—Ä–æ–ë–æ—Ç!"') || code.includes("'–ü—Ä–∏–≤–µ—Ç, –ê–≥—Ä–æ–ë–æ—Ç!'");
                const hasStart = code.includes('"–ù–∞—á–∏–Ω–∞—é —Ä–∞–±–æ—Ç—É!"') || code.includes("'–ù–∞—á–∏–Ω–∞—é —Ä–∞–±–æ—Ç—É!'");
                
                if (!hasHello || !hasStart) {
                    return { 
                        success: false, 
                        message: '–í –∫–æ–¥–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±–µ —Ñ—Ä–∞–∑—ã: "–ü—Ä–∏–≤–µ—Ç, –ê–≥—Ä–æ–ë–æ—Ç!" –∏ "–ù–∞—á–∏–Ω–∞—é —Ä–∞–±–æ—Ç—É!"' 
                    };
                }
            }
            else if (lessonId === 'lesson_2') {
                if (!cleanCode.includes('farm_name') || !cleanCode.includes('—Å–æ–ª–Ω–µ—á–Ω–∞—è –¥–æ–ª–∏–Ω–∞')) {
                    return { 
                        success: false, 
                        message: '–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é farm_name —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º "–°–æ–ª–Ω–µ—á–Ω–∞—è –¥–æ–ª–∏–Ω–∞" –∏ –≤—ã–≤–µ–¥–∏—Ç–µ –µ—ë' 
                    };
                }
            }
            else if (lessonId === 'lesson_3') {
                if (!cleanCode.includes('def start_tractor') || !cleanCode.includes('print')) {
                    return { 
                        success: false, 
                        message: '–°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é start_tractor() —Å –∫–æ–º–∞–Ω–¥–æ–π print –≤–Ω—É—Ç—Ä–∏' 
                    };
                }
            }
            
            return { success: true, message: '–ö–æ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π!' };
        }
        
        // –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–¥
        function runCode() {
            const code = document.getElementById('code-editor')?.value;
            if (!code) {
                showNotification('‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ', '–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è');
                return;
            }
            
            const output = document.getElementById('output-text');
            const outputContainer = document.getElementById('output-container');
            
            if (!output || !outputContainer) return;
            
            output.textContent = 'üöÄ –í—ã–ø–æ–ª–Ω—è—é –∫–æ–¥...\n\n';
            outputContainer.style.display = 'block';
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞
            setTimeout(() => {
                const lines = code.split('\n');
                let result = '';
                
                lines.forEach(line => {
                    const trimmed = line.trim();
                    if (trimmed && !trimmed.startsWith('#')) {
                        result += `>>> ${trimmed}\n`;
                        
                        // –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞ print
                        if (trimmed.includes('print(')) {
                            const match = trimmed.match(/print\(["'](.+?)["']\)/);
                            if (match) {
                                result += `${match[1]}\n`;
                            }
                        }
                    }
                });
                
                output.textContent += result + '\n‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ';
                outputContainer.scrollTop = outputContainer.scrollHeight;
            }, 500);
        }
        
        // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
        async function submitCode() {
            const code = document.getElementById('code-editor')?.value;
            if (!code || !currentLesson) {
                showNotification('‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ', '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –∫–æ–¥');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            showNotification('‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞', '–ü—Ä–æ–≤–µ—Ä—è—é –≤–∞—à –∫–æ–¥...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥ –ª–æ–∫–∞–ª—å–Ω–æ (–¥–ª—è –¥–µ–º–æ)
            const checkResult = checkCode(code, currentLesson.id);
            
            if (checkResult.success) {
                // –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
                showNotification('üéâ –£—Å–ø–µ—Ö!', `–£—Ä–æ–∫ "${currentLesson.title}" –ø—Ä–æ–π–¥–µ–Ω!\n–ù–∞–≥—Ä–∞–¥–∞: ${currentLesson.rewardCoins} –º–æ–Ω–µ—Ç`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (userData) {
                    userData.lessonsCompleted = (userData.lessonsCompleted || 0) + 1;
                    if (!userData.completedLessonIds) userData.completedLessonIds = [];
                    if (!userData.completedLessonIds.includes(currentLesson.id)) {
                        userData.completedLessonIds.push(currentLesson.id);
                    }
                    userData.coins = (userData.coins || 0) + currentLesson.rewardCoins;
                    userData.experience = (userData.experience || 0) + currentLesson.rewardExp;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
                    if (userData.experience >= (userData.level || 1) * 1000) {
                        userData.level = (userData.level || 1) + 1;
                        showNotification('‚≠ê –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å!', `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —É—Ä–æ–≤–Ω—è ${userData.level}!`);
                    }
                    
                    updateUserStats();
                    renderLessons();
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Ñ–µ—Ä–º–µ
                    applyFarmChanges(currentLesson.id);
                    
                    // –ê–Ω–∏–º–∞—Ü–∏—è —É—Å–ø–µ—Ö–∞
                    const submitBtn = document.getElementById('submit-code-btn');
                    if (submitBtn) {
                        submitBtn.classList.add('pulse');
                        setTimeout(() => submitBtn.classList.remove('pulse'), 2000);
                    }
                }
            } else {
                // –û—à–∏–±–∫–∞
                showNotification('‚ùå –û—à–∏–±–∫–∞', checkResult.message);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –≤ –≤—ã–≤–æ–¥–µ
                const output = document.getElementById('output-text');
                const outputContainer = document.getElementById('output-container');
                if (output && outputContainer) {
                    output.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:\n\n' + checkResult.message;
                    outputContainer.style.display = 'block';
                }
            }
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å –≤—ã–≤–æ–¥
        function clearOutput() {
            const output = document.getElementById('output-text');
            if (output) output.textContent = '';
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω
        function showScreen(screenName) {
            const screens = ['main', 'lessons', 'code', 'profile'];
            screens.forEach(screen => {
                const element = document.getElementById(screen + '-screen');
                if (element) element.style.display = 'none';
            });
            
            const targetScreen = document.getElementById(screenName + '-screen');
            if (targetScreen) targetScreen.style.display = 'block';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-screen') === screenName) {
                    item.classList.add('active');
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã—Å–æ—Ç—É —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –∫–æ–¥–∞
            if (screenName === 'code') {
                const codeEditor = document.getElementById('code-editor');
                if (codeEditor) {
                    setTimeout(() => {
                        codeEditor.style.height = 'auto';
                        codeEditor.style.height = (codeEditor.scrollHeight) + 'px';
                    }, 100);
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∫–æ–¥–∞
        function initCodeEditor() {
            const codeEditor = document.getElementById('code-editor');
            if (codeEditor) {
                codeEditor.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });
                
                codeEditor.value = `# –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ CodeFarm!
# –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–∫ —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ`;

                setTimeout(() => {
                    codeEditor.style.height = 'auto';
                    codeEditor.style.height = (codeEditor.scrollHeight) + 'px';
                }, 100);
            }
        }
        
        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function openLessonModal(lessonId) {
            const lesson = lessonsData.find(l => l.id === lessonId);
            if (!lesson) return;
            
            currentLesson = lesson;
            
            document.getElementById('modal-lesson-title').textContent = lesson.title;
            document.getElementById('modal-lesson-content').innerHTML = `
                <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${lesson.description}</p>
                <p><strong>–¢–µ–æ—Ä–∏—è:</strong> ${lesson.theory}</p>
                <p><strong>–ù–∞–≥—Ä–∞–¥–∞:</strong> ${lesson.rewardCoins} ü™ô –º–æ–Ω–µ—Ç –∏ ${lesson.rewardExp} ‚ú® –æ–ø—ã—Ç–∞</p>
                <div style="background: #f0f9ff; padding: 15px; border-radius: 10px; margin-top: 15px;">
                    <strong>–ó–∞–¥–∞–Ω–∏–µ:</strong>
                    <p style="margin-top: 5px;">${lesson.task}</p>
                </div>
            `;
            
            document.getElementById('lesson-modal').classList.add('show');
        }
        
        function closeModal() {
            document.getElementById('lesson-modal').classList.remove('show');
        }
        
        function startSelectedLesson() {
            if (!currentLesson) return;
            closeModal();
            startLesson(currentLesson.id);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(title, message) {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notification-title');
            const notificationMessage = document.getElementById('notification-message');
            
            if (notification && notificationTitle && notificationMessage) {
                notificationTitle.textContent = title;
                notificationMessage.textContent = message;
                
                notification.className = 'notification';
                if (title.includes('üéâ') || title.includes('–£—Å–ø–µ—Ö')) {
                    notification.classList.add('notification-success');
                } else if (title.includes('‚ùå') || title.includes('–û—à–∏–±–∫–∞')) {
                    notification.classList.add('notification-error');
                } else {
                    notification.classList.add('notification-info');
                }
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 4000);
            }
        }
        
        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏
        window.showScreen = showScreen;
        window.runCode = runCode;
        window.submitCode = submitCode;
        window.startLesson = startLesson;
        window.startSelectedLesson = startSelectedLesson;
        window.clearOutput = clearOutput;
        window.closeModal = closeModal;
        window.openLessonModal = openLessonModal;
    </script>
</body>
</html>
