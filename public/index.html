<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>QuantumFlow v2.0 | 5 основных целей для улучшения жизни</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Стили сохраняются из вашего файла, добавляем только новые */
        /* Все существующие стили остаются */
        
        /* Новые стили для версии 2.0 */
        .goals-selection {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin: 30px 0;
        }
        
        .goal-card {
            padding: 24px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
        }
        
        .goal-card:hover {
            border-color: var(--primary);
            background: rgba(124, 58, 237, 0.05);
            transform: translateY(-3px);
        }
        
        .goal-card.selected {
            border-color: var(--primary);
            background: rgba(124, 58, 237, 0.1);
        }
        
        .goal-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            flex-shrink: 0;
        }
        
        .goal-icon.finance { background: linear-gradient(135deg, #10B981 0%, #3B82F6 100%); }
        .goal-icon.fitness { background: linear-gradient(135deg, #F59E0B 0%, #EC4899 100%); }
        .goal-icon.habits { background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%); }
        .goal-icon.productivity { background: linear-gradient(135deg, #06B6D4 0%, #3B82F6 100%); }
        .goal-icon.schedule { background: linear-gradient(135deg, #8B5CF6 0%, #10B981 100%); }
        
        .goal-content {
            flex: 1;
        }
        
        .goal-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }
        
        .goal-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .goal-deadline {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--text-tertiary);
        }
        
        .deadline-select {
            padding: 6px 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--surface);
            color: var(--text-primary);
            font-size: 0.85rem;
            cursor: pointer;
            margin-left: 8px;
        }
        
        .goal-checkbox {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .goal-card.selected .goal-checkbox {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        
        /* Страница настроек */
        .settings-section {
            margin-bottom: 32px;
        }
        
        .settings-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .settings-title i {
            color: var(--primary);
            font-size: 1.2rem;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .stat-card-large {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid var(--border);
        }
        
        .stat-card-large .stat-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 8px;
        }
        
        .stat-card-large .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .progress-circle {
            width: 100px;
            height: 100px;
            position: relative;
            margin: 0 auto 15px;
        }
        
        .progress-circle svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }
        
        .progress-circle-bg {
            fill: none;
            stroke: var(--surface-light);
            stroke-width: 8;
        }
        
        .progress-circle-fill {
            fill: none;
            stroke: var(--primary);
            stroke-width: 8;
            stroke-linecap: round;
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 1s ease;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-primary);
        }
        
        /* Карточки целей на главной */
        .goal-preview-card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary);
            transition: var(--transition);
        }
        
        .goal-preview-card:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }
        
        .goal-preview-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .goal-preview-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .goal-preview-progress {
            height: 6px;
            background: var(--surface-light);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .goal-preview-fill {
            height: 100%;
            background: var(--primary);
            border-radius: var(--radius-full);
            transition: width 1s ease;
        }
        
        /* Адаптивные улучшения */
        @media (max-width: 768px) {
            .goal-card {
                flex-direction: column;
                text-align: center;
                padding: 20px;
            }
            
            .goal-icon {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
            
            .goal-checkbox {
                position: absolute;
                top: 10px;
                right: 10px;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Анимация загрузки */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .loading {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <!-- Экран авторизации -->
    <div id="auth-page">
        <div class="auth-container">
            <div class="auth-card">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 3rem; color: var(--primary); margin-bottom: 10px;">
                        <i class="fas fa-atom"></i>
                    </div>
                    <h1 style="margin-bottom: 10px; font-size: 2.5rem;">QuantumFlow v2.0</h1>
                    <p style="color: var(--text-secondary);">Пять основных целей для улучшения жизни</p>
                </div>
                
                <div id="login-form">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="loginEmail" class="form-input" placeholder="demo@quantumflow.test" value="demo@quantumflow.test">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Пароль</label>
                        <input type="password" id="loginPassword" class="form-input" placeholder="••••••••" value="demo123">
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%;" onclick="auth.login()">
                        <i class="fas fa-sign-in-alt"></i> Войти
                    </button>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <a href="#" onclick="auth.showRegister()" style="color: var(--primary); text-decoration: none;">
                            Нет аккаунта? Зарегистрироваться
                        </a>
                    </div>
                </div>
                
                <div id="register-form" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" id="registerEmail" class="form-input" placeholder="ваш@email.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Имя</label>
                        <input type="text" id="registerName" class="form-input" placeholder="Ваше имя" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Пароль</label>
                        <input type="password" id="registerPassword" class="form-input" placeholder="••••••••" required>
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="auth.showGoalsSelection()">
                        <i class="fas fa-arrow-right"></i> Выбрать цели
                    </button>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <a href="#" onclick="auth.showLogin()" style="color: var(--primary); text-decoration: none;">
                            Уже есть аккаунт? Войти
                        </a>
                    </div>
                </div>
                
                <div id="goals-selection" style="display: none;">
                    <h2 style="margin-bottom: 20px; text-align: center;">Выберите ваши цели</h2>
                    <p style="color: var(--text-secondary); text-align: center; margin-bottom: 30px;">
                        Отметьте цели, которые хотите достичь, и укажите сроки
                    </p>
                    
                    <div class="goals-selection" id="goalsList">
                        <!-- Цели загружаются динамически -->
                    </div>
                    
                    <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="auth.completeRegistration()" id="completeBtn">
                        <i class="fas fa-rocket"></i> Начать путешествие
                    </button>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <a href="#" onclick="auth.showRegister()" style="color: var(--primary); text-decoration: none;">
                            <i class="fas fa-arrow-left"></i> Назад к регистрации
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Основное приложение -->
    <div id="app" style="display: none;">
        <!-- Основной контент -->
        <main>
            <!-- Главная страница - Обзор -->
            <div id="overview-page" class="page">
                <div class="container">
                    <div class="section-header">
                        <div>
                            <h1 class="section-title" id="greeting">
                                <i class="fas fa-home"></i>
                                Доброе утро!
                            </h1>
                            <p class="section-subtitle" id="dateDisplay"></p>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-secondary btn-sm" onclick="app.showQuickAddMenu()">
                                <i class="fas fa-plus"></i> Быстрое
                            </button>
                            <button class="btn btn-primary btn-sm" onclick="app.showReviewModal()">
                                <i class="fas fa-clipboard-check"></i> Ревью
                            </button>
                        </div>
                    </div>
                    
                    <!-- Активные цели -->
                    <div class="card" id="activeGoalsContainer">
                        <div class="section-header">
                            <h2 class="section-title">
                                <i class="fas fa-bullseye"></i>
                                Ваши активные цели
                            </h2>
                            <span class="btn btn-secondary btn-sm" onclick="app.navigateToPage('settings')">
                                Настроить
                            </span>
                        </div>
                        <div id="activeGoalsList">
                            <!-- Активные цели загружаются динамически -->
                        </div>
                    </div>
                    
                    <div class="stats-grid" id="statsGrid">
                        <!-- Динамически загружается -->
                    </div>
                    
                    <div class="card">
                        <div class="section-header">
                            <h2 class="section-title">
                                <i class="fas fa-tasks"></i>
                                Быстрые действия сегодня
                            </h2>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 20px;">
                            <button class="btn btn-primary btn-sm" onclick="app.navigateToPage('finance')">
                                <i class="fas fa-chart-line"></i> Финансы
                            </button>
                            <button class="btn btn-success btn-sm" onclick="app.navigateToPage('fitness')">
                                <i class="fas fa-dumbbell"></i> Тренировка
                            </button>
                            <button class="btn btn-warning btn-sm" onclick="app.navigateToPage('habits')">
                                <i class="fas fa-smoking-ban"></i> Привычки
                            </button>
                            <button class="btn btn-info btn-sm" onclick="app.navigateToPage('productivity')">
                                <i class="fas fa-brain"></i> Фокус
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Страница финансов -->
            <div id="finance-page" class="page">
                <div class="container">
                    <div class="section-header">
                        <h1 class="section-title">
                            <i class="fas fa-chart-line"></i>
                            Финансовая грамотность
                        </h1>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary btn-sm" onclick="app.showGoalModal()">
                                <i class="fas fa-piggy-bank"></i> Цель
                            </button>
                            <button class="btn btn-success btn-sm" onclick="app.showFinanceModal('income')">
                                <i class="fas fa-plus-circle"></i> Доход
                            </button>
                        </div>
                    </div>
                    
                    <!-- Основные показатели -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="currentBalance">0 ₽</div>
                            <div class="stat-label">Баланс</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="monthIncome">0 ₽</div>
                            <div class="stat-label">Доход</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="monthExpenses">0 ₽</div>
                            <div class="stat-label">Расход</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="savingsRate">0%</div>
                            <div class="stat-label">Накопления</div>
                        </div>
                    </div>
                    
                    <!-- Активные копилки -->
                    <div class="card">
                        <div class="section-header">
                            <h2 class="section-title">
                                <i class="fas fa-bullseye"></i>
                                Мои финансовые цели
                            </h2>
                            <button class="btn btn-secondary btn-sm" onclick="app.showGoalModal()">
                                <i class="fas fa-plus"></i> Новая
                            </button>
                        </div>
                        
                        <div id="financeGoalsList">
                            <!-- Копилки загружаются динамически -->
                        </div>
                    </div>
                    
                    <!-- Финансовые советы -->
                    <div class="card" id="financeAdviceContainer">
                        <h2 class="section-title">
                            <i class="fas fa-lightbulb"></i>
                            Персональные советы
                        </h2>
                        <div id="financeAdvice">
                            <!-- Советы загружаются динамически -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Страница фитнеса -->
            <div id="fitness-page" class="page">
                <div class="container">
                    <div class="section-header">
                        <h1 class="section-title">
                            <i class="fas fa-dumbbell"></i>
                            Фитнес и похудение
                        </h1>
                        <button class="btn btn-primary btn-sm" onclick="app.showWorkoutModal()">
                            <i class="fas fa-plus"></i> Тренировка
                        </button>
                    </div>
                    
                    <!-- Показатели здоровья -->
                    <div class="health-metrics" id="healthMetrics">
                        <!-- Динамически загружается -->
                    </div>
                    
                    <!-- Рекомендации по тренировкам -->
                    <div class="card">
                        <div class="section-header">
                            <h2 class="section-title">
                                <i class="fas fa-fire"></i>
                                Рекомендуемые тренировки
                            </h2>
                            <button class="btn btn-secondary btn-sm" onclick="app.loadFitnessRecommendations()">
                                <i class="fas fa-redo"></i> Обновить
                            </button>
                        </div>
                        
                        <div id="workoutRecommendations">
                            <!-- Рекомендации загружаются динамически -->
                        </div>
                    </div>
                    
                    <!-- Таймер тренировки -->
                    <div class="pomodoro-timer" id="workoutTimerContainer" style="display: none;">
                        <h3 style="margin-bottom: 10px;" id="workoutTitle">Тренировка</h3>
                        <div class="timer-display" id="workoutTimer">00:00</div>
                        <div class="timer-controls">
                            <button class="btn btn-primary" onclick="app.startWorkoutTimer()" id="startWorkoutBtn">
                                <i class="fas fa-play"></i> Старт
                            </button>
                            <button class="btn btn-success" onclick="app.completeWorkout()" id="completeWorkoutBtn" style="display: none;">
                                <i class="fas fa-check"></i> Завершить
                            </button>
                            <button class="btn btn-secondary" onclick="app.resetWorkoutTimer()">
                                <i class="fas fa-redo"></i> Сброс
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Страница вредных привычек -->
            <div id="habits-page" class="page">
                <div class="container">
                    <div class="section-header">
                        <h1 class="section-title">
                            <i class="fas fa-smoking-ban"></i>
                            Отказ от вредных привычек
                        </h1>
                        <button class="btn btn-primary btn-sm" onclick="app.showHabitTrackerModal()">
                            <i class="fas fa-plus"></i> Отслеживать
                        </button>
                    </div>
                    
                    <!-- Статистика отказа -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="daysSmokeFree">0</div>
                            <div class="stat-label">Дней без сигарет</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="daysAlcoholFree">0</div>
                            <div class="stat-label">Дней без алкоголя</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="moneySaved">0 ₽</div>
                            <div class="stat-label">Сэкономлено</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="healthScore">0</div>
                            <div class="stat-label">Очков здоровья</div>
                        </div>
                    </div>
                    
                    <!-- Практики для отказа -->
                    <div class="card">
                        <h2 class="section-title">
                            <i class="fas fa-brain"></i>
                            Практики для отказа
                        </h2>
                        <div id="quittingPractices">
                            <!-- Практики загружаются динамически -->
                        </div>
                    </div>
                    
                    <!-- Прогресс -->
                    <div class="card">
                        <h2 class="section-title">
                            <i class="fas fa-chart-line"></i>
                            Ваш прогресс
                        </h2>
                        <div id="habitProgress">
                            <!-- Прогресс загружается динамически -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Страница продуктивности -->
            <div id="productivity-page" class="page">
                <div class="container">
                    <div class="section-header">
                        <h1 class="section-title">
                            <i class="fas fa-brain"></i>
                            Личная эффективность
                        </h1>
                        <button class="btn btn-primary btn-sm" onclick="app.showProductivityModal()">
                            <i class="fas fa-plus"></i> Метод
                        </button>
                    </div>
                    
                    <!-- Таймер Pomodoro -->
                    <div class="pomodoro-timer">
                        <h3 style="margin-bottom: 10px;">Метод Pomodoro</h3>
                        <div class="timer-display" id="timerDisplay">25:00</div>
                        <div class="timer-controls">
                            <button class="btn btn-primary" onclick="app.startTimer()" id="startTimerBtn">
                                <i class="fas fa-play"></i> Старт
                            </button>
                            <button class="btn btn-secondary" onclick="app.resetTimer()" id="resetTimerBtn">
                                <i class="fas fa-redo"></i> Сброс
                            </button>
                        </div>
                    </div>
                    
                    <!-- Методы эффективности -->
                    <div class="card">
                        <div class="section-header">
                            <h2 class="section-title">
                                <i class="fas fa-tools"></i>
                                Методы эффективности
                            </h2>
                            <button class="btn btn-secondary btn-sm" onclick="app.loadProductivityMethods()">
                                <i class="fas fa-redo"></i> Обновить
                            </button>
                        </div>
                        
                        <div id="productivityMethods">
                            <!-- Методы загружаются динамически -->
                        </div>
                    </div>
                    
                    <!-- Статистика фокуса -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="sessionsCompleted">0</div>
                            <div class="stat-label">Сессий завершено</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgFocusScore">0%</div>
                            <div class="stat-label">Средний фокус</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalFocusTime">0</div>
                            <div class="stat-label">Минут в фокусе</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="productivityLevel">1</div>
                            <div class="stat-label">Уровень</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Страница распорядка дня -->
            <div id="schedule-page" class="page">
                <div class="container">
                    <div class="section-header">
                        <h1 class="section-title">
                            <i class="fas fa-calendar-alt"></i>
                            Распорядок дня
                        </h1>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn btn-primary btn-sm" onclick="app.generateDailySchedule()">
                                <i class="fas fa-magic"></i> Сгенерировать
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="app.showScheduleModal()">
                                <i class="fas fa-plus"></i> Активность
                            </button>
                        </div>
                    </div>
                    
                    <!-- Прогресс дня -->
                    <div class="card">
                        <div class="section-header">
                            <h2 class="section-title">
                                <i class="fas fa-chart-pie"></i>
                                Прогресс сегодня
                            </h2>
                            <div class="progress-circle">
                                <svg>
                                    <circle class="progress-circle-bg" cx="50" cy="50" r="45"></circle>
                                    <circle class="progress-circle-fill" cx="50" cy="50" r="45"></circle>
                                </svg>
                                <div class="progress-text" id="scheduleProgress">0%</div>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 15px;">
                            <div id="scheduleStats">0/0 активностей выполнено</div>
                        </div>
                    </div>
                    
                    <!-- Распорядок на день -->
                    <div class="card">
                        <h2 class="section-title">
                            <i class="fas fa-list"></i>
                            Мой день
                        </h2>
                        <div id="dailySchedule">
                            <!-- Распорядок загружается динамически -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Страница настроек -->
            <div id="settings-page" class="page">
                <div class="container">
                    <div class="section-header">
                        <h1 class="section-title">
                            <i class="fas fa-cog"></i>
                            Настройки профиля
                        </h1>
                        <button class="btn btn-primary btn-sm" onclick="app.showEditProfileModal()">
                            <i class="fas fa-edit"></i> Редактировать
                        </button>
                    </div>
                    
                    <!-- Информация о пользователе -->
                    <div class="card" style="text-align: center;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; background: var(--gradient-primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: 900; margin: 0 auto 20px;">
                            <i class="fas fa-user"></i>
                        </div>
                        <h2 style="margin-bottom: 10px;" id="userName"></h2>
                        <p style="color: var(--text-secondary); margin-bottom: 20px;" id="userEmail"></p>
                        
                        <div style="display: flex; justify-content: center; gap: 15px; margin: 20px 0;">
                            <div class="stat-card">
                                <div class="stat-value" id="settingsCoins">0</div>
                                <div class="stat-label">Монет</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="settingsLevel">1</div>
                                <div class="stat-label">Уровень</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="settingsStreak">0</div>
                                <div class="stat-label">Дней</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Мои цели -->
                    <div class="settings-section">
                        <h2 class="settings-title">
                            <i class="fas fa-bullseye"></i>
                            Мои цели и сроки
                        </h2>
                        <div id="userGoalsSettings">
                            <!-- Цели загружаются динамически -->
                        </div>
                    </div>
                    
                    <!-- Статистика -->
                    <div class="settings-section">
                        <h2 class="settings-title">
                            <i class="fas fa-chart-bar"></i>
                            Статистика
                        </h2>
                        <div class="settings-grid" id="userStats">
                            <!-- Статистика загружается динамически -->
                        </div>
                    </div>
                    
                    <!-- Достижения -->
                    <div class="settings-section">
                        <h2 class="settings-title">
                            <i class="fas fa-trophy"></i>
                            Достижения
                        </h2>
                        <div id="achievementsList">
                            <!-- Достижения загружаются динамически -->
                        </div>
                    </div>
                    
                    <!-- Управление аккаунтом -->
                    <div class="card">
                        <h3 style="margin-bottom: 15px;">Управление аккаунтом</h3>
                        <button class="btn btn-secondary" style="width: 100%; margin-bottom: 10px;" onclick="app.showExportDataModal()">
                            <i class="fas fa-download"></i> Экспорт данных
                        </button>
                        <button class="btn btn-danger" style="width: 100%;" onclick="auth.logout()">
                            <i class="fas fa-sign-out-alt"></i> Выйти из аккаунта
                        </button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Быстрое добавление -->
        <div class="quick-add">
            <div class="quick-add-btn" onclick="app.showQuickAddMenu()">
                <i class="fas fa-plus"></i>
            </div>
        </div>
        
        <!-- Нижняя навигация -->
        <nav class="bottom-nav" id="bottomNav">
            <a href="#" class="nav-item active" onclick="app.navigateToPage('overview')" data-page="overview">
                <i class="fas fa-home"></i>
                <span>Обзор</span>
            </a>
            <a href="#" class="nav-item" onclick="app.navigateToPage('finance')" data-page="finance">
                <i class="fas fa-chart-line"></i>
                <span>Финансы</span>
            </a>
            <a href="#" class="nav-item" onclick="app.navigateToPage('fitness')" data-page="fitness">
                <i class="fas fa-dumbbell"></i>
                <span>Фитнес</span>
            </a>
            <a href="#" class="nav-item" onclick="app.navigateToPage('habits')" data-page="habits">
                <i class="fas fa-smoking-ban"></i>
                <span>Привычки</span>
            </a>
            <a href="#" class="nav-item" onclick="app.navigateToPage('productivity')" data-page="productivity">
                <i class="fas fa-brain"></i>
                <span>Фокус</span>
            </a>
            <a href="#" class="nav-item" onclick="app.navigateToPage('settings')" data-page="settings">
                <i class="fas fa-cog"></i>
                <span>Настройки</span>
            </a>
        </nav>
        
        <!-- Модальные окна -->
        <!-- Существующие модальные окна остаются -->
        <!-- Добавляем новые модальные окна для версии 2.0 -->
        
        <div class="modal" id="editProfileModal">
            <div class="modal-content">
                <h3 style="color: var(--text-primary); margin-bottom: 20px;">Редактировать профиль</h3>
                <form id="editProfileForm">
                    <div class="form-group">
                        <label class="form-label">Имя</label>
                        <input type="text" id="editFirstName" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Фамилия</label>
                        <input type="text" id="editLastName" class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Вес (кг)</label>
                        <input type="number" id="editWeight" class="form-input" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Целевой вес (кг)</label>
                        <input type="number" id="editTargetWeight" class="form-input" step="0.1">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Уровень активности</label>
                        <select id="editActivityLevel" class="form-input">
                            <option value="low">Низкая</option>
                            <option value="medium">Средняя</option>
                            <option value="high">Высокая</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-save"></i> Сохранить изменения
                    </button>
                </form>
            </div>
        </div>
        
        <div class="modal" id="workoutModal">
            <div class="modal-content">
                <h3 style="color: var(--text-primary); margin-bottom: 20px;">Начать тренировку</h3>
                <form id="workoutForm">
                    <div class="form-group">
                        <label class="form-label">Тип тренировки</label>
                        <select id="workoutType" class="form-input" onchange="app.toggleWorkoutFields()">
                            <option value="recommended">Рекомендованная</option>
                            <option value="custom">Своя тренировка</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="recommendedWorkoutsContainer">
                        <label class="form-label">Выберите программу</label>
                        <div id="recommendedWorkoutsList">
                            <!-- Загружается динамически -->
                        </div>
                    </div>
                    
                    <div class="form-group" id="customWorkoutContainer" style="display: none;">
                        <label class="form-label">Название тренировки</label>
                        <input type="text" id="customWorkoutTitle" class="form-input" placeholder="Например: Утренняя зарядка">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Длительность (минут)</label>
                        <input type="number" id="workoutDuration" class="form-input" value="30" min="5" max="180">
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-play"></i> Начать тренировку
                    </button>
                </form>
            </div>
        </div>
        
        <div class="modal" id="habitTrackerModal">
            <div class="modal-content">
                <h3 style="color: var(--text-primary); margin-bottom: 20px;">Отслеживание привычки</h3>
                <form id="habitTrackerForm">
                    <div class="form-group">
                        <label class="form-label">Какая привычка?</label>
                        <select id="habitType" class="form-input">
                            <option value="smoking">Курение</option>
                            <option value="alcohol">Алкоголь</option>
                            <option value="other">Другая привычка</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ваш статус</label>
                        <select id="habitStatus" class="form-input">
                            <option value="active">Пытаюсь бросить</option>
                            <option value="maintaining">Уже бросил, поддерживаю</option>
                            <option value="planning">Планирую бросить</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Дата начала (если уже бросили)</label>
                        <input type="date" id="habitStartDate" class="form-input">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Заметки (опционально)</label>
                        <textarea id="habitNotes" class="form-input" rows="3" placeholder="Что вас мотивирует? Какие сложности?"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-save"></i> Начать отслеживание
                    </button>
                </form>
            </div>
        </div>
        
        <div class="modal" id="productivityModal">
            <div class="modal-content">
                <h3 style="color: var(--text-primary); margin-bottom: 20px;">Выберите метод продуктивности</h3>
                <div id="productivityMethodsModal">
                    <!-- Методы загружаются динамически -->
                </div>
            </div>
        </div>
        
        <div class="modal" id="scheduleModal">
            <div class="modal-content">
                <h3 style="color: var(--text-primary); margin-bottom: 20px;">Добавить активность</h3>
                <form id="scheduleForm">
                    <div class="form-group">
                        <label class="form-label">Время</label>
                        <input type="time" id="scheduleTime" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Активность</label>
                        <input type="text" id="scheduleActivity" class="form-input" placeholder="Что планируете делать?" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Длительность (минут)</label>
                        <input type="number" id="scheduleDuration" class="form-input" value="60" min="5" max="480">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Приоритет</label>
                        <select id="schedulePriority" class="form-input">
                            <option value="1">Высокий (обязательно)</option>
                            <option value="2" selected>Средний (желательно)</option>
                            <option value="3">Низкий (по возможности)</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-save"></i> Добавить в расписание
                    </button>
                </form>
            </div>
        </div>
        
        <div class="modal" id="exportDataModal">
            <div class="modal-content">
                <h3 style="color: var(--text-primary); margin-bottom: 20px;">Экспорт данных</h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    Вы можете экспортировать все свои данные в формате JSON для резервного копирования.
                </p>
                
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="app.exportUserData()">
                        <i class="fas fa-download"></i> Экспортировать данные
                    </button>
                    <button class="btn btn-secondary" onclick="app.closeAllModals()">
                        Отмена
                    </button>
                </div>
                
                <div id="exportResult" style="margin-top: 20px; display: none;">
                    <textarea id="exportDataText" style="width: 100%; height: 200px; padding: 10px; border-radius: var(--radius); background: var(--surface); color: var(--text-primary); border: 1px solid var(--border);"></textarea>
                    <button class="btn btn-secondary btn-sm" onclick="app.copyExportData()" style="margin-top: 10px;">
                        <i class="fas fa-copy"></i> Копировать
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Основной объект приложения
        const QuantumFlow = {
            version: '2.0.0',
            user: null,
            token: null,
            currentPage: 'overview',
            activeWorkout: null,
            activePractice: null,
            
            init: function(user, token) {
                this.user = user;
                this.token = token;
                this.setupEventListeners();
                this.updateDate();
                this.loadOverviewData();
                this.setupNavigation();
                this.updateGreeting();
            },
            
            // Навигация
            navigateToPage: function(pageId) {
                this.currentPage = pageId;
                
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-page') === pageId) {
                        item.classList.add('active');
                    }
                });
                
                const targetPage = document.getElementById(pageId + '-page');
                if (targetPage) {
                    targetPage.classList.add('active');
                    
                    switch(pageId) {
                        case 'overview':
                            this.loadOverviewData();
                            break;
                        case 'finance':
                            this.loadFinanceData();
                            break;
                        case 'fitness':
                            this.loadFitnessData();
                            break;
                        case 'habits':
                            this.loadHabitsData();
                            break;
                        case 'productivity':
                            this.loadProductivityData();
                            break;
                        case 'schedule':
                            this.loadScheduleData();
                            break;
                        case 'settings':
                            this.loadSettingsData();
                            break;
                    }
                }
            },
            
            // Загрузка данных главной страницы
            loadOverviewData: async function() {
                try {
                    const response = await fetch('/api/user/stats', {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.updateOverviewStats(data.data);
                        this.updateActiveGoals();
                    }
                } catch (error) {
                    console.error('Error loading overview data:', error);
                    this.showNotification('Ошибка загрузки данных', 'error');
                }
            },
            
            updateOverviewStats: function(data) {
                const statsGrid = document.getElementById('statsGrid');
                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${data.user_data.coins || 0}</div>
                        <div class="stat-label">Монет</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${data.user_data.level || 1}</div>
                        <div class="stat-label">Уровень</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${data.user_data.streak || 0}</div>
                        <div class="stat-label">Дней</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${data.finance_stats?.balance?.toLocaleString('ru-RU') || 0} ₽</div>
                        <div class="stat-label">Баланс</div>
                    </div>
                `;
            },
            
            updateActiveGoals: function() {
                const container = document.getElementById('activeGoalsList');
                if (!this.user) return;
                
                const goals = [];
                if (this.user.goal_1_finance) goals.push({
                    title: 'Финансовая грамотность',
                    deadline: this.user.goal_1_deadline,
                    progress: 65,
                    icon: 'fas fa-chart-line',
                    color: '#10B981'
                });
                
                if (this.user.goal_2_fitness) goals.push({
                    title: 'Фитнес и похудение',
                    deadline: this.user.goal_2_deadline,
                    progress: 40,
                    icon: 'fas fa-dumbbell',
                    color: '#F59E0B'
                });
                
                if (this.user.goal_3_habits) goals.push({
                    title: 'Отказ от вредных привычек',
                    deadline: this.user.goal_3_deadline,
                    progress: 80,
                    icon: 'fas fa-smoking-ban',
                    color: '#8B5CF6'
                });
                
                if (this.user.goal_4_productivity) goals.push({
                    title: 'Личная эффективность',
                    deadline: this.user.goal_4_deadline,
                    progress: 50,
                    icon: 'fas fa-brain',
                    color: '#06B6D4'
                });
                
                if (this.user.goal_5_schedule) goals.push({
                    title: 'Распорядок дня',
                    deadline: this.user.goal_5_deadline,
                    progress: 30,
                    icon: 'fas fa-calendar-alt',
                    color: '#8B5CF6'
                });
                
                if (goals.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 30px; color: var(--text-secondary);">
                            <i class="fas fa-bullseye" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>У вас нет активных целей</p>
                            <button class="btn btn-primary btn-sm" onclick="app.navigateToPage('settings')" style="margin-top: 10px;">
                                <i class="fas fa-cog"></i> Настроить цели
                            </button>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = goals.map(goal => `
                    <div class="goal-preview-card" onclick="app.navigateToPage('${goal.title.includes('Финанс') ? 'finance' : 
                                                                               goal.title.includes('Фитнес') ? 'fitness' : 
                                                                               goal.title.includes('Привыч') ? 'habits' : 
                                                                               goal.title.includes('Эффектив') ? 'productivity' : 'schedule'}')">
                        <div class="goal-preview-header">
                            <div class="goal-preview-title">
                                <i class="${goal.icon}" style="color: ${goal.color};"></i>
                                ${goal.title}
                            </div>
                            <span style="color: var(--text-tertiary); font-size: 0.85rem;">
                                ${goal.deadline} мес.
                            </span>
                        </div>
                        <div class="goal-preview-progress">
                            <div class="goal-preview-fill" style="width: ${goal.progress}%; background: ${goal.color};"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary);">
                            <span>Прогресс</span>
                            <span>${goal.progress}%</span>
                        </div>
                    </div>
                `).join('');
            },
            
            // Финансы
            loadFinanceData: async function() {
                try {
                    const response = await fetch('/api/finance/full-stats', {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.updateFinanceData(data.data);
                    }
                } catch (error) {
                    console.error('Error loading finance data:', error);
                    this.showNotification('Ошибка загрузки финансовых данных', 'error');
                }
            },
            
            updateFinanceData: function(data) {
                document.getElementById('currentBalance').textContent = 
                    `${data.balance.toLocaleString('ru-RU', {minimumFractionDigits: 2})} ₽`;
                document.getElementById('monthIncome').textContent = 
                    `${data.monthly_income.toLocaleString('ru-RU', {minimumFractionDigits: 2})} ₽`;
                document.getElementById('monthExpenses').textContent = 
                    `${data.monthly_expenses.toLocaleString('ru-RU', {minimumFractionDigits: 2})} ₽`;
                document.getElementById('savingsRate').textContent = `${data.savings_rate}%`;
                
                // Обновление целей
                const goalsContainer = document.getElementById('financeGoalsList');
                if (data.active_goals.length === 0) {
                    goalsContainer.innerHTML = `
                        <div style="text-align: center; padding: 30px; color: var(--text-secondary);">
                            <i class="fas fa-piggy-bank" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>У вас нет финансовых целей</p>
                            <button class="btn btn-primary btn-sm" onclick="app.showGoalModal()" style="margin-top: 10px;">
                                <i class="fas fa-plus"></i> Создать цель
                            </button>
                        </div>
                    `;
                } else {
                    goalsContainer.innerHTML = data.active_goals.map(goal => {
                        const progress = Math.min((goal.current_amount / goal.target_amount) * 100, 100);
                        return `
                            <div style="margin-bottom: 15px; padding: 15px; border: 1px solid var(--border); border-radius: var(--radius);">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 40px; height: 40px; background: var(--primary); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                        <i class="${goal.icon}" style="color: white; font-size: 1.2rem;"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <h3 style="margin-bottom: 5px;">${goal.title}</h3>
                                        <div style="font-size: 0.9rem; color: var(--text-secondary);">
                                            ${goal.current_amount.toLocaleString('ru-RU')} / ${goal.target_amount.toLocaleString('ru-RU')} ₽
                                        </div>
                                    </div>
                                    <button class="btn btn-primary btn-sm" onclick="app.addToGoal(${goal.id})">
                                        <i class="fas fa-plus"></i> Добавить
                                    </button>
                                </div>
                                <div style="height: 8px; background: var(--surface-light); border-radius: var(--radius-full); overflow: hidden; margin-bottom: 10px;">
                                    <div style="height: 100%; width: ${progress}%; background: var(--success); border-radius: var(--radius-full);"></div>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-tertiary);">
                                    <span>Прогресс: ${progress.toFixed(1)}%</span>
                                    ${goal.deadline ? `<span>До ${new Date(goal.deadline).toLocaleDateString('ru-RU')}</span>` : ''}
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                // Обновление советов
                const adviceContainer = document.getElementById('financeAdvice');
                if (data.advice.length === 0) {
                    adviceContainer.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
                            <p>Нет данных для рекомендаций</p>
                        </div>
                    `;
                } else {
                    adviceContainer.innerHTML = data.advice.map(advice => `
                        <div style="padding: 15px; border-bottom: 1px solid var(--border);">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <i class="fas fa-lightbulb" style="color: var(--warning); margin-right: 10px;"></i>
                                <h3 style="flex: 1;">Совет по категории "${advice.category}"</h3>
                            </div>
                            <p style="color: var(--text-secondary); margin-bottom: 10px;">${advice.advice_text}</p>
                            ${advice.action_items ? `
                                <div style="font-size: 0.9rem; color: var(--text-tertiary);">
                                    <strong>Действия:</strong> ${JSON.parse(advice.action_items).join(', ')}
                                </div>
                            ` : ''}
                        </div>
                    `).join('');
                }
            },
            
            addToGoal: async function(goalId) {
                const amount = prompt('Сколько вы хотите добавить в копилку?', '1000');
                if (!amount || isNaN(amount) || parseFloat(amount) <= 0) {
                    this.showNotification('Укажите корректную сумму', 'error');
                    return;
                }
                
                try {
                    const response = await fetch(`/api/finance/goals/${goalId}/add`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ amount: parseFloat(amount) })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.showNotification(data.message);
                        this.loadFinanceData();
                    } else {
                        this.showNotification(data.error, 'error');
                    }
                } catch (error) {
                    console.error('Error adding to goal:', error);
                    this.showNotification('Ошибка добавления средств', 'error');
                }
            },
            
            // Фитнес
            loadFitnessData: async function() {
                try {
                    const response = await fetch('/api/fitness/recommendations', {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.updateFitnessData(data.data);
                    }
                } catch (error) {
                    console.error('Error loading fitness data:', error);
                    this.showNotification('Ошибка загрузки данных фитнеса', 'error');
                }
            },
            
            updateFitnessData: function(data) {
                // Обновление метрик здоровья
                const metricsContainer = document.getElementById('healthMetrics');
                metricsContainer.innerHTML = `
                    <div class="metric-card">
                        <div class="metric-value">${this.user.weight ? this.user.weight.toFixed(1) : '--'}</div>
                        <div class="metric-label">Вес (кг)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${this.user.target_weight || '--'}</div>
                        <div class="stat-label">Целевой вес</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${data.calorie_info?.daily_maintenance || '--'}</div>
                        <div class="stat-label">Ккал/день</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${this.user.activity_level ? this.user.activity_level : '--'}</div>
                        <div class="stat-label">Активность</div>
                    </div>
                `;
                
                // Обновление рекомендаций
                const recommendationsContainer = document.getElementById('workoutRecommendations');
                if (data.recommendations.length === 0) {
                    recommendationsContainer.innerHTML = `
                        <div style="text-align: center; padding: 30px; color: var(--text-secondary);">
                            <i class="fas fa-dumbbell" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>Нет доступных рекомендаций</p>
                        </div>
                    `;
                } else {
                    recommendationsContainer.innerHTML = data.recommendations.map(program => `
                        <div style="margin-bottom: 15px; padding: 15px; border: 1px solid var(--border); border-radius: var(--radius);">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                <h3 style="margin-bottom: 5px;">${program.title}</h3>
                                <span style="background: var(--primary); color: white; padding: 4px 8px; border-radius: var(--radius); font-size: 0.8rem;">
                                    ${program.difficulty}
                                </span>
                            </div>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 10px;">
                                ${program.description}
                            </p>
                            <div style="display: flex; justify-content: space-between; color: var(--text-tertiary); font-size: 0.85rem; margin-bottom: 15px;">
                                <span><i class="fas fa-clock"></i> ${program.duration} мин</span>
                                <span><i class="fas fa-fire"></i> ${program.calories} ккал</span>
                            </div>
                            <button class="btn btn-primary btn-sm" style="width: 100%;" onclick="app.startWorkoutProgram(${program.id})">
                                <i class="fas fa-play"></i> Начать эту тренировку
                            </button>
                        </div>
                    `).join('');
                }
            },
            
            startWorkoutProgram: async function(programId) {
                try {
                    const response = await fetch('/api/fitness/start-workout', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ program_id: programId })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.activeWorkout = data.data.workout;
                        this.showWorkoutTimer(data.data.workout.title, data.data.timer_duration);
                        this.showNotification('Тренировка начата! Удачи!');
                    } else {
                        this.showNotification(data.error, 'error');
                    }
                } catch (error) {
                    console.error('Error starting workout:', error);
                    this.showNotification('Ошибка начала тренировки', 'error');
                }
            },
            
            showWorkoutTimer: function(title, duration) {
                document.getElementById('workoutTimerContainer').style.display = 'block';
                document.getElementById('workoutTitle').textContent = title;
                document.getElementById('workoutTimer').textContent = this.formatTime(duration);
                
                this.workoutTimerDuration = duration;
                this.workoutTimerActive = false;
                this.updateWorkoutTimerButtons();
            },
            
            // Вредные привычки
            loadHabitsData: async function() {
                try {
                    const response = await fetch('/api/habits/practices', {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.updateHabitsData(data.data);
                    }
                } catch (error) {
                    console.error('Error loading habits data:', error);
                    this.showNotification('Ошибка загрузки данных привычек', 'error');
                }
            },
            
            updateHabitsData: function(data) {
                // Обновление статистики
                document.getElementById('daysSmokeFree').textContent = data.stats.days_smoke_free || 0;
                document.getElementById('daysAlcoholFree').textContent = data.stats.days_alcohol_free || 0;
                document.getElementById('moneySaved').textContent = 
                    `${(data.money_saved.smoking + data.money_saved.alcohol).toLocaleString('ru-RU')} ₽`;
                document.getElementById('healthScore').textContent = data.stats.days_smoke_free + data.stats.days_alcohol_free;
                
                // Обновление практик
                const practicesContainer = document.getElementById('quittingPractices');
                if (data.practices.length === 0) {
                    practicesContainer.innerHTML = `
                        <div style="text-align: center; padding: 30px; color: var(--text-secondary);">
                            <i class="fas fa-brain" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                            <p>Нет доступных практик для вашего статуса</p>
                        </div>
                    `;
                } else {
                    practicesContainer.innerHTML = data.practices.map(practice => `
                        <div style="margin-bottom: 15px; padding: 15px; border: 1px solid var(--border); border-radius: var(--radius);">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                                <h3 style="margin-bottom: 5px;">${practice.title}</h3>
                                <span style="background: ${practice.for_habit === 'smoking' ? '#EF4444' : '#3B82F6'}; color: white; padding: 4px 8px; border-radius: var(--radius); font-size: 0.8rem;">
                                    ${practice.for_habit === 'smoking' ? 'Курение' : 'Алкоголь'}
                                </span>
                            </div>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 10px;">
                                ${practice.description}
                            </p>
                            <div style="display: flex; justify-content: space-between; color: var(--text-tertiary); font-size: 0.85rem; margin-bottom: 15px;">
                                <span><i class="fas fa-clock"></i> ${practice.duration} мин</span>
                                <span><i class="fas fa-chart-line"></i> ${practice.success_rate}% успеха</span>
                            </div>
                            <button class="btn btn-primary btn-sm" style="width: 100%;" onclick="app.startQuittingPractice(${practice.id}, '${practice.for_habit}')">
                                <i class="fas fa-play"></i> Начать эту практику
                            </button>
                        </div>
                    `).join('');
                }
                
                // Обновление прогресса
                const progressContainer = document.getElementById('habitProgress');
                if (data.health_improvements.length === 0) {
                    progressContainer.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: var(--text-secondary);">
                            <p>Начните отслеживание привычек, чтобы увидеть прогресс</p>
                        </div>
                    `;
                } else {
                    progressContainer.innerHTML = `
                        <div style="margin-bottom: 15px;">
                            <h3 style="margin-bottom: 10px; color: var(--text-primary);">Улучшения здоровья:</h3>
                            <ul style="color: var(--text-secondary); padding-left: 20px;">
                                ${data.health_improvements.map(improvement => `
                                    <li style="margin-bottom: 8px;">${improvement}</li>
                                `).join('')}
                            </ul>
                        </div>
                    `;
                }
            },
            
            startQuittingPractice: async function(practiceId, habitType) {
                try {
                    const response = await fetch('/api/habits/start-practice', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${this.token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ practice_id: practiceId, habit_type: habitType })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.activePractice = data.data;
                        this.showNotification('Практика начата! Вы на правильном пути!');
                        this.loadHabitsData();
                    } else {
                        this.showNotification(data.error, 'error');
                    }
                } catch (error) {
                    console.error('Error starting practice:', error);
                    this.showNotification('Ошибка начала практики', 'error');
                }
            },
            
            // Настройки профиля
            loadSettingsData: async function() {
                try {
                    // Загружаем данные пользователя
                    const userResponse = await fetch('/api/user/current', {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });
                    
                    const userData = await userResponse.json();
                    
                    if (userData.success) {
                        this.updateSettingsProfile(userData.data);
                    }
                    
                    // Загружаем статистику
                    const statsResponse = await fetch('/api/user/stats', {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });
                    
                    const statsData = await statsResponse.json();
                    
                    if (statsData.success) {
                        this.updateSettingsStats(statsData.data);
                    }
                    
                    // Загружаем достижения
                    const achievementsResponse = await fetch('/api/achievements', {
                        headers: {
                            'Authorization': `Bearer ${this.token}`
                        }
                    });
                    
                    const achievementsData = await achievementsResponse.json();
                    
                    if (achievementsData.success) {
                        this.updateSettingsAchievements(achievementsData.data);
                    }
                    
                } catch (error) {
                    console.error('Error loading settings data:', error);
                    this.showNotification('Ошибка загрузки настроек', 'error');
                }
            },
            
            updateSettingsProfile: function(user) {
                document.getElementById('userName').textContent = 
                    `${user.first_name} ${user.last_name || ''}`.trim();
                document.getElementById('userEmail').textContent = user.email;
                document.getElementById('settingsCoins').textContent = user.coins || 0;
                document.getElementById('settingsLevel').textContent = user.level || 1;
                document.getElementById('settingsStreak').textContent = user.streak || 0;
                
                // Обновление целей пользователя
                this.updateUserGoalsInSettings(user);
            },
            
            updateUserGoalsInSettings: function(user) {
                const container = document.getElementById('userGoalsSettings');
                const goals = [];
                
                if (user.goal_1_finance) goals.push({
                    id: 1,
                    title: 'Финансовая грамотность',
                    deadline: user.goal_1_deadline,
                    icon: 'fas fa-chart-line',
                    color: '#10B981'
                });
                
                if (user.goal_2_fitness) goals.push({
                    id: 2,
                    title: 'Фитнес и похудение',
                    deadline: user.goal_2_deadline,
                    icon: 'fas fa-dumbbell',
                    color: '#F59E0B'
                });
                
                if (user.goal_3_habits) goals.push({
                    id: 3,
                    title: 'Отказ от вредных привычек',
                    deadline: user.goal_3_deadline,
                    icon: 'fas fa-smoking-ban',
                    color: '#8B5CF6'
                });
                
                if (user.goal_4_productivity) goals.push({
                    id: 4,
                    title: 'Личная эффективность',
                    deadline: user.goal_4_deadline,
                    icon: 'fas fa-brain',
                    color: '#06B6D4'
                });
                
                if (user.goal_5_schedule) goals.push({
                    id: 5,
                    title: 'Распорядок дня',
                    deadline: user.goal_5_deadline,
                    icon: 'fas fa-calendar-alt',
                    color: '#8B5CF6'
                });
                
                if (goals.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 30px; border: 2px dashed var(--border); border-radius: var(--radius);">
                            <i class="fas fa-bullseye" style="font-size: 3rem; margin-bottom: 15px; color: var(--text-tertiary);"></i>
                            <p style="color: var(--text-secondary); margin-bottom: 15px;">У вас нет активных целей</p>
                            <button class="btn btn-primary" onclick="app.showEditProfileModal()">
                                <i class="fas fa-plus"></i> Добавить цели
                            </button>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        ${goals.map(goal => `
                            <div style="padding: 20px; border: 1px solid var(--border); border-radius: var(--radius);">
                                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                                    <div style="width: 40px; height: 40px; border-radius: var(--radius); background: ${goal.color}; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                        <i class="${goal.icon}" style="color: white; font-size: 1.2rem;"></i>
                                    </div>
                                    <div>
                                        <h3 style="margin-bottom: 5px;">${goal.title}</h3>
                                        <div style="font-size: 0.85rem; color: var(--text-tertiary);">
                                            Срок: ${goal.deadline} мес.
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-secondary btn-sm" style="width: 100%;" onclick="app.editGoal(${goal.id})">
                                    <i class="fas fa-edit"></i> Изменить срок
                                </button>
                            </div>
                        `).join('')}
                    </div>
                `;
            },
            
            updateSettingsStats: function(data) {
                const container = document.getElementById('userStats');
                container.innerHTML = `
                    <div class="stat-card-large">
                        <div class="stat-value">${data.finance_goals?.total_goals || 0}</div>
                        <div class="stat-label">Финансовых целей</div>
                    </div>
                    <div class="stat-card-large">
                        <div class="stat-value">${data.workout_stats?.total_workouts || 0}</div>
                        <div class="stat-label">Тренировок</div>
                    </div>
                    <div class="stat-card-large">
                        <div class="stat-value">${data.user_data?.tasks_completed || 0}</div>
                        <div class="stat-label">Выполненных задач</div>
                    </div>
                    <div class="stat-card-large">
                        <div class="stat-value">${Math.round(data.weight_progress?.lost || 0)} кг</div>
                        <div class="stat-label">Похудение</div>
                    </div>
                `;
            },
            
            updateSettingsAchievements: function(data) {
                const container = document.getElementById('achievementsList');
                const totalAchievements = data.total || 0;
                
                if (totalAchievements === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 30px; border: 2px dashed var(--border); border-radius: var(--radius);">
                            <i class="fas fa-trophy" style="font-size: 3rem; margin-bottom: 15px; color: var(--text-tertiary);"></i>
                            <p style="color: var(--text-secondary);">У вас пока нет достижений</p>
                        </div>
                    `;
                    return;
                }
                
                // Показываем последние 5 достижений
                const allAchievements = [];
                Object.values(data.achievements).forEach(category => {
                    allAchievements.push(...category);
                });
                
                const recentAchievements = allAchievements
                    .sort((a, b) => new Date(b.earned_at) - new Date(a.earned_at))
                    .slice(0, 5);
                
                container.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        ${recentAchievements.map(achievement => `
                            <div style="padding: 15px; border: 1px solid var(--border); border-radius: var(--radius);">
                                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                    <div style="width: 40px; height: 40px; background: var(--primary); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                                        <i class="${achievement.icon}" style="color: white; font-size: 1.2rem;"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <h4 style="margin-bottom: 5px;">${achievement.title}</h4>
                                        <div style="font-size: 0.85rem; color: var(--text-tertiary);">
                                            ${new Date(achievement.earned_at).toLocaleDateString('ru-RU')}
                                        </div>
                                    </div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">${achievement.description}</p>
                            </div>
                        `).join('')}
                    </div>
                    ${totalAchievements > 5 ? `
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn btn-secondary btn-sm" onclick="app.showAllAchievements()">
                                <i class="fas fa-eye"></i> Показать все (${totalAchievements})
                            </button>
                        </div>
                    ` : ''}
                `;
            },
            
            // Общие методы
            showNotification: function(message, type = 'success') {
                const notification = document.createElement('div');
                notification.style.position = 'fixed';
                notification.style.top = '20px';
                notification.style.right = '20px';
                notification.style.padding = '15px 20px';
                notification.style.background = type === 'success' ? 'var(--success)' : 'var(--danger)';
                notification.style.color = 'white';
                notification.style.borderRadius = 'var(--radius)';
                notification.style.boxShadow = 'var(--shadow)';
                notification.style.zIndex = '3000';
                notification.style.transform = 'translateX(100%)';
                notification.style.opacity = '0';
                notification.style.transition = 'all 0.3s ease';
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                    notification.style.opacity = '1';
                }, 10);
                
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    notification.style.opacity = '0';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            },
            
            updateDate: function() {
                const now = new Date();
                const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('dateDisplay').textContent = now.toLocaleDateString('ru-RU', options);
            },
            
            updateGreeting: function() {
                const greeting = document.getElementById('greeting');
                const hour = new Date().getHours();
                let greetingText = '';
                
                if (hour < 12) greetingText = 'Доброе утро';
                else if (hour < 18) greetingText = 'Добрый день';
                else greetingText = 'Добрый вечер';
                
                if (this.user) {
                    greeting.innerHTML = `<i class="fas fa-home"></i> ${greetingText}, ${this.user.first_name}!`;
                }
            },
            
            setupNavigation: function() {
                this.navigateToPage('overview');
                
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = item.getAttribute('data-page');
                        this.navigateToPage(page);
                    });
                });
            },
            
            setupEventListeners: function() {
                // Здесь будут все обработчики событий
                console.log('Event listeners setup');
            },
            
            formatTime: function(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            },
            
            closeAllModals: function() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('active');
                });
            },
            
            showEditProfileModal: function() {
                document.getElementById('editProfileModal').classList.add('active');
                
                // Заполняем форму текущими данными
                document.getElementById('editFirstName').value = this.user.first_name || '';
                document.getElementById('editLastName').value = this.user.last_name || '';
                document.getElementById('editWeight').value = this.user.weight || '';
                document.getElementById('editTargetWeight').value = this.user.target_weight || '';
                document.getElementById('editActivityLevel').value = this.user.activity_level || 'medium';
            }
        };

        // Объект аутентификации
        const auth = {
            token: localStorage.getItem('token'),
            user: null,
            selectedGoals: [],
            selectedDeadlines: {},
            
            async login() {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                if (!email || !password) {
                    this.showError('Заполните все поля');
                    return;
                }
                
                try {
                    const response = await fetch('/api/auth/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.token = data.data.token;
                        this.user = data.data.user;
                        
                        localStorage.setItem('token', this.token);
                        localStorage.setItem('user', JSON.stringify(this.user));
                        
                        this.showApp();
                    } else {
                        this.showError(data.error || 'Ошибка входа');
                    }
                } catch (error) {
                    this.showError('Ошибка соединения с сервером');
                }
            },
            
            showRegister() {
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('register-form').style.display = 'block';
                document.getElementById('goals-selection').style.display = 'none';
            },
            
            showLogin() {
                document.getElementById('login-form').style.display = 'block';
                document.getElementById('register-form').style.display = 'none';
                document.getElementById('goals-selection').style.display = 'none';
            },
            
            showGoalsSelection() {
                const email = document.getElementById('registerEmail').value;
                const name = document.getElementById('registerName').value;
                const password = document.getElementById('registerPassword').value;
                
                if (!email || !name || !password) {
                    this.showError('Заполните все поля регистрации');
                    return;
                }
                
                if (password.length < 6) {
                    this.showError('Пароль должен быть не менее 6 символов');
                    return;
                }
                
                document.getElementById('register-form').style.display = 'none';
                document.getElementById('goals-selection').style.display = 'block';
                
                this.loadGoalsSelection();
            },
            
            loadGoalsSelection() {
                const goalsList = document.getElementById('goalsList');
                const goals = [
                    {
                        id: 1,
                        title: 'Финансовая грамотность',
                        description: 'Накопить на крупную покупку, научиться управлять бюджетом, инвестировать',
                        icon: 'fas fa-chart-line',
                        category: 'finance',
                        defaultDeadline: 12
                    },
                    {
                        id: 2,
                        title: 'Спорт и похудение',
                        description: 'Привести тело в форму, сбросить вес, набрать мышечную массу',
                        icon: 'fas fa-dumbbell',
                        category: 'fitness',
                        defaultDeadline: 6
                    },
                    {
                        id: 3,
                        title: 'Отказ от вредных привычек',
                        description: 'Бросить курить, сократить употребление алкоголя, избавиться от других вредных привычек',
                        icon: 'fas fa-smoking-ban',
                        category: 'habits',
                        defaultDeadline: 3
                    },
                    {
                        id: 4,
                        title: 'Личная эффективность',
                        description: 'Научиться управлять временем, повысить продуктивность, достигать больше за меньшее время',
                        icon: 'fas fa-brain',
                        category: 'productivity',
                        defaultDeadline: 1
                    },
                    {
                        id: 5,
                        title: 'Распорядок дня',
                        description: 'Наладить режим сна, планировать день, балансировать работу и отдых',
                        icon: 'fas fa-calendar-alt',
                        category: 'schedule',
                        defaultDeadline: 1
                    }
                ];
                
                goalsList.innerHTML = goals.map(goal => `
                    <div class="goal-card" onclick="auth.toggleGoal(${goal.id})" id="goal-${goal.id}">
                        <div class="goal-icon ${goal.category}">
                            <i class="${goal.icon}"></i>
                        </div>
                        <div class="goal-content">
                            <div class="goal-title">${goal.title}</div>
                            <div class="goal-description">${goal.description}</div>
                            <div class="goal-deadline">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Целевой срок:</span>
                                <select class="deadline-select" onchange="auth.updateDeadline(${goal.id}, this.value)" 
                                        id="deadline-${goal.id}">
                                    <option value="1">1 месяц</option>
                                    <option value="3">3 месяца</option>
                                    <option value="6" ${goal.defaultDeadline === 6 ? 'selected' : ''}>6 месяцев</option>
                                    <option value="12" ${goal.defaultDeadline === 12 ? 'selected' : ''}>1 год</option>
                                    <option value="24">2 года</option>
                                </select>
                            </div>
                        </div>
                        <div class="goal-checkbox">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>
                `).join('');
                
                // Сбрасываем выбранные цели
                this.selectedGoals = [];
                this.selectedDeadlines = {};
            },
            
            toggleGoal(goalId) {
                const goalCard = document.getElementById(`goal-${goalId}`);
                const checkbox = goalCard.querySelector('.goal-checkbox');
                
                if (goalCard.classList.contains('selected')) {
                    goalCard.classList.remove('selected');
                    this.selectedGoals = this.selectedGoals.filter(id => id !== goalId);
                    delete this.selectedDeadlines[goalId];
                } else {
                    goalCard.classList.add('selected');
                    this.selectedGoals.push(goalId);
                    
                    // Устанавливаем дефолтный срок
                    const deadlineSelect = document.getElementById(`deadline-${goalId}`);
                    this.selectedDeadlines[goalId] = parseInt(deadlineSelect.value);
                }
                
                this.updateCompleteButton();
            },
            
            updateDeadline(goalId, value) {
                if (this.selectedGoals.includes(goalId)) {
                    this.selectedDeadlines[goalId] = parseInt(value);
                }
            },
            
            updateCompleteButton() {
                const completeBtn = document.getElementById('completeBtn');
                if (this.selectedGoals.length > 0) {
                    completeBtn.disabled = false;
                    completeBtn.innerHTML = `<i class="fas fa-rocket"></i> Начать путешествие (${this.selectedGoals.length} целей)`;
                } else {
                    completeBtn.disabled = true;
                    completeBtn.innerHTML = `<i class="fas fa-rocket"></i> Выберите хотя бы одну цель`;
                }
            },
            
            async completeRegistration() {
                if (this.selectedGoals.length === 0) {
                    this.showError('Выберите хотя бы одну цель');
                    return;
                }
                
                const email = document.getElementById('registerEmail').value;
                const name = document.getElementById('registerName').value;
                const password = document.getElementById('registerPassword').value;
                
                try {
                    const response = await fetch('/api/auth/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            email, 
                            username: email.split('@')[0],
                            password, 
                            first_name: name,
                            goals: this.selectedGoals.join(','),
                            deadlines: this.selectedGoals.map(g => this.selectedDeadlines[g] || 12).join(',')
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        this.token = data.data.token;
                        this.user = data.data.user;
                        
                        localStorage.setItem('token', this.token);
                        localStorage.setItem('user', JSON.stringify(this.user));
                        
                        this.showApp();
                    } else {
                        this.showError(data.error || 'Ошибка регистрации');
                    }
                } catch (error) {
                    this.showError('Ошибка соединения с сервером');
                }
            },
            
            showApp() {
                document.getElementById('auth-page').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                
                if (this.user) {
                    QuantumFlow.init(this.user, this.token);
                }
            },
            
            logout() {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                location.reload();
            },
            
            showError(message) {
                alert(message);
            }
        };

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            if (token && user) {
                auth.token = token;
                auth.user = JSON.parse(user);
                auth.showApp();
            }
        });

        // Делаем объекты доступными глобально
        window.app = QuantumFlow;
        window.auth = auth;
    </script>
</body>
</html>
