<!DOCTYPE html>
<html>
<head>
    <title>OAuth amoCRM</title>
    <meta charset="UTF-8">
</head>
<body style="font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto;">
    <h1>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è amoCRM</h1>
    
    <h2>–®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ —Å—Å—ã–ª–∫—É –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h2>
    <button onclick="getAuthLink()">–ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É</button>
    <div id="authLink"></div>
    
    <h2>–®–∞–≥ 2: –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h2>
    <input type="text" id="authCode" placeholder="–ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏" style="width: 100%; padding: 10px; margin: 10px 0;">
    <button onclick="useAuthCode()">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–¥</button>
    
    <script>
    async function getAuthLink() {
        try {
            const response = await fetch('/api/amocrm/oauth-link');
            const data = await response.json();
            
            if (data.success) {
                const link = document.getElementById('authLink');
                link.innerHTML = `
                    <p><strong>–°—Å—ã–ª–∫–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:</strong></p>
                    <p><a href="${data.data.oauth_url}" target="_blank">${data.data.oauth_url}</a></p>
                    <p>–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Å—ã–ª–∫—É, –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥.</p>
                `;
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
                window.open(data.data.oauth_url, '_blank');
            }
        } catch (error) {
            alert('–û—à–∏–±–∫–∞: ' + error.message);
        }
    }
    
    async function useAuthCode() {
        const code = document.getElementById('authCode').value;
        if (!code) {
            alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏');
            return;
        }
        
        try {
            window.location.href = `/oauth/callback?code=${encodeURIComponent(code)}`;
        } catch (error) {
            alert('–û—à–∏–±–∫–∞: ' + error.message);
        }
    }
    </script>
</body>
</html>
