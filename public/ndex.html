<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>AtomicFlow | Превращай большие цели в цепочку маленьких побед</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Цветовая палитра AtomicFlow - спокойные тона с акцентами */
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3a0ca3;
            --secondary: #f72585;
            --accent: #4cc9f0;
            --success: #4ade80;
            --warning: #fbbf24;
            --danger: #f87171;
            --background: #f8fafc;
            --surface: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-tertiary: #94a3b8;
            --border: #e2e8f0;
            --shadow-color: rgba(67, 97, 238, 0.1);
            
            --radius-sm: 8px;
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-full: 50px;
            
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1);
            
            --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --nav-height: 60px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            font-family: 'Inter', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: var(--nav-height);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
            width: 100%;
        }
        
        /* Навигация */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--nav-height);
            background: var(--surface);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 10px;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: var(--text-secondary);
            padding: 8px 12px;
            border-radius: var(--radius);
            transition: var(--transition);
            min-width: 70px;
            cursor: pointer;
            position: relative;
        }
        
        .nav-item.active {
            color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
        }
        
        .nav-item i {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }
        
        .nav-item span {
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .nav-badge {
            position: absolute;
            top: -2px;
            right: 0;
            background: var(--secondary);
            color: white;
            font-size: 0.6rem;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Основной контент */
        .page {
            display: none;
            animation: fadeIn 0.3s ease;
            min-height: calc(100vh - var(--nav-height));
            padding: 20px 0;
        }
        
        .page.active {
            display: block;
        }
        
        /* Общие стили */
        .card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            border: 1px solid var(--border);
            transition: var(--transition);
        }
        
        .card:hover {
            box-shadow: var(--shadow-lg);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--primary);
        }
        
        /* Кнопки */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.4);
        }
        
        .btn-secondary {
            background: var(--surface);
            color: var(--primary);
            border: 2px solid var(--border);
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }
        
        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Быстрое добавление */
        .quick-add {
            position: fixed;
            bottom: calc(var(--nav-height) + 20px);
            right: 20px;
            z-index: 100;
        }
        
        .quick-add-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .quick-add-btn:hover {
            transform: scale(1.1);
            background: var(--primary-dark);
        }
        
        /* Главная страница - Обзор */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .progress-ring {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
        }
        
        .progress-ring circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        .progress-ring-bg {
            stroke: var(--border);
        }
        
        .progress-ring-fill {
            stroke: var(--primary);
            transition: stroke-dashoffset 0.5s ease;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 700;
            color: var(--text-primary);
        }
        
        /* Страница задач */
        .tasks-container {
            margin-top: 20px;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: var(--surface);
            border-radius: var(--radius);
            margin-bottom: 10px;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--primary);
            transition: var(--transition);
        }
        
        .task-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }
        
        .task-item.completed {
            opacity: 0.7;
            border-left-color: var(--success);
        }
        
        .task-checkbox {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--border);
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
        }
        
        .task-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }
        
        .task-content {
            flex: 1;
        }
        
        .task-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-primary);
        }
        
        .task-meta {
            display: flex;
            gap: 10px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .task-tag {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            padding: 2px 8px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        /* Таймер Pomodoro */
        .pomodoro-timer {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: var(--radius-lg);
            color: white;
            margin-bottom: 20px;
        }
        
        .timer-display {
            font-size: 4rem;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            margin: 20px 0;
            text-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        /* Страница финансов */
        .finance-quick-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .finance-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 15px;
            border-radius: var(--radius);
            background: var(--surface);
            border: 2px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
            min-width: 100px;
        }
        
        .finance-btn.income:hover {
            border-color: var(--success);
            color: var(--success);
        }
        
        .finance-btn.expense:hover {
            border-color: var(--danger);
            color: var(--danger);
        }
        
        .finance-btn i {
            font-size: 1.8rem;
        }
        
        /* Страница привычек */
        .habits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .habit-card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }
        
        .habit-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }
        
        .habit-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(67, 97, 238, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.5rem;
            color: var(--primary);
        }
        
        .habit-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }
        
        .calendar-day {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }
        
        .calendar-day.completed {
            background: var(--success);
            color: white;
        }
        
        /* Страница еженедельного ревью */
        .review-question {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid var(--accent);
        }
        
        .review-question h3 {
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .achievement-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: rgba(76, 201, 240, 0.1);
            border-radius: var(--radius);
            margin: 5px;
            font-size: 0.9rem;
        }
        
        /* Пустые состояния */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state i {
            font-size: 3rem;
            color: var(--border);
            margin-bottom: 15px;
        }
        
        /* Формы и модальные окна */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--surface);
            padding: 30px;
            border-radius: var(--radius-lg);
            max-width: 500px;
            width: 100%;
            animation: fadeIn 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .category-item {
            padding: 10px;
            border-radius: var(--radius);
            border: 2px solid var(--border);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .category-item:hover, .category-item.selected {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
        }
        
        /* Графики */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        
        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes confetti {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(500px) rotate(360deg); opacity: 0; }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--secondary);
            top: -20px;
            opacity: 0;
            z-index: 3000;
            animation: confetti 3s ease-in-out;
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .habits-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .timer-display {
                font-size: 3rem;
            }
        }
        
        @media (max-width: 480px) {
            .nav-item span {
                display: none;
            }
            
            .nav-item {
                min-width: 50px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Основной контент -->
    <main>
        <!-- Главная страница - Обзор -->
        <div id="overview-page" class="page active">
            <div class="container">
                <div class="section-header">
                    <h1 class="section-title">
                        <i class="fas fa-home"></i>
                        AtomicFlow
                    </h1>
                    <div class="btn btn-primary btn-sm" onclick="app.showReviewModal()">
                        <i class="fas fa-clipboard-check"></i>
                        Ревью
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="progress-ring">
                            <svg width="80" height="80">
                                <circle class="progress-ring-bg" cx="40" cy="40" r="36"></circle>
                                <circle class="progress-ring-fill" cx="40" cy="40" r="36" 
                                        stroke-dasharray="226.2" stroke-dashoffset="113.1"></circle>
                            </svg>
                            <div class="progress-text">50%</div>
                        </div>
                        <div class="stat-label">Прогресс дня</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="tasksCompleted">7</div>
                        <div class="stat-label">Задачи выполнено</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="habitsStreak">12</div>
                        <div class="stat-label">Дней подряд</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" id="balance">15 840 ₽</div>
                        <div class="stat-label">Баланс</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="section-header">
                        <h2 class="section-title">
                            <i class="fas fa-tasks"></i>
                            Сегодняшние задачи
                        </h2>
                        <span class="btn btn-secondary btn-sm" onclick="app.navigateToPage('tasks')">
                            Все задачи
                        </span>
                    </div>
                    
                    <div id="todayTasks">
                        <!-- Задачи загружаются динамически -->
                        <div class="task-item">
                            <div class="task-checkbox" onclick="app.toggleTask(this)">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="task-content">
                                <div class="task-title">Запланировать неделю</div>
                                <div class="task-meta">
                                    <span class="task-tag">#работа</span>
                                    <span>10:00</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="task-item completed">
                            <div class="task-checkbox checked" onclick="app.toggleTask(this)">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="task-content">
                                <div class="task-title">Утренняя зарядка</div>
                                <div class="task-meta">
                                    <span class="task-tag">#здоровье</span>
                                    <span>08:00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Продуктивность за неделю
                    </h2>
                    <div class="chart-container">
                        <canvas id="productivityChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Страница задач -->
        <div id="tasks-page" class="page">
            <div class="container">
                <div class="section-header">
                    <h1 class="section-title">
                        <i class="fas fa-tasks"></i>
                        Задачи
                    </h1>
                    <button class="btn btn-primary btn-sm" onclick="app.showTaskModal()">
                        <i class="fas fa-plus"></i>
                        Новая задача
                    </button>
                </div>
                
                <div class="pomodoro-timer">
                    <h3 style="margin-bottom: 10px;">Таймер Pomodoro</h3>
                    <div class="timer-display" id="timerDisplay">25:00</div>
                    <div class="timer-controls">
                        <button class="btn btn-secondary" onclick="app.startTimer()" id="startTimerBtn">
                            <i class="fas fa-play"></i> Старт
                        </button>
                        <button class="btn btn-secondary" onclick="app.resetTimer()" id="resetTimerBtn">
                            <i class="fas fa-redo"></i> Сброс
                        </button>
                    </div>
                </div>
                
                <div class="tasks-container" id="tasksList">
                    <!-- Задачи загружаются динамически -->
                </div>
            </div>
        </div>
        
        <!-- Страница финансов -->
        <div id="finance-page" class="page">
            <div class="container">
                <div class="section-header">
                    <h1 class="section-title">
                        <i class="fas fa-wallet"></i>
                        Финансы
                    </h1>
                    <button class="btn btn-primary btn-sm" onclick="app.navigateToPage('debts')">
                        <i class="fas fa-snowflake"></i>
                        Долги
                    </button>
                </div>
                
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <div style="font-size: 2rem; font-weight: 700; color: var(--text-primary);" id="currentBalance">
                                15 840 ₽
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                Текущий баланс
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 1.2rem; font-weight: 700; color: var(--success);" id="monthIncome">
                                +32 500 ₽
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">
                                Доход за месяц
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="finance-quick-actions">
                    <div class="finance-btn income" onclick="app.showFinanceModal('income')">
                        <i class="fas fa-plus-circle"></i>
                        <span>Доход</span>
                    </div>
                    <div class="finance-btn expense" onclick="app.showFinanceModal('expense')">
                        <i class="fas fa-minus-circle"></i>
                        <span>Расход</span>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="section-title">
                        <i class="fas fa-chart-pie"></i>
                        Расходы по категориям
                    </h2>
                    <div class="chart-container">
                        <canvas id="expensesChart"></canvas>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="section-title">
                        <i class="fas fa-history"></i>
                        Последние операции
                    </h2>
                    <div id="recentTransactions">
                        <!-- Транзакции загружаются динамически -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Страница долгов -->
        <div id="debts-page" class="page">
            <div class="container">
                <div class="section-header">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <button class="btn btn-secondary btn-sm" onclick="app.navigateToPage('finance')">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                        <h1 class="section-title">
                            <i class="fas fa-snowflake"></i>
                            Метод "Снежного кома"
                        </h1>
                    </div>
                    <button class="btn btn-primary btn-sm" onclick="app.showDebtModal()">
                        <i class="fas fa-plus"></i>
                        Новый долг
                    </button>
                </div>
                
                <div class="card">
                    <p style="margin-bottom: 20px; color: var(--text-secondary);">
                        Метод "снежного кома" помогает быстрее выплачивать долги. Начните с самого маленького долга, выплачивайте его полностью, затем переходите к следующему.
                    </p>
                    
                    <div id="debtsList">
                        <!-- Долги загружаются динамически -->
                        <div class="task-item">
                            <div class="task-content">
                                <div class="task-title">Кредитная карта</div>
                                <div class="task-meta">
                                    <span>Остаток: 45 000 ₽</span>
                                    <span>Процент: 25%</span>
                                </div>
                            </div>
                            <div style="color: var(--danger); font-weight: 700;">
                                Первый
                            </div>
                        </div>
                        
                        <div class="task-item">
                            <div class="task-content">
                                <div class="task-title">Автокредит</div>
                                <div class="task-meta">
                                    <span>Остаток: 350 000 ₽</span>
                                    <span>Процент: 12%</span>
                                </div>
                            </div>
                            <div style="color: var(--text-secondary);">
                                Второй
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Прогноз выплат
                    </h2>
                    <div class="chart-container">
                        <canvas id="debtChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Страница привычек -->
        <div id="habits-page" class="page">
            <div class="container">
                <div class="section-header">
                    <h1 class="section-title">
                        <i class="fas fa-calendar-check"></i>
                        Привычки
                    </h1>
                    <button class="btn btn-primary btn-sm" onclick="app.showHabitModal()">
                        <i class="fas fa-plus"></i>
                        Новая привычка
                    </button>
                </div>
                
                <div class="habits-grid" id="habitsList">
                    <!-- Привычки загружаются динамически -->
                </div>
            </div>
        </div>
        
        <!-- Страница профиля -->
        <div id="profile-page" class="page">
            <div class="container">
                <div class="section-header">
                    <h1 class="section-title">
                        <i class="fas fa-user"></i>
                        Профиль
                    </h1>
                    <button class="btn btn-secondary btn-sm" onclick="app.showSettingsModal()">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
                
                <div class="card" style="text-align: center;">
                    <div style="width: 80px; height: 80px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 2rem; font-weight: 700; margin: 0 auto 20px;">
                        А
                    </div>
                    <h2 style="margin-bottom: 10px;">Александр</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">@atomic_user</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0;">
                        <div class="stat-card">
                            <div class="stat-value">42</div>
                            <div class="stat-label">Дней с нами</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">87</div>
                            <div class="stat-label">Задач выполнено</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">12</div>
                            <div class="stat-label">Ревью пройдено</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">156</div>
                            <div class="stat-label">Транзакций</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="section-title">
                        <i class="fas fa-trophy"></i>
                        Достижения
                    </h2>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;">
                        <div class="achievement-badge">
                            <i class="fas fa-check-circle" style="color: var(--success);"></i>
                            Первая задача
                        </div>
                        <div class="achievement-badge">
                            <i class="fas fa-calendar" style="color: var(--primary);"></i>
                            7 дней подряд
                        </div>
                        <div class="achievement-badge">
                            <i class="fas fa-chart-line" style="color: var(--accent);"></i>
                            Финансовый обзор
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Быстрое добавление -->
    <div class="quick-add">
        <div class="quick-add-btn" onclick="app.showQuickAddMenu()">
            <i class="fas fa-plus"></i>
        </div>
    </div>
    
    <!-- Нижняя навигация -->
    <nav class="bottom-nav" id="bottomNav">
        <a href="#" class="nav-item active" onclick="app.navigateToPage('overview')" data-page="overview">
            <i class="fas fa-home"></i>
            <span>Обзор</span>
        </a>
        <a href="#" class="nav-item" onclick="app.navigateToPage('tasks')" data-page="tasks">
            <i class="fas fa-tasks"></i>
            <span>Задачи</span>
            <div class="nav-badge" id="tasksBadge">3</div>
        </a>
        <a href="#" class="nav-item" onclick="app.navigateToPage('finance')" data-page="finance">
            <i class="fas fa-wallet"></i>
            <span>Финансы</span>
        </a>
        <a href="#" class="nav-item" onclick="app.navigateToPage('habits')" data-page="habits">
            <i class="fas fa-calendar-check"></i>
            <span>Привычки</span>
        </a>
        <a href="#" class="nav-item" onclick="app.navigateToPage('profile')" data-page="profile">
            <i class="fas fa-user"></i>
            <span>Профиль</span>
        </a>
    </nav>
    
    <!-- Модальные окна -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <h3 style="color: var(--text-primary); margin-bottom: 20px;">Новая задача</h3>
            <form id="taskForm">
                <div class="form-group">
                    <label class="form-label">Название задачи</label>
                    <input type="text" id="taskTitle" class="form-input" placeholder="Что нужно сделать?" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Тег</label>
                    <div class="category-grid">
                        <div class="category-item" data-tag="#работа" onclick="app.selectCategory(this)">#работа</div>
                        <div class="category-item" data-tag="#дом" onclick="app.selectCategory(this)">#дом</div>
                        <div class="category-item" data-tag="#здоровье" onclick="app.selectCategory(this)">#здоровье</div>
                        <div class="category-item" data-tag="#учеба" onclick="app.selectCategory(this)">#учеба</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Разобрать на подзадачи</label>
                    <div id="subtasksContainer">
                        <input type="text" class="form-input" placeholder="Подзадача 1" style="margin-bottom: 10px;">
                    </div>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="app.addSubtask()">
                        <i class="fas fa-plus"></i> Добавить подзадачу
                    </button>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-save"></i> Сохранить задачу
                </button>
            </form>
        </div>
    </div>
    
    <div class="modal" id="financeModal">
        <div class="modal-content">
            <h3 style="color: var(--text-primary); margin-bottom: 20px;" id="financeModalTitle">Новая операция</h3>
            <form id="financeForm">
                <div class="form-group">
                    <label class="form-label">Сумма</label>
                    <input type="number" id="financeAmount" class="form-input" placeholder="0" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Категория</label>
                    <div class="category-grid">
                        <div class="category-item" data-category="food" onclick="app.selectFinanceCategory(this)">
                            <i class="fas fa-utensils"></i>
                            <div>Еда</div>
                        </div>
                        <div class="category-item" data-category="transport" onclick="app.selectFinanceCategory(this)">
                            <i class="fas fa-bus"></i>
                            <div>Транспорт</div>
                        </div>
                        <div class="category-item" data-category="entertainment" onclick="app.selectFinanceCategory(this)">
                            <i class="fas fa-film"></i>
                            <div>Развлечения</div>
                        </div>
                        <div class="category-item" data-category="shopping" onclick="app.selectFinanceCategory(this)">
                            <i class="fas fa-shopping-bag"></i>
                            <div>Покупки</div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Комментарий</label>
                    <input type="text" id="financeComment" class="form-input" placeholder="За что?">
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-save"></i> Сохранить
                </button>
            </form>
        </div>
    </div>
    
    <div class="modal" id="reviewModal">
        <div class="modal-content">
            <h2 style="color: var(--text-primary); margin-bottom: 20px; text-align: center;">
                <i class="fas fa-clipboard-check"></i> Еженедельное Ревью
            </h2>
            
            <div class="review-question">
                <h3>Какие 3 дела на прошлой неделе были самыми важными?</h3>
                <div id="importantTasks">
                    <!-- Список выполненных задач -->
                </div>
            </div>
            
            <div class="review-question">
                <h3>Что можно улучшить?</h3>
                <textarea class="form-input" rows="3" placeholder="Поделитесь мыслями..."></textarea>
            </div>
            
            <div class="review-question">
                <h3>Главный финансовый вывод недели</h3>
                <div style="background: rgba(76, 201, 240, 0.1); padding: 15px; border-radius: var(--radius);">
                    <p style="margin-bottom: 10px;">На развлечения ушло на 15% больше, чем обычно</p>
                    <div style="font-size: 0.9rem; color: var(--text-secondary);">
                        Рекомендация: попробуйте установить лимит в 3000 ₽ на развлечения
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="app.completeReview()">
                <i class="fas fa-check"></i> Завершить ревью
            </button>
        </div>
    </div>
    
    <script>
        const app = {
            currentUser: null,
            currentPage: 'overview',
            timerInterval: null,
            timerSeconds: 1500, // 25 минут в секундах
            
            // Данные пользователя
            userData: JSON.parse(localStorage.getItem('atomicflow_data')) || {
                tasks: [
                    { id: 1, title: "Запланировать неделю", tag: "#работа", completed: false, time: "10:00" },
                    { id: 2, title: "Утренняя зарядка", tag: "#здоровье", completed: true, time: "08:00" },
                    { id: 3, title: "Купить продукты", tag: "#дом", completed: false, time: "18:00" },
                    { id: 4, title: "Изучить новый фреймворк", tag: "#учеба", completed: false, time: "14:00" }
                ],
                habits: [
                    { id: 1, title: "Пить воду", icon: "fas fa-tint", streak: 12, calendar: [1,1,1,1,1,1,0,1,1,1,1,1,1,0] },
                    { id: 2, title: "15 минут уборки", icon: "fas fa-broom", streak: 8, calendar: [1,1,0,1,1,1,1,1,1,0,0,1,1,1] },
                    { id: 3, title: "Чтение 20 мин", icon: "fas fa-book", streak: 5, calendar: [1,0,1,1,0,1,1,1,0,1,0,0,1,1] }
                ],
                transactions: [
                    { id: 1, type: "expense", amount: 350, category: "food", comment: "Обед", date: "2024-01-15" },
                    { id: 2, type: "income", amount: 50000, category: "salary", comment: "Зарплата", date: "2024-01-10" },
                    { id: 3, type: "expense", amount: 1200, category: "transport", comment: "Такси", date: "2024-01-14" },
                    { id: 4, type: "expense", amount: 2500, category: "entertainment", comment: "Кино", date: "2024-01-13" }
                ],
                debts: [
                    { id: 1, title: "Кредитная карта", amount: 45000, interest: 25, priority: 1 },
                    { id: 2, title: "Автокредит", amount: 350000, interest: 12, priority: 2 }
                ],
                stats: {
                    level: 3,
                    coins: 1250,
                    streak: 12,
                    balance: 15840,
                    monthlyIncome: 32500,
                    monthlyExpenses: 17600
                }
            },
            
            // Категории расходов
            categories: {
                food: { name: "Еда", color: "#ef4444", icon: "fas fa-utensils" },
                transport: { name: "Транспорт", color: "#3b82f6", icon: "fas fa-bus" },
                entertainment: { name: "Развлечения", color: "#8b5cf6", icon: "fas fa-film" },
                shopping: { name: "Покупки", color: "#10b981", icon: "fas fa-shopping-bag" },
                health: { name: "Здоровье", color: "#06b6d4", icon: "fas fa-heartbeat" },
                education: { name: "Образование", color: "#f59e0b", icon: "fas fa-graduation-cap" }
            },
            
            // Инициализация
            init: function() {
                console.log('Инициализация AtomicFlow...');
                this.setupEventListeners();
                this.loadCharts();
                this.updateUI();
                
                // Симуляция интеграции с Telegram
                this.simulateTelegramInit();
            },
            
            // Навигация
            navigateToPage: function(pageId) {
                this.currentPage = pageId;
                
                // Скрываем все страницы
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                });
                
                // Показываем нужную страницу
                const targetPage = document.getElementById(pageId + '-page');
                if (targetPage) {
                    targetPage.classList.add('active');
                    
                    // Обновляем активную кнопку в навигации
                    document.querySelectorAll('.nav-item').forEach(item => {
                        item.classList.remove('active');
                        if (item.getAttribute('data-page') === pageId) {
                            item.classList.add('active');
                        }
                    });
                    
                    // Загружаем данные для страницы
                    switch(pageId) {
                        case 'overview':
                            this.loadOverviewPage();
                            break;
                        case 'tasks':
                            this.loadTasksPage();
                            break;
                        case 'finance':
                            this.loadFinancePage();
                            break;
                        case 'debts':
                            this.loadDebtsPage();
                            break;
                        case 'habits':
                            this.loadHabitsPage();
                            break;
                        case 'profile':
                            this.loadProfilePage();
                            break;
                    }
                }
            },
            
            // Обновление интерфейса
            updateUI: function() {
                // Обновляем статистику
                document.getElementById('tasksCompleted').textContent = 
                    this.userData.tasks.filter(t => t.completed).length;
                document.getElementById('habitsStreak').textContent = 
                    this.userData.stats.streak;
                document.getElementById('balance').textContent = 
                    this.formatCurrency(this.userData.stats.balance);
                
                // Обновляем бейдж задач
                const pendingTasks = this.userData.tasks.filter(t => !t.completed).length;
                const tasksBadge = document.getElementById('tasksBadge');
                if (pendingTasks > 0) {
                    tasksBadge.textContent = pendingTasks;
                    tasksBadge.style.display = 'flex';
                } else {
                    tasksBadge.style.display = 'none';
                }
            },
            
            // Загрузка страниц
            loadOverviewPage: function() {
                this.loadTodayTasks();
                this.updateUI();
            },
            
            loadTasksPage: function() {
                this.renderTasksList();
                this.updateTimerDisplay();
            },
            
            loadFinancePage: function() {
                this.renderRecentTransactions();
                this.renderExpensesChart();
            },
            
            loadDebtsPage: function() {
                this.renderDebtsList();
                this.renderDebtChart();
            },
            
            loadHabitsPage: function() {
                this.renderHabitsList();
            },
            
            loadProfilePage: function() {
                // Данные уже в шаблоне
            },
            
            // Работа с задачами
            loadTodayTasks: function() {
                const container = document.getElementById('todayTasks');
                if (!container) return;
                
                container.innerHTML = '';
                
                const todayTasks = this.userData.tasks.slice(0, 3);
                todayTasks.forEach(task => {
                    const taskElement = this.createTaskElement(task);
                    container.appendChild(taskElement);
                });
            },
            
            renderTasksList: function() {
                const container = document.getElementById('tasksList');
                if (!container) return;
                
                container.innerHTML = '';
                
                this.userData.tasks.forEach(task => {
                    const taskElement = this.createTaskElement(task);
                    container.appendChild(taskElement);
                });
            },
            
            createTaskElement: function(task) {
                const div = document.createElement('div');
                div.className = `task-item ${task.completed ? 'completed' : ''}`;
                div.dataset.id = task.id;
                
                div.innerHTML = `
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}" onclick="app.toggleTask(${task.id})">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            <span class="task-tag">${task.tag}</span>
                            <span>${task.time}</span>
                        </div>
                    </div>
                    <button class="btn btn-icon btn-secondary" onclick="app.breakdownTask(${task.id})">
                        <i class="fas fa-project-diagram"></i>
                    </button>
                `;
                
                return div;
            },
            
            toggleTask: function(taskId) {
                const task = this.userData.tasks.find(t => t.id === taskId);
                if (task) {
                    task.completed = !task.completed;
                    
                    // Начисляем монеты за выполнение
                    if (task.completed) {
                        this.userData.stats.coins += 10;
                        this.showConfetti();
                        this.showNotification('Задача выполнена! +10 монет', 'success');
                    }
                    
                    this.saveData();
                    this.updateUI();
                    this.renderTasksList();
                    this.loadTodayTasks();
                }
            },
            
            breakdownTask: function(taskId) {
                const task = this.userData.tasks.find(t => t.id === taskId);
                if (task) {
                    // Показываем модальное окно для разбора задачи
                    this.showNotification(`Разбираем задачу "${task.title}" на подзадачи`, 'info');
                    
                    // Пример создания подзадач
                    const subtasks = [
                        "Определить конечную цель",
                        "Составить план действий",
                        "Оценить необходимые ресурсы"
                    ];
                    
                    subtasks.forEach((subtask, index) => {
                        const newTask = {
                            id: Date.now() + index,
                            title: `${task.title}: ${subtask}`,
                            tag: task.tag,
                            completed: false,
                            time: "сегодня"
                        };
                        this.userData.tasks.push(newTask);
                    });
                    
                    this.saveData();
                    this.renderTasksList();
                }
            },
            
            // Таймер Pomodoro
            startTimer: function() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                    document.getElementById('startTimerBtn').innerHTML = '<i class="fas fa-play"></i> Старт';
                    return;
                }
                
                this.timerInterval = setInterval(() => {
                    this.timerSeconds--;
                    this.updateTimerDisplay();
                    
                    if (this.timerSeconds <= 0) {
                        clearInterval(this.timerInterval);
                        this.timerInterval = null;
                        this.showNotification('Время вышло! Сделайте перерыв 5 минут.', 'success');
                        document.getElementById('startTimerBtn').innerHTML = '<i class="fas fa-play"></i> Старт';
                    }
                }, 1000);
                
                document.getElementById('startTimerBtn').innerHTML = '<i class="fas fa-pause"></i> Пауза';
            },
            
            resetTimer: function() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
                
                this.timerSeconds = 1500; // 25 минут
                this.updateTimerDisplay();
                document.getElementById('startTimerBtn').innerHTML = '<i class="fas fa-play"></i> Старт';
            },
            
            updateTimerDisplay: function() {
                const minutes = Math.floor(this.timerSeconds / 60);
                const seconds = this.timerSeconds % 60;
                document.getElementById('timerDisplay').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            },
            
            // Работа с привычками
            renderHabitsList: function() {
                const container = document.getElementById('habitsList');
                if (!container) return;
                
                container.innerHTML = '';
                
                this.userData.habits.forEach(habit => {
                    const div = document.createElement('div');
                    div.className = 'habit-card';
                    div.dataset.id = habit.id;
                    
                    // Создаем календарь
                    let calendarHtml = '<div class="habit-calendar">';
                    habit.calendar.forEach((day, index) => {
                        calendarHtml += `<div class="calendar-day ${day ? 'completed' : ''}">${index + 1}</div>`;
                    });
                    calendarHtml += '</div>';
                    
                    div.innerHTML = `
                        <div class="habit-icon">
                            <i class="${habit.icon}"></i>
                        </div>
                        <h3 style="margin-bottom: 10px; font-size: 1rem;">${habit.title}</h3>
                        <div style="color: var(--success); font-weight: 700; margin-bottom: 10px;">
                            ${habit.streak} дней подряд
                        </div>
                        ${calendarHtml}
                        <button class="btn btn-primary btn-sm" style="width: 100%; margin-top: 15px;" 
                                onclick="app.markHabit(${habit.id})">
                            <i class="fas fa-check"></i> Отметить сегодня
                        </button>
                    `;
                    
                    container.appendChild(div);
                });
            },
            
            markHabit: function(habitId) {
                const habit = this.userData.habits.find(h => h.id === habitId);
                if (habit) {
                    // Добавляем отметку на сегодня
                    habit.calendar.push(1);
                    habit.streak++;
                    
                    // Начисляем награду
                    this.userData.stats.coins += 5;
                    this.userData.stats.streak = Math.max(this.userData.stats.streak, habit.streak);
                    
                    this.saveData();
                    this.renderHabitsList();
                    this.showConfetti();
                    this.showNotification('Привычка отмечена! +5 монет', 'success');
                }
            },
            
            // Работа с финансами
            renderRecentTransactions: function() {
                const container = document.getElementById('recentTransactions');
                if (!container) return;
                
                container.innerHTML = '';
                
                this.userData.transactions.slice(0, 5).forEach(transaction => {
                    const div = document.createElement('div');
                    div.className = 'task-item';
                    
                    const category = this.categories[transaction.category] || { name: transaction.category, color: '#94a3b8' };
                    const sign = transaction.type === 'income' ? '+' : '-';
                    const color = transaction.type === 'income' ? 'var(--success)' : 'var(--danger)';
                    
                    div.innerHTML = `
                        <div style="flex: 1;">
                            <div class="task-title">${transaction.comment}</div>
                            <div class="task-meta">
                                <span style="color: ${category.color};">${category.name}</span>
                                <span>${transaction.date}</span>
                            </div>
                        </div>
                        <div style="font-weight: 700; color: ${color};">
                            ${sign}${this.formatCurrency(transaction.amount)}
                        </div>
                    `;
                    
                    container.appendChild(div);
                });
            },
            
            // Работа с долгами
            renderDebtsList: function() {
                const container = document.getElementById('debtsList');
                if (!container) return;
                
                container.innerHTML = '';
                
                // Сортируем по приоритету (метод снежного кома)
                const sortedDebts = [...this.userData.debts].sort((a, b) => a.priority - b.priority);
                
                sortedDebts.forEach(debt => {
                    const div = document.createElement('div');
                    div.className = 'task-item';
                    
                    div.innerHTML = `
                        <div class="task-content">
                            <div class="task-title">${debt.title}</div>
                            <div class="task-meta">
                                <span>Остаток: ${this.formatCurrency(debt.amount)}</span>
                                <span>Процент: ${debt.interest}%</span>
                            </div>
                        </div>
                        <div style="color: ${debt.priority === 1 ? 'var(--danger)' : 'var(--text-secondary)'}; font-weight: 700;">
                            ${debt.priority === 1 ? 'Первый' : 'Второй'}
                        </div>
                    `;
                    
                    container.appendChild(div);
                });
            },
            
            // Графики
            loadCharts: function() {
                // Продуктивность
                const productivityCtx = document.getElementById('productivityChart')?.getContext('2d');
                if (productivityCtx) {
                    new Chart(productivityCtx, {
                        type: 'bar',
                        data: {
                            labels: ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'],
                            datasets: [{
                                label: 'Выполненные задачи',
                                data: [5, 7, 3, 8, 6, 4, 2],
                                backgroundColor: 'rgba(67, 97, 238, 0.5)',
                                borderColor: 'var(--primary)',
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(0,0,0,0.05)'
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            }
                        }
                    });
                }
                
                // Расходы по категориям
                this.renderExpensesChart();
                
                // График долгов
                this.renderDebtChart();
            },
            
            renderExpensesChart: function() {
                const expensesCtx = document.getElementById('expensesChart')?.getContext('2d');
                if (!expensesCtx) return;
                
                // Группируем расходы по категориям
                const expensesByCategory = {};
                this.userData.transactions
                    .filter(t => t.type === 'expense')
                    .forEach(t => {
                        const category = t.category;
                        expensesByCategory[category] = (expensesByCategory[category] || 0) + t.amount;
                    });
                
                const categories = Object.keys(expensesByCategory);
                const amounts = categories.map(cat => expensesByCategory[cat]);
                const colors = categories.map(cat => this.categories[cat]?.color || '#94a3b8');
                
                new Chart(expensesCtx, {
                    type: 'doughnut',
                    data: {
                        labels: categories.map(cat => this.categories[cat]?.name || cat),
                        datasets: [{
                            data: amounts,
                            backgroundColor: colors,
                            borderWidth: 2,
                            borderColor: 'white'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            },
            
            renderDebtChart: function() {
                const debtCtx = document.getElementById('debtChart')?.getContext('2d');
                if (!debtCtx) return;
                
                // Симуляция прогноза выплат
                const months = ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн'];
                const debt1 = [45000, 40000, 35000, 30000, 25000, 20000]; // Кредитная карта
                const debt2 = [350000, 340000, 330000, 320000, 310000, 300000]; // Автокредит
                
                new Chart(debtCtx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Кредитная карта',
                                data: debt1,
                                borderColor: 'var(--danger)',
                                backgroundColor: 'rgba(248, 113, 113, 0.1)',
                                tension: 0.3
                            },
                            {
                                label: 'Автокредит',
                                data: debt2,
                                borderColor: 'var(--warning)',
                                backgroundColor: 'rgba(251, 191, 36, 0.1)',
                                tension: 0.3
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        },
                        scales: {
                            y: {
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString() + ' ₽';
                                    }
                                }
                            }
                        }
                    }
                });
            },
            
            // Модальные окна
            showTaskModal: function() {
                document.getElementById('taskModal').classList.add('active');
            },
            
            showFinanceModal: function(type) {
                document.getElementById('financeModal').classList.add('active');
                const title = document.getElementById('financeModalTitle');
                title.textContent = type === 'income' ? 'Новый доход' : 'Новый расход';
                
                // Сбрасываем форму
                document.getElementById('financeForm').reset();
            },
            
            showReviewModal: function() {
                document.getElementById('reviewModal').classList.add('active');
                
                // Заполняем важные задачи
                const completedTasks = this.userData.tasks.filter(t => t.completed);
                const container = document.getElementById('importantTasks');
                container.innerHTML = '';
                
                completedTasks.slice(0, 5).forEach(task => {
                    const div = document.createElement('div');
                    div.className = 'task-item';
                    div.innerHTML = `
                        <div class="task-checkbox" onclick="this.classList.toggle('checked')">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="task-content">
                            <div class="task-title">${task.title}</div>
                        </div>
                    `;
                    container.appendChild(div);
                });
            },
            
            showQuickAddMenu: function() {
                // Простое меню быстрого добавления
                const choice = confirm('Что вы хотите добавить?\n\nОК - Задачу\nОтмена - Расход');
                if (choice === true) {
                    this.showTaskModal();
                } else {
                    this.showFinanceModal('expense');
                }
            },
            
            completeReview: function() {
                this.closeAllModals();
                this.showConfetti(50);
                this.showNotification('Еженедельное ревью завершено! Вы получаете 50 монет.', 'success');
                
                // Начисляем награду
                this.userData.stats.coins += 50;
                this.saveData();
                this.updateUI();
            },
            
            closeAllModals: function() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('active');
                });
            },
            
            // Вспомогательные функции
            formatCurrency: function(amount) {
                return amount.toLocaleString('ru-RU') + ' ₽';
            },
            
            showNotification: function(message, type) {
                // В Telegram Mini App используем WebApp.showAlert
                if (window.Telegram?.WebApp) {
                    window.Telegram.WebApp.showAlert(message);
                } else {
                    alert(message);
                }
            },
            
            showConfetti: function(count = 30) {
                for (let i = 0; i < count; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.background = this.getRandomColor();
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }
            },
            
            getRandomColor: function() {
                const colors = ['#4361ee', '#f72585', '#4cc9f0', '#4ade80', '#fbbf24'];
                return colors[Math.floor(Math.random() * colors.length)];
            },
            
            selectCategory: function(element) {
                document.querySelectorAll('.category-item').forEach(item => {
                    item.classList.remove('selected');
                });
                element.classList.add('selected');
            },
            
            selectFinanceCategory: function(element) {
                document.querySelectorAll('.category-item').forEach(item => {
                    item.classList.remove('selected');
                });
                element.classList.add('selected');
            },
            
            addSubtask: function() {
                const container = document.getElementById('subtasksContainer');
                const count = container.children.length + 1;
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'form-input';
                input.placeholder = `Подзадача ${count}`;
                input.style.marginBottom = '10px';
                container.appendChild(input);
            },
            
            // Обработчики событий
            setupEventListeners: function() {
                // Форма задачи
                const taskForm = document.getElementById('taskForm');
                if (taskForm) {
                    taskForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        
                        const title = document.getElementById('taskTitle').value;
                        const newTask = {
                            id: Date.now(),
                            title: title,
                            tag: '#работа',
                            completed: false,
                            time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })
                        };
                        
                        this.userData.tasks.push(newTask);
                        this.saveData();
                        this.renderTasksList();
                        this.loadTodayTasks();
                        this.updateUI();
                        
                        this.closeAllModals();
                        this.showNotification('Задача добавлена!', 'success');
                    });
                }
                
                // Форма финансов
                const financeForm = document.getElementById('financeForm');
                if (financeForm) {
                    financeForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        
                        const amount = parseFloat(document.getElementById('financeAmount').value);
                        const comment = document.getElementById('financeComment').value || 'Без комментария';
                        
                        const newTransaction = {
                            id: Date.now(),
                            type: 'expense',
                            amount: amount,
                            category: 'food',
                            comment: comment,
                            date: new Date().toLocaleDateString('ru-RU')
                        };
                        
                        this.userData.transactions.push(newTransaction);
                        this.userData.stats.balance -= amount;
                        this.userData.stats.monthlyExpenses += amount;
                        
                        this.saveData();
                        this.renderRecentTransactions();
                        this.renderExpensesChart();
                        this.updateUI();
                        
                        this.closeAllModals();
                        this.showNotification(`Расход ${this.formatCurrency(amount)} записан!`, 'success');
                    });
                }
                
                // Закрытие модальных окон
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                        this.closeAllModals();
                    }
                });
                
                // Обработка быстрого добавления (нажатие и удержание)
                const quickAddBtn = document.querySelector('.quick-add-btn');
                let longPressTimer;
                
                quickAddBtn.addEventListener('mousedown', () => {
                    longPressTimer = setTimeout(() => {
                        this.showReviewModal();
                    }, 1000);
                });
                
                quickAddBtn.addEventListener('mouseup', () => {
                    clearTimeout(longPressTimer);
                });
                
                quickAddBtn.addEventListener('mouseleave', () => {
                    clearTimeout(longPressTimer);
                });
            },
            
            // Симуляция инициализации Telegram
            simulateTelegramInit: function() {
                // В реальном приложении здесь будет инициализация Telegram WebApp
                console.log('AtomicFlow готов к работе в Telegram!');
                
                // Создаем заглушку для Telegram WebApp API
                if (!window.Telegram) {
                    window.Telegram = {
                        WebApp: {
                            ready: () => console.log('WebApp ready'),
                            expand: () => console.log('WebApp expanded'),
                            showAlert: (msg) => alert(msg),
                            showConfirm: (msg, callback) => {
                                const result = confirm(msg);
                                callback(result);
                            }
                        }
                    };
                }
            },
            
            // Сохранение данных
            saveData: function() {
                localStorage.setItem('atomicflow_data', JSON.stringify(this.userData));
            }
        };
        
        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
        
        // Делаем app глобально доступным
        window.app = app;
    </script>
</body>
</html>
